(function(n){"use strict";n.fn.webgis_contentsearch=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_contentsearch");else return t.init.apply(this,arguments)};var r={placeholder:"Inhalte filtern...",container_selectors:["li","ul"],onChanged:null,onMatch:null,onReset:null,displayMachted:"block",searchTag:null,resetButton:!0,addInputElementClass:""},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})},reset:function(t){var i=n(this).children("input").val("").closest(".webgis-content-search-area").removeClass("active");if(i.find("[data-orig-display]").each(function(t,i){var r=n(i);r.attr("data-orig-display")&&r.removeClass("webgis-content-search-match").css("display",r.attr("data-orig-display")).attr("data-search-tag","").attr("data-orig-display","")}),i.find(".webgis-search-content-alt-text").each(function(t,i){n(i).attr("data-search-tag","").text(n(i).attr("data-content-search-text"))}),n(this).find(".reset-button").css("display",""),t&&t.onReset)t.onReset(n(this).closest(".webgis-content-search-area"))},trigger:function(){n(this).children("input").trigger("keyup")},set:function(t){var i=n(this).children("input").val(t.value).focus().trigger("keyup")}},u=function(t,r){function e(n){return n?"addClass":"removeClass"}var u=n(t).addClass("webgis-content-search-holder"),f,o;u.parent().addClass("webgis-content-search-area");f=n("<input type='text' placeholder='"+r.placeholder+"'>").addClass("clearable x").addClass(r.addInputElementClass).appendTo(u).on("mousemove",function(t){n(this)[e(this.offsetWidth-18<t.clientX-this.getBoundingClientRect().left)]("onX")}).on("touchstart click",function(t){n(this).hasClass("onX")&&(t.preventDefault(),n(this).removeClass("onX").closest(".webgis-content-search-holder").webgis_contentsearch("reset",r))}).on("keydown",function(t){if(!n(this).val()){var i=t.keyCode;if(i===8||i===46||i===13)return;n(this).closest(".webgis-content-search-area").find("[data-orig-display]").attr("data-orig-display","")}}).on("keyup",function(){var t=n(this),u=t.val().toLowerCase(),f,e;if(u?(f=u.split(" "),e=t.closest(".webgis-content-search-area").addClass("active"),e.find(".webgis-search-content.active").each(function(t,e){var o=n(e),s=!0;for(var t in f)f[t]&&(s&=o.text().toLowerCase().indexOf(f[t])>=0);n.each(r.container_selectors,function(n,t){i(o,t,s,u,r)})}),e.find(".webgis-search-content-alt-text").each(function(t,i){n(i).attr("data-search-tag",u).text(n(i).attr("data-content-search-alt-text"))}),t.closest(".webgis-content-search-holder").find(".reset-button").css("display","block")):t.closest(".webgis-content-search-holder").webgis_contentsearch("reset",r),r.onChanged)r.onChanged(n(this).closest(".webgis-content-search-area"),n(this).val())});o=n("<button>").addClass("webgis-button uibutton uibutton-cancel reset-button").text("Filter entfernen").appendTo(u).click(function(){n(this).closest(".webgis-content-search-holder").webgis_contentsearch("reset")});r.searchTag&&f.val(r.searchTag).trigger("keyup")},i=function(n,t,r,u,f){var e=n.closest(t);if(e.length!==0)if(e.attr("data-orig-display")||e.attr("data-orig-display",e.css("display")),u)if(r){if(e.addClass("webgis-content-search-match").css("display",e.hasClass("webgis-search-content")?f.displayMachted:"block").attr("data-search-tag",u),i(e.parent(),t,r,u),f&&f.onMatch)f.onMatch(this,e,u)}else e.attr("data-search-tag")!==u&&e.removeClass("webgis-content-search-match").css("display","none");else e.css("display",e.attr("data-orig-display")).attr("data-search-tag","")}})(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_presentationToc=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_presentationToc");else return t.init.apply(this,arguments)};let h={items:null,map:null,gdi_button:!1,basemap_rows:1},t={init:function(t){let i=n(this);return t=n.extend({},h,t),this.each(function(){new c(this,t)})},show_first:function(){n(this).find(".webgis-presentation_toc-collapsable.webgis-expanded").length==0&&n(this).find(".webgis-presentation_toc-collapsable:first").find(".webgis-presentation_toc-title-text").trigger("click")},show_services_legend:function(t){if(t.map){let i=webgis.globals&&webgis.globals.portal?webgis.globals.portal.mapName:null;n.presentationToc.showLegend(t.sender,t.map,t.map.services,i||"Darstellung, ©, ...")}},get_expanded_names:function(){let t=[],i=function(r,u){r.children(".webgis-presentation_toc-item-group.webgis-presentation_toc-collapsable").each(function(r,f){let e=n(f),o=e.children("ul");o.length===1&&(o.css("display")!=="none"&&t.push(u+e.attr("data-ui-groupname")),i(o,u+e.attr("data-ui-groupname")+"|"))})};return n(this).find(".webgis-presentation_toc-title.webgis-presentation_toc-collapsable").each(function(r,u){let f=n(u);f.hasClass("webgis-expanded")&&t.push(f.attr("data-container"));i(f.children(".webgis-presentation_toc-content").children("ul"),f.attr("data-container")+"|")}),t},expand:function(t){let i=n(this);return t.exclusive===!0&&s(this,t),webgis.delayed(function(){let r=function(n,t){try{let i=n.children(".webgis-presentation_toc-item-group.webgis-presentation_toc-collapsable[data-ui-groupname='"+t[0]+"']");return t.length===1?i:r(i.children("ul"),t.slice(1))}catch(i){return null}};if(t.names){let u=n.grep(t.names,function(n){return n.split("|").length===1}),f=n.grep(t.names,function(n){return n.split("|").length>1});for(let n in f){let u=f[n].split("|"),e=i.find('.webgis-presentation_toc-title.webgis-presentation_toc-collapsable[data-container="'+webgis.encodeXPathString(u[0])+'"]'),t=r(e.children(".webgis-presentation_toc-content").children("ul"),u.slice(1));if(t&&t.length===1){let n=t.children("ul");n.length===1&&n.css("display")==="none"&&t.children(".webgis-text-ellipsis-pro").trigger("click")}}for(let n in u){let t=i.find('.webgis-presentation_toc-title.webgis-presentation_toc-collapsable[data-container="'+webgis.encodeXPathString(u[n])+'"]');t.hasClass("webgis-expanded")||t.children(".webgis-presentation_toc-title-text").trigger("click")}}},t.exclusive===!0?500:1),i},collapse_all:function(n){s(this,n)},createCustomContainer:function(t){return v(n(this),t)},reorder:function(){u(n(this))}};n.presentationToc={sequence:0,process:function(t,i){let u=t?n(t).closest(".webgis-presentation_toc-holder"):n(".webgis-presentation_toc-holder");if(u.length!==0){let f=u.find(".webgis-presentation_toc-search");f.length>0&&f.webgis_contentsearch("reset");let r=u.get(0)._map;if(r!=null){for(let t=0;t<i.length;t++){let u=n.presentationToc.findItem(r,i[t]);if(u&&u.presentation&&u.item){let n=u.presentation.service.getLayerIdsFromNames(u.presentation.layers);u.item.style==="button"&&u.presentation.service.setServiceVisibility(null)}}for(let t=0;t<i.length;t++){let u=n.presentationToc.findItem(r,i[t]);if(u&&u.presentation&&u.item){let n=u.presentation.service.getLayerIdsFromNames(u.presentation.layers);if(u.item.style==="button")u.presentation.service.setLayerVisibility(n,!0);else if(u.item.style==="checkbox"){let t=u.presentation.service.checkLayerVisibility(n);u.presentation.service.setLayerVisibilityDelayed(n,t!=1)}else if(u.item.style==="optionbox"){let t=u.presentation.service.checkLayerVisibility(n);if(u.presentation.service.setLayerVisibilityDelayed(n,t!=1),u.item.groupstyle==="dropdown")for(let n in r.services){let t=r.services[n];if(t&&t.presentations)for(let n in t.presentations){let i=t.presentations[n];if(i){if(i.id===u.presentation.id)if(i.service&&u.presentation.service){if(i.service.id===u.presentation.service.id)continue}else continue;for(let n in i.items){let r=i.items[n];if(r.style==="optionbox"&&r.groupstyle==="dropdown"&&r.container===u.item.container&&r.name===u.item.name&&(!r.ui_groupname&&!u.item.ui_groupname||r.ui_groupname===u.item.ui_groupname)){let n=t.getLayerIdsFromNames(i.layers);t.setLayerVisibilityDelayed(n,!1)}}}}}}else if(u.item.style==="info"){let n=u.item.metadata;n&&n.length>0&&(n.indexOf("http")!==0&&(n=webgis.globals.portal.baseUrl+n),u.item.metadata_target==="dialog"?webgis.iFrameDialog(n,u.item.metadata_title||u.item.name||"Metadaten"):window.open(n,"_blank"))}}}n.presentationToc.checkItemVisibility();n.presentationToc.checkContainerVisibility()}}},findItem:function(n,t){for(let i in n.services){let r=n.services[i];if(r&&r.presentations)for(let n=0;n<r.presentations.length;n++){let i=r.presentations[n];if(i.items)for(let n=0;n<i.items.length;n++){let r=i.items[n];if(r.id==t)return{presentation:i,item:r}}}}return null},checkItemVisibility:function(t,i,r){r=r||n(".webgis-presentation_toc-holder");let u=n(r);if(u.length!=0){let f=u.get(0)._map;if(f!=null){let e=f.serviceIds();u.find(".webgis-presentation_toc-item").each(function(t,i){let r=n(i);if(r.hasClass("webgis-presentation_toc-basemap-item")||r.hasClass("webgis-presentation_toc-dyncontent-item")||r.hasClass("webgis-presentation_tol-custom-item")){r.removeClass("webgis-display-none").addClass("webgis-display-block");return}let u="none";if(r.hasClass("link-button"))r.prev().hasClass("webgis-display-block")&&(u="block");else if(i.ownerIds)for(let t=0;t<i.ownerIds.length;t++)n.inArray(i.ownerIds[t],e)>=0&&(u="block");u==="block"?r.removeClass("webgis-display-none").addClass("webgis-display-block"):r.removeClass("webgis-display-block").addClass("webgis-display-none")});u.find(".webgis-presentation_toc-collapsable").each(function(t,i){if(!n(i).hasClass("webgis-presentation_toc-custom-container")){let r="none";n(i).find(".webgis-presentation_toc-item").each(function(t,i){n(i).hasClass("webgis-display-block")&&(r="block")});r==="block"?(n(i).removeClass("webgis-display-none").addClass("webgis-display-block"),n(i).find(".webgis-search-content").addClass("active")):(n(i).removeClass("webgis-display-block").addClass("webgis-display-none"),n(i).find(".webgis-search-content").removeClass("active"))}});u.find(".webgis-presentation_toc-checkable").each(function(t,i){if(i.presIds)for(let t=0;t<i.presIds.length;t++){let r=n.presentationToc.findItem(f,i.presIds[t]);if(r&&r.presentation){let f=r.presentation.service.getLayerIdsFromNames(r.presentation.layers),e=r.presentation.service.checkLayerVisibility(f),t=n(i).hasClass("optionbox")?"option":"check",u=webgis.css.imgResource(t+"0.png","toc");switch(e){case 1:u=webgis.css.imgResource(t+"1.png","toc");break;case-1:u=webgis.css.imgResource(t+"01.png","toc")}n(i).find(".webgis-presentation_toc-checkable-icon").attr("src",u)}}})}}},checkItemScaleVisibility:function(t,i,r){r=r||n(".webgis-presentation_toc-holder");let u=n(r);if(u.length!==0){let f=i.crsScale();u.find(".webgis-scaledependent").removeClass("webgis-outofscale").removeClass("webgis-inscale").each(function(t,r){let u=n(r);if(r.presIds&&r.presIds.length>0)for(let t=0,e=r.presIds.length;t<e;t++){let e=n.presentationToc.findItem(i,r.presIds[t]);if(e&&e.presentation){if(u.hasClass("webgis-inscale"))return;let n=e.presentation.service.getLayerIdsFromNames(e.presentation.layers),t=n.length==0;for(let i in n)t=t||e.presentation.service.layerInScale(n[i],f);t?u.removeClass("webgis-outofscale").addClass("webgis-inscale"):u.addClass("webgis-outofscale").removeClass("webgis-inscale")}}});u.find(".webgis-presentation_toc-item-group.webgis-presentation_toc-collapsable").each(function(t,i){let r=n(i),u=r.find(".webgis-presentation_toc-item").length,f=r.find(".webgis-presentation_toc-item.webgis-outofscale").length;u>0&&u==f?r.addClass("webgis-outofscale"):r.removeClass("webgis-outofscale")})}},checkContainerVisibility:function(t){let r=n(t||n(".webgis-presentation_toc-holder"));if(r.length!==0&&r.get(0)._map!=null){let i=r.get(0)._map;r.find(".webgis-presentation_toc-collapsable").each(function(t,r){let u=n(r),f=!1;if(u.hasClass("webgis-basemap-toc-container"))f=i.currentBasemapServiceId()||i.currentBasemapOverlayServiceIds().length>0?!0:!1;else if(u.hasClass("webgis-dynamiccontent-toc-container"))f=i.hasCurrentDynamicContent()&&i.isCurrentDynamicContentFromTocTheme()===!1;else if(u.hasClass("webgis-presentation_toc-custom-container"))f=!0;else{let r=!0,t=0,e=0;if(u.find(".webgis-presentation_toc-item").each(function(u,o){let s=n(o);if(s.hasClass("checkbox")||s.hasClass("link-button")||(r=!1),i.hasCurrentDynamicContent()&&s.hasClass("webgis-presentation_toc-dyncontent-item")){let n=s.data("dynamic-content");n&&i.getCurrentDynamicContentId()==n.id&&(f=!0)}else if(o.presIds)for(let r=0;r<o.presIds.length;r++){let u=n.presentationToc.findItem(i,o.presIds[r]);if(u&&u.presentation&&u.item&&u.item.visible_with_service===!0){let n=u.presentation.service.getLayerIdsFromNames(u.presentation.layers),i=u.presentation.service.checkLayerVisibility(n);i?(f=!0,t++):e++}}}),webgis.usability.makePresentationTocGroupCheckboxes===!0&&r===!0){u.addClass("checkbox");t>0&&e===0?u.data("checkbox-state","check1"):t>0?u.data("checkbox-state","check01"):u.data("checkbox-state","check0");let n=u.children("div").children(".webgis-presentation_toc-item-group-checkbox");n.length===1&&n.css("background-image","url("+webgis.css.imgResource(u.data("checkbox-state")+".png","toc")+")")}else u.removeClass("checkbox")}f===!1?u.removeClass("webgis-toc-visbile-container").removeClass("loading").addClass("webgis-toc-invisible-container"):u.removeClass("webgis-toc-invisible-container").addClass("webgis-toc-visible-container")})}},showLegend:function(t,i,r,u,f,e,o){t&&n(t).addClass("webgis-loading");let s=[],c=[],h=!1;for(let n in r)r[n].isWatermark()||s.push(n);s=s.reverse();for(let n in s)c[s[n]]=r[s[n]],h|=r[s[n]].hasLegend();r=c;webgis.delayed(function(){let s=function(u){u.addClass("webgis-legend-pro-content");let v=n("<table>").css("width","100%").addClass("webgis-modal-content-fill").appendTo(u),c=n("<tr>").css("white-space","nowrap").appendTo(v);h&&n("<td>").text(webgis.l10n.get("legend")).addClass("webgis-tab-header").attr("data-tab","0").attr("data-name","legend").appendTo(c);n("<td>").text(webgis.l10n.get("layers")).addClass("webgis-tab-header").attr("data-tab","1").attr("data-name","themes").appendTo(c);n("<td>").text(webgis.l10n.get("info-and-copyright")).addClass("webgis-tab-header").attr("data-tab","2").attr("data-name","copyright").appendTo(c);let y=n("<td><\/td>").addClass("webgis-tab-header").appendTo(c).click(function(t){t.stopPropagation();n("body").webgis_mapProperties({map:i})});if(n("<img>").attr("src",webgis.css.imgResource("admin-26.png","ui")).appendTo(y),h){let t=n("<div class='webgis-tab-content webgis-legend-tab-content'>").css("display","none").attr("data-tab",0).data("services",r).appendTo(u);t.data("refresh",function(t){let i=t.empty().data("services"),r=0;for(let u in i){let f=i[u];if(f&&f.isBasemap!==!0&&f.hasLegend()!==!1&&f.hasVisibleLegendInScale()!==!1){let e=webgis.guid();r++;n("<h2><\/h2>").text(f.name).appendTo(t);let o=n("<div id='"+e+"'><\/div>").css("display","none").appendTo(t);webgis.ajax({url:f.getLegendUrl(!0)+"&requestid="+e,type:"post",data:f.getLegendPostData(),success:function(t){if(t&&t.requestid&&t.url){let i=n("#"+t.requestid);n("<img src='"+t.url+"' />").appendTo(i);i.css("display","")}}})}}r===0&&n("<div>").text(webgis.l10n.get("info-no-legend")).addClass("webgis-info").appendTo(t)});t.data("refresh")(t)}let s=n("<div class='webgis-tab-content webgis-themes-tab-content'>").css("display","none").attr("data-tab",1).data("services",r).appendTo(u);n.fn.webgis_contentsearch&&n("<div><\/div>").appendTo(s).webgis_contentsearch({placeholder:webgis.l10n.get("find-layers"),container_selectors:["li","ul",".webgis-service-toc-container"],onChanged:function(t){n(t).find("ul.toc").find("ul").each(function(t,i){let r=n(i);if(r.find(".webgis-search-content.active").length>0){let t=!1;r.find(".webgis-search-content.active").each(function(i,r){t|=n(r).closest("li").css("display")!=="none"});r.parent().css("display",t?"":"none")}})},onReset:function(t){n(t).find("li.webgis-services_toc-item.group").css("display","block")}});s.data("checkItemVisibility",function(t,i){i=i||n(".webgis-services_toc-holder");let r=n(i);r.find(".webgis-services_toc-item").each(function(i,r){if(r.layers&&r.layers.length!==0){r.layers[0].visible?n(r).find(".webgis-service_toc-checkable-icon").attr("src",webgis.css.imgResource("check1.png","toc")).addClass("webgis-checked"):n(r).find(".webgis-service_toc-checkable-icon").attr("src",webgis.css.imgResource("check0.png","toc")).removeClass("webgis-checked");let u=!1;for(let n in r.layers){let f=t.map.scale(),i=r.layers[n];i.minscale>0||i.maxscale>0?i.maxscale>0&&f>i.maxscale||i.minscale>0&&f<i.minscale||(u=!0):u=!0}u?n(r).removeClass("webgis-outofscale"):n(r).addClass("webgis-outofscale")}})});s.data("refresh",function(t){t.children(".webgis-service-toc-container").each(function(i,r){n(r).children("ul.toc").each(function(i,r){let u=r.service;t.data("checkItemVisibility")(u,n(r))})})});for(let t in r){let u=r[t];if(u.isBasemap!==!0&&u.showInToc!==!1){let o=n("<div>").addClass("webgis-service-toc-container").appendTo(s);n("<h2><\/h2>").text(u.name+"...").addClass("webgis-context-clickable").appendTo(o).click(function(){n(this).next().css("display",n(this).next().css("display")==="none"?"":"none")});let f=n("<li class='webgis-presentation_toc-basemap-opacity'><\/li>").css({margin:"0px",display:e===!0?"block":"none"}).appendTo(o);n("<div>").addClass("webgis-presentation_toc-menu-item").text(webgis.l10n.get("remove-service")).css("background-image","url("+webgis.css.imgResource("remove.png","tools")+")").data("serviceId",u.id).appendTo(f).click(function(){let t=n(this);webgis.confirm({message:webgis.l10n.get("confirm-remove-service"),cancelText:webgis.l10n.get("confirm-remove-service-cancel"),okText:webgis.l10n.get("confirm-remove-service-ok"),onOk:function(){i.removeServices([t.data("serviceId")]);t.closest(".webgis-service-toc-container").remove()}})});n("<div>").addClass("webgis-presentation_toc-menu-item").text(webgis.l10n.get("service-order")+"..").css("background-image","url("+webgis.css.imgResource("rest/toolresource/webgis-tools-serviceorder-service_order","tools")+")").data("serviceId",u.id).appendTo(f).click(function(){let t=n(this);webgis.modalDialog(webgis.l10n.get("service-order"),function(n){n.webgis_serviceOrder({map:i,selected:t.data("serviceId")})})});let c=n("<div>").addClass("webgis-presentation_toc-menu-item noicon nohover").addClass("webgis-presentation_toc-basemap-opacity-title").text(webgis.l10n.get("focus-service")).appendTo(f);n("<div>").appendTo(c).webgis_focusservice_control({service:u});let l=n("<div>").addClass("webgis-presentation_toc-menu-item noicon nohover").addClass("webgis-presentation_toc-basemap-opacity-title").text(webgis.l10n.get("opacity")).appendTo(f);n("<div>").appendTo(l).webgis_opacity_control({service:u});let h=n("<ul>").addClass("none").addClass("toc").appendTo(o);h.get(0).service=u;let a=u.map.scale();for(let t=0,i=u.layers.length;t<i;t++){let r=u.layers[t];if(!r.locked&&!r.tochidden){let e=(r.undropdownable_groupname||r.tocname||r.name).split("\\"),o=e[e.length-1],f=h;if(e.length>1)for(let t=0;t<e.length-1;t++){let i=e[t],r=f.children("li[data-path='"+i+"']").children("ul");if(r.length===0){let t=n("<li data-path='"+i+"'><i>"+i+"<\/i><\/li>").addClass("webgis-services_toc-item group collapsed").appendTo(f).click(function(t){t.stopPropagation();let i=n(this);i.toggleClass("collapsed");i.children("ul").css("display",i.hasClass("collapsed")?"none":"block")});f=n("<ul>").addClass("none").css({paddingLeft:0,display:"none"}).appendTo(t)}else f=r}let i=null;f.children("li.webgis-services_toc-item.webgis-services_toc-checkable").each(function(t,r){let u=n(r);u.data("toc-name")===o&&(i=u)});i==null&&(i=n("<li class='webgis-services_toc-item webgis-services_toc-checkable'><\/li>").data("toc-name",o).appendTo(f),n("<span class='webgis-search-content active'><img class='webgis-service_toc-checkable-icon' />&nbsp;"+webgis.encodeHtmlString(o)+"<\/span>").appendTo(i));i.get(0).layers=i.get(0).layers||[];i.get(0).layers.push(r);i.get(0).layers.length===1&&i.click(function(t){t.stopPropagation();let i=n(this).closest(".toc"),r=i.get(0).service,u=this.layers;if(r&&u){let t=n.map(u,function(n){return n.id});r.setLayerVisibilityDelayed(t,!n(this).find(".webgis-service_toc-checkable-icon").hasClass("webgis-checked"));i.closest(".webgis-themes-tab-content").data("checkItemVisibility")(r,i)}})}}}}s.data("refresh")(s);let o=n("<div class='webgis-tab-content'>").css("display","none").attr("data-tab",2).appendTo(u),l=0,a=i.getMapDescription(!0);a&&(l++,n("<p>").html(webgis.simpleMarkdown.render(a)).appendTo(o));for(let t in r){let u=r[t];if(u.metadata_link||u.servicedescription||u.copyrighttext||u.copyrightId){if(l++,n("<h2><\/h2>").text(u.name).appendTo(o),u.metadata_link){let t=n("<div>").addClass("webgis-service-metadata-link").appendTo(o);n("<a>").attr("href",u.metadata_link).attr("target","_blank").text(webgis.l10n.get("metadata-link")).appendTo(t)}if(u.servicedescription){let t=n("<div><\/div>").addClass("webgis-service-description").appendTo(o);u.servicedescription.indexOf("md:")===0?n("<p>").html(webgis.asMarkdownOrText(u.servicedescription)).appendTo(t):(n.each(u.servicedescription.split("\n"),function(i,r){n("<p>").text(r).appendTo(t)}),n.fn.webgis_collapsable_paragraph&&t.webgis_collapsable_paragraph())}if(u.copyrighttext){let t=n("<div><\/div>").addClass("webgis-service-copyrighttext").appendTo(o);n.each(u.copyrighttext.split("\n"),function(i,r){n("<p>").text(r).appendTo(t)});n.fn.webgis_collapsable_paragraph&&t.webgis_collapsable_paragraph()}else if(u.copyrightId){let t=i.getCopyright(u.copyrightId);if(t){let i=n("<div><\/div>").text(u.copyrighttext).addClass("webgis-service-copyrighttext").appendTo(o);t.logo&&n("<img src='"+t.logo+"' />").css("width",t.logo_size&&t.logo_size.length===2?t.logo_size[0]:"auto").css("height",t.logo_size&&t.logo_size.length===2?t.logo_size[1]:"auto");n("<strong><\/strong>").text(t.copyright).appendTo(i);n("<p><\/p>").text(t.advice).appendTo(i);t.link&&n("<a href='"+t.link+"' target='_blank'>").text(t.link_text||t.text).appendTo(i);n.fn.webgis_collapsable_paragraph&&i.webgis_collapsable_paragraph()}}}}l===0&&n("<div>Für die gewählten Dienste sind keine Copyright Information oder Beschreibungen vorhanden.<\/div>").addClass("webgis-info").appendTo(o);u.find(".webgis-tab-header[data-tab]").click(function(t){t.stopPropagation();let i=n(this);i.parent().children(".webgis-tab-header").removeClass("selected");i.addClass("selected");i.closest(".webgis-modal-content").find(".webgis-tab-content").css("display","none");i.closest(".webgis-modal-content").find(".webgis-tab-content[data-tab="+i.attr("data-tab")+"]").css("display","block").find(".webgis-content-search-holder input").first().focus()});f?u.find(".webgis-tab-header[data-tab="+f+"]").trigger("click"):u.find(".webgis-tab-header:first").trigger("click");t&&n(t).removeClass("webgis-loading")};n("body").webgis_modal({id:"webgis-legend",title:u+":",onload:function(n){s(n);o&&o(n)},dock:"left",width:"400px",minWidth:"400px",hasBlocker:!1,animate:!1})},1)},hideLegend:function(){n(null).webgis_modal("close",{id:"webgis-legend"})},refreshLegend:function(){let t=n(".webgis-legend-pro-content");if(t.length>0){let n=t.children(".webgis-tab-content.webgis-legend-tab-content");n.length>0&&n.data("refresh")(n);let i=t.children(".webgis-tab-content.webgis-themes-tab-content");i.length>0&&i.data("refresh")(i)}},_calcDataOrderByServiceOrder:function(n){return n?999999-n.getOrder():0}};let c=function(t,u){let f=n(t);t._map=u.map;f.addClass("webgis-presentation_toc-holder");webgis.usability.presentationTocSearch===!0&&n.fn.webgis_contentsearch&&n("<div><\/div>").addClass("webgis-presentation_toc-search").appendTo(f).webgis_contentsearch({placeholder:"Inhalte filtern...",container_selectors:["li","ul",".webgis-presentation_toc-content",".webgis-search-content-container"]});let e=n("<ul id='webgis-presentation_toc-list'><\/ul>");if(e.appendTo(f),u.map!=null){if(u.map.dynamicContent&&u.map.dynamicContent.length>0)for(let n in u.map.dynamicContent){let i=u.map.dynamicContent[n];r({},i,t)}for(let n in u.map.services){let r=u.map.services[n];i({},r,t)}}u.gdi_button===!0&&n("<button><\/button>").text(webgis.l10n.get("add-services")+"...").addClass("webgis-button light").addClass("webgis-add-service-button").addClass("webgis-search-content-alt-text").attr("data-content-search-alt-text",webgis.l10n.get("search-in-services")).attr("data-content-search-text",webgis.l10n.get("add-services")).appendTo(f).click(function(){let t=this.parentNode._map,i=n(this);n("body").webgis_modal({title:webgis.l10n.get("add-services"),onload:function(n){n.css("padding","0px");n.webgis_addServicesToc({map:t,searchTag:i.attr("data-search-tag"),allowCustomServices:webgis.usability.allowAddCustomServices===!0})},onclose:function(){n.fn.webgis_contentsearch&&n(".webgis-content-search-holder").webgis_contentsearch("trigger",{})}})});t._map.events.on("onaddservice",i,t);t._map.events.on("onremoveservice",a,t);t._map.events.on("onadddynamiccontent",r,t);t._map.events.on("refresh",n.presentationToc.checkItemScaleVisibility,t);t._map.events.on("refresh",n.presentationToc.refreshLegend,t);t._map.events.on("onbuildtoolui",n.presentationToc.hideLegend,t);t._map.events.on("showhourglass_guids",function(t,i,r){f.find(".webgis-presentation_toc-title, .webgis-presentation_toc-item-group").each(function(t,i){let u=n(i);if(!u.hasClass("webgis-toc-invisible-container")){let t=u.data("serviceGuids"),i=!1;if(t&&t.length>0){for(let u in r)i|=n.inArray(r[u],t)>=0;i?u.addClass("loading"):u.removeClass("loading")}}})});t._map.events.on("hidehourglass_guids",function(){f.find(".webgis-presentation_toc-title, .webgis-presentation_toc-item-group").each(function(t,i){let r=n(i),u=r.data("serviceGuids");u&&r.removeClass("loading")})});t._map.events.on("refresh-toc-checkboxes",function(t,i,r){n.presentationToc.checkItemVisibility(t,i,r);n.presentationToc.checkContainerVisibility(this)},t)},i=function(t,i,r){if(console.log("addService",i.name),r=r||this,i!=null&&i.map!=null){if(i.isBasemap)return l(t,i,r);if(i.presentations!=null&&i.presentations.length!=0){const h=n(r),s=h.children("#webgis-presentation_toc-list");for(let t=0;t<i.presentations.length;t++){let u=n.presentationToc.sequence++,r=i.presentations[t];r.sequenceId=u;for(let t=0;t<r.items.length;t++){let h=r.items[t],k=n.presentationToc.sequence++;h.id=k;let l=null,w=null;if(s.find(".webgis-presentation_toc-title-text").each(function(t,i){n(i).text()==h.container&&(l=n(i.parentNode))}),l==null){l=n("<li><\/li>").addClass("webgis-presentation_toc-title webgis-presentation_toc-collapsable webgis-search-content-container").attr("data-container",h.container).attr("id",u);webgis.usability.orderPresentationTocContainsByServiceOrder===!0?(console.log("data-order",i.name,i.getOrder()),l.attr("data-order",n.presentationToc._calcDataOrderByServiceOrder(i))):h.container_order&&l.attr("data-order",h.container_order);l.data("serviceGuids",[]).appendTo(s);const e=l.get(0);n("<span style='position:absolute' class='webgis-presentation_toc-plus webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(l).click(function(t){t.stopPropagation();n(this).parent().find(".webgis-presentation_toc-title-text").first().trigger("click")});n("<div class='webgis-presentation_toc-title-text webgis-search-content webgis-text-ellipsis-pro check-for-title'><\/div>").text(h.container).click(function(t){l=n(this.parentNode);t.stopPropagation();f(this,!0)&&n(this.parentNode).removeClass("webgis-expanded");n(this.parentNode).hasClass("webgis-expanded")?(l.removeClass("webgis-expanded"),l.children(".webgis-presentation_toc-content").slideUp().find(".webgis-presentation_toc-item").addClass("webgis-presentation_toc-hidden"),l.children(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s")):(l.closest("ul").find(".webgis-expanded").removeClass("webgis-expanded").find(".webgis-presentation_toc-content").slideUp().find(".webgis-presentation_toc-item").addClass("webgis-presentation_toc-hidden"),l.closest("ul").find(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),l.addClass("webgis-expanded"),l.children(".webgis-presentation_toc-content").slideDown().find(".webgis-presentation_toc-item").removeClass("webgis-presentation_toc-hidden"),l.children(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e"))}).appendTo(l);const t=function(t){let r=t.closest(".webgis-presentation_toc-holder");if(r.length==0)return null;let u=r.get(0)._map,i=null;return t.closest(".webgis-presentation_toc-title").find(".webgis-presentation_toc-item").each(function(t,r){if(r.presIds)for(let t in r.presIds){let f=n.presentationToc.findItem(u,r.presIds[t]);f&&f.item&&f.item.visible_with_service===!0&&f.presentation&&f.presentation.layers&&f.presentation.layers.length>0&&f.presentation.service&&f.presentation.service&&f.presentation.service.canLegend()&&(i==null&&(i=[]),i[f.presentation.service.id]||(i[f.presentation.service.id]=f.presentation.service))}}),{map:u,services:i}};n("<div class='webgis-presentation_toc-title-legend-icon'><\/div>").attr("title",webgis.l10n.get("legend")).attr("alt",webgis.l10n.get("legend")).appendTo(l).css("background-image","url("+webgis.css.imgResource("legend-24.png","toc")+")").click(function(){let i=t(n(this));i&&i.services!=null?n.presentationToc.showLegend(this,i.map,i.services,n(this).closest(".webgis-presentation_toc-title").find(".webgis-presentation_toc-title-text").html()):webgis.alert(webgis.l10n.get("msg-no-legend-available"),"info")}).contextmenu(function(){let i=t(n(this));return i&&i.services!=null?n.presentationToc.showLegend(this,i.map,i.services,n(this).closest(".webgis-presentation_toc-title").find(".webgis-presentation_toc-title-text").html(),"1",!0):webgis.alert(webgis.l10n.get("msg-no-services-available"),"info"),!1});const r=n("<div class='webgis-presentation_toc-content' style='display:none' id='div_'><\/div>");r.appendTo(l);w=n("<ul style='margin:8px 0px 0px 6px'><\/ul>");w.appendTo(r)}else w=l.find(".webgis-presentation_toc-content").children("ul");h.visible_with_service===!0&&n.inArray(i.guid,l.data("serviceGuids"))<0&&l.data("serviceGuids").push(i.guid);let a=null,c=null,v,p=h.name||r.name,y=null,d=h.groupstyle=="dropdown"&&h.name;if(d){w.find("li.webgis-presentation_toc-item-group.webgis-presentation_toc-collapsable").each(function(t,i){i.groupname&&i.groupname==h.name&&(y=n(i),a=y.children("ul"))});let t=function(){let t=n(this);if(f(this,!0)&&t.children(".webgis-api-icon-triangle-1-e").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),t.children(".webgis-api-icon-triangle-1-e").length>0)t.children(".webgis-api-icon-triangle-1-e").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),t.parent().children("ul").slideUp();else{t.children(".webgis-api-icon-triangle-1-s").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e");t.parent().children("ul").slideDown();let n=t.closest(".webgis-search-content-container");n.hasClass("webgis-expanded")||n.children(".webgis-presentation_toc-title-text").trigger("click")}};if(a==null){y=n("<li><\/li>").addClass("webgis-presentation_toc-item-group webgis-presentation_toc-collapsable").data("serviceGuids",[]).attr("data-ui-groupname",h.name).attr("data-dvid","dvg_"+h.name.toLowerCase().replace(/ /g,"_")).appendTo(w);h.group_order&&y.attr("data-order",h.group_order);y.get(0).groupname=h.name;let i=n("<div class='webgis-text-ellipsis-pro check-for-title'><\/div>").appendTo(y).click(t);n("<span style='position:absolute' class='webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(i);n("<span class='webgis-presentation_toc-item-group-checkbox'><span>").appendTo(i).click(function(n){o(this,n)});n("<span style='margin-left:14px' class='webgis-search-content'>&nbsp;"+webgis.encodeHtmlString(h.name)+"<\/span>").appendTo(i);a=n("<ul style='display:none'><\/ul>").appendTo(y)}if(p=r.name,h.ui_groupname){let i=h.ui_groupname.replaceAll("\\/","&sol;").split("/");for(let r in i){let f=i[r].replaceAll("&sol;","/"),u=a.children("li[data-ui-groupname='"+f+"']");if(u.length===0){u=n("<li><\/li>").addClass("webgis-presentation_toc-item-group webgis-presentation_toc-collapsable").data("serviceGuids",[]).attr("data-order",h.item_order).attr("data-ui-groupname",f).appendTo(a);let i=n("<div class='webgis-text-ellipsis-pro check-for-title'><\/div>").appendTo(u).click(t);n("<span style='position:absolute' class='webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(i);n("<span class='webgis-presentation_toc-item-group-checkbox'><span>").appendTo(i).click(function(n){o(this,n)});n("<span style='margin-left:14px' class='webgis-search-content'>&nbsp;"+webgis.encodeHtmlString(f)+"<\/span>").appendTo(i);a=n("<ul style='display:none'><\/ul>").appendTo(u)}else a=u.children("ul")}}}else a=w;h.visible_with_service===!0&&a.parent().hasClass("webgis-presentation_toc-item-group")&&a.parent().data("serviceGuids")&&n.inArray(i.guid,a.parent().data("serviceGuids"))<0&&a.parent().data("serviceGuids").push(i.guid);let g=h.style!=="info"&&(h.group_metadata||h.metadata)&&h.metadata_button_style=="i_button";if(h.group_metadata&&y!=null&&y.find(".webgis-api-icon.webgis-api-icon-info").length===0&&n("<span style='position:absolute;left:5px;' class='webgis-api-icon webgis-api-icon-info'><\/span>").prependTo(y.children("div")).data("metadata",h.group_metadata).data("metadata_target",h.group_metadata_target).attr("title",h.group_metadata_title).click(function(t){t.stopPropagation();e(n(this))}),a.find("li").each(function(t,i){i.groupname==p&&(v=i,c=n(i))}),c==null){let u=!1;if(r.items)for(let n in r.items)if(r.items[n].name){u=!0;break}let t=a.closest(".webgis-presentation_toc-item-group").attr("data-dvid");if(t=t?t+"/"+r.id:u?"dvg_"+p.toLowerCase().replace(/ /g,"_"):r.id,c=n("<li class='webgis-presentation_toc-item webgis-scaledependent'><\/li>").addClass("webgis-text-ellipsis-pro check-for-title").attr("data-dvid",t),d&&h.item_order?c.attr("data-order",h.item_order):h.group_order&&c.attr("data-order",h.group_order),c.appendTo(a),v=c.get(0),v.groupname=p,v.presIds=[],v.ownerIds=[],h.style==="checkbox"){c.addClass("webgis-presentation_toc-checkable checkbox");let t="<img class='webgis-presentation_toc-checkable-icon' src="+webgis.css.imgResource("check0.png","toc")+">";n("<span class='webgis-search-content'>"+t+"&nbsp;<span class='webgis-text-span nowrap'>"+webgis.encodeHtmlString(p)+"<\/span><\/span>").appendTo(c);c.click(function(){n.presentationToc.process(this,this.presIds,!0)})}else if(h.style==="optionbox"){c.addClass("webgis-presentation_toc-checkable optionbox");let t="<img class='webgis-presentation_toc-checkable-icon' src="+webgis.css.imgResource("option0.png","toc")+">";n("<span class='webgis-search-content'>"+t+"&nbsp;<span class='webgis-text-span nowrap'>"+webgis.encodeHtmlString(p)+"<span><\/span>").appendTo(c);c.click(function(){n.presentationToc.process(this,this.presIds,!0)})}else if(h.style==="dynamiccontentmarker"){let t=i.getLayerIdsFromNames(r.layers).length===1?i.getQueryByLayerId(i.getLayerIdsFromNames(r.layers)[0]):null;if(t){let u=webgis.guid();c.attr("id",u).addClass("webgis-presentation_toc-dyncontent-item").data("map",i.map).data("dynamic-content",{fromTocTheme:!0,autoZoom:!1,extentDependend:!0,id:u,name:r.name,suppressAutoLoad:!0,suppressShowResult:!0,type:"api-query",url:webgis.baseUrl+"/rest/services/"+i.id+"/queries/"+t.id+"/query?f=json&"}).click(function(t){t.stopPropagation();let i=n(this).data("map"),r=n(this).data("dynamic-content");if(n(this).hasClass("webgis-presentation_toc-dyncontent-item-selected")){let t=n.webgis_search_result_histories[i]!=null&&n.webgis_search_result_histories[i].count()>0;i.queryResultFeatures.clear(t);i.getSelection("selection").remove();i.getSelection("query").remove();n(this).removeClass("webgis-presentation_toc-dyncontent-item-selected");i.unloadDynamicContent()}else i.addDynamicContent([r]),i.loadDynamicContent(i.getDynamicContent(r.id))});n("<span class='webgis-text-span nowrap'><span>").text(p).appendTo(c);t.apply_zoom_limits!==!0&&c.removeClass("webgis-scaledependent")}else c.remove()}else{let t="<img class='toc-icon' src="+webgis.css.imgResource(h.style==="info"?"info-26.png":"layers-16.png","toc")+">";n("<span class='webgis-search-content'>"+t+"&nbsp;<span class='webgis-text-span nowrap'>"+webgis.encodeHtmlString(p)+"<span><\/span>").appendTo(c);c.click(function(){let t=n.presentationToc.process(this,this.presIds)})}}if(v.presIds=v.presIds||[],v.ownerIds=v.ownerIds||[],v.presIds.push(k),h.visible_with_service==!0&&v.ownerIds.push(i.id),h.visible_with_one_of_services!=null&&h.visible_with_one_of_services.length>0)for(let n in h.visible_with_one_of_services)v.ownerIds.push(h.visible_with_one_of_services[n]);let b=h.groupstyle&&h.groupstyle!=="dropdown"?"group_":"";if(h.style!=="info"&&h[b+"metadata"]&&c.find(".webgis-api-icon.webgis-api-icon-info").length===0&&c.next(".webgis-presentation_toc-item.link-button").length===0){let t=n("<span><\/span>").data("metadata",h[b+"metadata"]).data("metadata_target",h[b+"metadata_target"]).data("metadata_title",h[b+"metadata_title"]);switch(h[b+"metadata_button_style"]){case"link_button":let i=n("<li>").addClass("webgis-presentation_toc-item link-button").attr("data-order",c.attr("data-order")).appendTo(c.parent());t.addClass("webgis-button").text(h[b+"metadata_title"]).appendTo(i);break;default:g=!0;t.css({position:"absolute",left:"26px",marginTop:"2px"}).addClass("webgis-api-icon webgis-api-icon-info").prependTo(c).attr("title",h.metadata_title)}t.click(function(t){t.stopPropagation();e(n(this))})}g===!0&&c.children(".webgis-search-content").children(".webgis-text-span").css("paddingLeft","16px");h.visible===!1&&c.addClass("webgis-visibility-never");h.client_visibility&&c.addClass("webgis-visibility-client-"+h.client_visibility)}}n.presentationToc.checkItemVisibility(null,i,r);n.presentationToc.checkItemScaleVisibility(null,i.map,r);n.presentationToc.checkContainerVisibility(r);i.events.on(["onchangevisibility","onchangevisibility-delayed"],function(){n.presentationToc.checkItemVisibility();n.presentationToc.checkContainerVisibility()},r);u(r);webgis.addTitleToEllipsis()}}},r=function(t,i,r){if((r=r||this,i!=null&&i.map!=null)&&!(n(i.map._webgisContainer).find("#"+i.id+".webgis-presentation_toc-dyncontent-item").length>0)){let h=n(r),e=h.children("#webgis-presentation_toc-list"),u=null,f=null,o=null,s=webgis.l10n.get("dynamic-content");if(e.find(".webgis-presentation_toc-title-text").each(function(t,i){n(i).text()==s&&(u=n(i.parentNode))}),u==null){let o=n.presentationToc.sequence++;u=n("<li><\/li>").addClass("webgis-presentation_toc-title webgis-presentation_toc-collapsable webgis-dynamiccontent-toc-container").attr("data-container","__dynamic-content").attr("id",o);u.attr("data-order",0);u.prependTo(e);n("<span style='position:absolute' class='webgis-presentation_toc-plus webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(u).click(function(t){t.stopPropagation();n(this).parent().find(".webgis-presentation_toc-title-text").first().trigger("click")});n("<div class='webgis-presentation_toc-title-text'><\/div>").text(s).click(function(t){u=n(this.parentNode);t.stopPropagation();n(this.parentNode).hasClass("webgis-expanded")?(u.removeClass("webgis-expanded"),u.children(".webgis-presentation_toc-content").slideUp().find(".webgis-presentation_toc-item").addClass("webgis-presentation_toc-hidden"),u.children(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s")):(u.closest("ul").find(".webgis-expanded").removeClass("webgis-expanded").find(".webgis-presentation_toc-content").slideUp().find(".webgis-presentation_toc-item").addClass("webgis-presentation_toc-hidden"),u.closest("ul").find(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),u.addClass("webgis-expanded"),u.children(".webgis-presentation_toc-content").slideDown().find(".webgis-presentation_toc-item").removeClass("webgis-presentation_toc-hidden").each(function(t,i){let r=n(i).data("resetPreview");r&&r.apply(n(i))}),u.children(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e"))}).appendTo(u);let t=n("<div class='webgis-presentation_toc-content' style='display:none;white-space:normal;overflow:hidden' id='div_'><\/div>");t.appendTo(u);f=n("<ul style='margin:8px 0px 0px 0px;'><\/ul>");f.appendTo(t);i.map.events.on("onloaddynamiccontent",function(){n.presentationToc.checkContainerVisibility(this)},r)}else f=u.find(".webgis-presentation_toc-content").children("ul");o=n("<li id='"+i.id+"' class='webgis-presentation_toc-item webgis-presentation_toc-dyncontent-item'><\/li>").appendTo(f).data("dynamic-content",i).click(function(){let t=n(this).data("dynamic-content");if(n(this).hasClass("webgis-presentation_toc-dyncontent-item-selected")){let i=n(t.map.ui.webgisContainer()).find(".webgis-search-result-list").closest(".webgis-search-result-holder"),r=n.webgis_search_result_histories[t.map]!=null&&n.webgis_search_result_histories[t.map].count()>0;t.map.queryResultFeatures.clear(r);t.map.getSelection("selection").remove();i.find(".webgis-search-result-list").webgis_queryResultsList("empty",{map:t.map});i.get(0).search_term="";r?n.webgis_search_result_histories[t.map].render(i.find(".webgis-search-result-list")):t.map.events.fire("hidequeryresults");t.map.getSelection("query").remove();t.map.loadDynamicContent(null)}else t&&t.map.loadDynamicContent(t)});let c=i.map.ui.dynamicContentIcon(i);n("<span class='webgis-search-content'><img class='toc-icon' src="+c+">&nbsp;"+webgis.encodeHtmlString(i.name)+"<\/span>").appendTo(o)}},l=function(t,i,r){let h=n(r),o=h.children("#webgis-presentation_toc-list"),u=null,e=null,f=null,s=webgis.l10n.get("basemaps");if(o.find(".webgis-presentation_toc-title-text").each(function(t,i){n(i).text()==s&&(u=n(i.parentNode))}),u==null){let c=n.presentationToc.sequence++,t=i.map;u=n("<li><\/li>").addClass("webgis-presentation_toc-title webgis-presentation_toc-collapsable webgis-basemap-toc-container").attr("data-container","__basemaps").attr("id",c);u.attr("data-order",0);u.appendTo(o);n("<span style='position:absolute' class='webgis-presentation_toc-plus webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(u).click(function(t){t.stopPropagation();n(this).parent().find(".webgis-presentation_toc-title-text").first().trigger("click")});n("<div class='webgis-presentation_toc-title-text webgis-text-ellipisis-pro check-for-title'><\/div>").text(s).click(function(t){u=n(this.parentNode);t.stopPropagation();n(this.parentNode).hasClass("webgis-expanded")?(u.removeClass("webgis-expanded"),u.children(".webgis-presentation_toc-content").slideUp().find(".webgis-presentation_toc-item").addClass("webgis-presentation_toc-hidden"),u.children(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s")):(u.closest("ul").find(".webgis-expanded").removeClass("webgis-expanded").find(".webgis-presentation_toc-content").slideUp().find(".webgis-presentation_toc-item").addClass("webgis-presentation_toc-hidden"),u.closest("ul").find(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),u.addClass("webgis-expanded"),u.children(".webgis-presentation_toc-content").slideDown().find(".webgis-presentation_toc-item").removeClass("webgis-presentation_toc-hidden").each(function(t,i){let r=n(i).data("resetPreview");r&&r.apply(n(i))}),u.children(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e"))}).appendTo(u);let h=n("<div class='webgis-presentation_toc-content' style='display:none;white-space:normal;overflow:hidden;margin-top:5px' id='div_'><\/div>");h.appendTo(u);e=n("<ul style='margin:8px 0px 0px 0px;'><\/ul>");e.appendTo(h);f=n("<li>").addClass("webgis-no-basemap").addClass("webgis-presentation_toc-item webgis-presentation_toc-basemap-item-block webgis-presentation_toc-basemap-item");f.appendTo(e);f.get(0).map=t;n("<div>").addClass("webgis-presentation_toc-basemap-item-label").text(webgis.l10n.get("no-basemap")).appendTo(n("<div>").addClass("webgis-presentation_toc-basemap-item-img").appendTo(f));f.click(function(){this.map.setBasemap(null);n(this).parent().find(".webgis-presentation_toc-basemap-item-img").removeClass("selected");this.map.setBasemap(null,!0);webgis.useMobileCurrent()&&this.map.events.fire("hidepresentations")});let l=n("<li class='webgis-presentation_toc-basemap-collapse'><\/li>").appendTo(e).click(function(){let t=n(this);t.toggleClass("expanded");o.find("li.webgis-presentation_toc-basemap-item").each(function(i,r){i>=3&&!t.hasClass("expanded")?n(r).css("display","none"):n(r).css("display","")})}),r=n("<li>").addClass("webgis-presentation_toc-basemap-opacity").appendTo(e);n("<div>").addClass("label").text(webgis.l10n.get("opacity")+":").appendTo(r);n("<div>").addClass("buttons").appendTo(r).webgis_opacity_control({service:function(){return t.getService(t.currentBasemapServiceId())||(t.currentBasemapOverlayServiceIds().length>0?t.getService(t.currentBasemapOverlayServiceIds()[0]):null)}});i.map.events.on("basemap_changed",function(t,i){n(this).webgis_opacity_control("refresh");i.ui.refreshUIElements()},r);i.map.events.on("basemap_changed",function(t,i,r){n(this).find(".webgis-presentation_toc-basemap-item").each(function(t,i){r&&r.id===n(i).attr("id")?n(i).children(".webgis-presentation_toc-basemap-item-img").addClass("selected"):n(i).children(".webgis-presentation_toc-basemap-item-img").removeClass("selected")});n(this).find(".webgis-presentation_toc-basemap-overlay").each(function(t,r){n(r).find("img").attr("src",webgis.css.imgResource(i.currentBasemapOverlayServiceIds().includes(n(r).attr("id"))?"check1.png":"check0.png","toc"))});n.presentationToc.checkContainerVisibility()},u)}else e=u.find(".webgis-presentation_toc-content").children("ul");if(i.basemapType==="overlay"){f=n("<li style='width:100%;height:20px;display:none'><\/li>").attr("id",i.id).data("service",i).addClass("webgis-presentation_toc-item webgis-presentation_toc-basemap-item webgis-presentation_toc-basemap-overlay").insertBefore(e.find(".webgis-presentation_toc-basemap-collapse"));let t=i.map.currentBasemapOverlayServiceIds().includes(i.id),r="<img class='toc-icon' src="+webgis.css.imgResource(t?"check1.png":"check0.png","toc")+">";n("<span>"+r+"&nbsp;"+webgis.encodeHtmlString(i.name)+"<\/span>").appendTo(f);f.click(function(){const t=n(this).data("service");t.map.setBasemap(t.id,!0)})}else{f=n("<li>").attr("id",i.id).data("service",i).addClass("webgis-presentation_toc-item webgis-presentation_toc-basemap-item webgis-presentation_toc-basemap-item-block webgis-presentation_toc-hidden").insertBefore(e.find(".webgis-no-basemap"));e.closest(".webgis-presentation_toc-collapsable").hasClass("webgis-expanded")&&f.removeClass("webgis-presentation_toc-hidden");let t=n("<div class='webgis-presentation_toc-basemap-item-img"+(i.map.currentBasemapServiceId()==i.id?" selected":"")+"'><\/div>").appendTo(f);n("<div class='webgis-presentation_toc-basemap-item-label'><\/div>").text(i.name).appendTo(t);f.click(function(){const t=n(this).data("service");t.map.setBasemap(t.id);n(this).parent().find(".webgis-presentation_toc-basemap-item-img").removeClass("selected");n(this).find(".webgis-presentation_toc-basemap-item-img").addClass("selected");webgis.useMobileCurrent()&&t.map.events.fire("hidepresentations");let i=n(this).parent().find(".webgis-presentation_toc-basemap-collapse");i.hasClass("expanded")&&i.trigger("click")});f.data("resetPreview",function(){this.data("resetPreviewTimer").Start()});f.data("resetPreviewTimer",new webgis.timer(function(t){let i=t.data("service");t.hasClass("webgis-presentation_toc-hidden")||t.find(".webgis-presentation_toc-basemap-item-img").each(function(t,r){let u=i.getPreviewUrl({width:n(r).width(),height:n(r).height()});n(r).css("background","url("+u+")")})},300,f));i.map.events.on("refresh",function(){let i=this.data("service"),t=Math.round(i.map.scale());this.data("last-refresh-scale")!==t&&(n(this).data("last-refresh-scale",t),this.data("resetPreview").apply(this))},f);f.hasClass("webgis-presentation_toc-hidden")||webgis.delayed(function(n){n.data("resetPreview").apply(n)},100,f)}o.find("li.webgis-presentation_toc-basemap-item.webgis-presentation_toc-basemap-item-block").each(function(t,i){t>=3&&n(i).css("display","none")});o.find(".webgis-presentation_toc-basemap-collapse").removeClass("expanded")},a=function(t,i,r){if(i.isBasemap){r=r||n(".webgis-presentation_toc-holder");let t=n(r);t.find(".webgis-presentation_toc-basemap-item").each(function(t,r){r.service&&r.service.id==i.id&&n(r).remove()})}n.presentationToc.checkItemVisibility(null,i,r)},u=function(t){let i=n(t);i.find("ul").each(function(t,i){let r=n(i),u=r.children("li").get();u.sort(function(i,r){let u=n(i).attr("data-order"),f=n(r).attr("data-order");return!u&&!f?t==0?n(i).text().toUpperCase().localeCompare(n(r).text().toUpperCase()):0:u?f?u==f?0:parseInt(u)<parseInt(f)?-1:1:-1:1});n.each(u,function(n,t){r.append(t)})})},f=function(t,i){let r=t?n(t).closest(".webgis-presentation_toc-holder"):n(".webgis-presentation_toc-holder");return r.hasClass("webgis-content-search-area active")?(i===!0&&r.find(".webgis-presentation_toc-search").webgis_contentsearch("reset"),!0):!1},v=function(t,i){let o=n(t),e=o.children("#webgis-presentation_toc-list"),r=null,u=null,f=i.containerName||"Custom Container";if(e.find(".webgis-presentation_toc-title-text").each(function(t,i){n(i).text()==f&&(r=n(i.parentNode))}),r==null){let i=n.presentationToc.sequence++;r=n("<li><\/li>").addClass("webgis-presentation_toc-title webgis-presentation_toc-collapsable webgis-presentation_toc-custom-container").attr("data-container","__custom_"+f).attr("id",i);r.attr("data-order",0);r.prependTo(e);n("<span style='position:absolute' class='webgis-presentation_toc-plus webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(r).click(function(t){t.stopPropagation();n(this).parent().find(".webgis-presentation_toc-title-text").first().trigger("click")});n("<div class='webgis-presentation_toc-title-text'><\/div>").text(f).click(function(t){t.stopPropagation();r=n(this.parentNode);n(this.parentNode).hasClass("webgis-expanded")?(r.removeClass("webgis-expanded"),r.children(".webgis-presentation_toc-content").slideUp().find(".webgis-presentation_toc-item").addClass("webgis-presentation_toc-hidden"),r.children(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s")):(r.closest("ul").find(".webgis-expanded").removeClass("webgis-expanded").find(".webgis-presentation_toc-content").slideUp().find(".webgis-presentation_toc-item").addClass("webgis-presentation_toc-hidden"),r.closest("ul").find(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),r.addClass("webgis-expanded"),r.children(".webgis-presentation_toc-content").slideDown().find(".webgis-presentation_toc-item").removeClass("webgis-presentation_toc-hidden").each(function(t,i){let r=n(i).data("resetPreview");r&&r.apply(n(i))}),r.children(".webgis-presentation_toc-plus").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e"))}).appendTo(r);let t=n("<div class='webgis-presentation_toc-content' style='display:none;white-space:normal;overflow:hidden' id='div_'><\/div>");t.appendTo(r);u=n("<ul style='margin:8px 0px 0px 0px;'><\/ul>");u.appendTo(t)}else u=r.find(".webgis-presentation_toc-content").children("ul");return u},e=function(n){let i=n.closest(".webgis-presentation_toc-holder").get(0)._map,t=webgis.tools.replaceCustomToolUrl(i,n.data("metadata")),r=n.data("metadata_target");switch(r){case"dialog":webgis.iFrameDialog(t,n.data("metadata_title")||"Metadaten");break;default:window.open(t)}},o=function(t,i){i.stopPropagation();let o=n(t),r=o.closest(".webgis-presentation_toc-item-group"),u=r.closest(".webgis-presentation_toc-holder"),f=r.data("checkbox-state"),e=u.length===1?u.get(0)._map:null;console.log(f);r.find(".webgis-presentation_toc-item").each(function(t,i){let r=n(i);if(e&&r.hasClass("checkbox")&&i.presIds)for(let t=0;t<i.presIds.length;t++){let r=n.presentationToc.findItem(e,i.presIds[t]);if(r&&r.presentation&&r.item&&r.item.visible_with_service===!0){let n=r.presentation.service.getLayerIdsFromNames(r.presentation.layers);switch(f){case"check0":case"check01":r.presentation.service.setLayerVisibilityDelayed(n,!0);break;case"check1":r.presentation.service.setLayerVisibilityDelayed(n,!1)}}}});n.presentationToc.checkContainerVisibility(u)},s=function(t){n(t).find(".webgis-presentation_toc-item-group.webgis-presentation_toc-collapsable").each(function(t,i){let r=n(i),u=r.children("ul");u.length===1&&u.css("display")!=="none"&&r.children(".webgis-text-ellipsis-pro").trigger("click")});n(t).find(".webgis-presentation_toc-title.webgis-presentation_toc-collapsable").each(function(t,i){let r=n(i);r.hasClass("webgis-expanded")&&r.children(".webgis-presentation_toc-title-text").trigger("click")})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_serviceOrder=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_serviceOrder");else return t.init.apply(this,arguments)};let i={map:null,opacityValues:[.1,.2,.25,.3,.4,.5,.6,.7,.75,.8,.9,1]},t={init:function(t){let u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})}},r=function(t,i){let e=n(t),o=i.map,u=o.serviceIds();n("<div>").addClass("webgis-info").text(webgis.l10n.get("info-service-order")).appendTo(e);let f=n("<ul>").addClass("webgis-service-order-list").appendTo(e),r=[];for(let n in u){let t=o.getService(u[n]);t&&(webgis.leaflet.tilePane==="overlayPane"||t.type!=="tile")&&(t.isWatermark()||r.push(t))}r.sort(function(n,t){return n.getOrder()-t.getOrder()});r=r.reverse();for(let t in r){let u=r[t],e=n("<li>").addClass("webgis-service-order-item").data("service",u).addClass(u.type).text(u.name).appendTo(f);u.id===i.selected&&e.addClass("selected");let s=n("<div><span>"+webgis.l10n.get("opacity")+":&nbsp;<\/span><\/div>").addClass("opacity-container").appendTo(e),o=n("<select><\/select>").appendTo(s).change(function(){let t=n(this).closest(".webgis-service-order-item").data("service");t.setOpacity(parseFloat(n(this).val()))});for(let t in i.opacityValues)n("<option value='"+i.opacityValues[t].toString()+"'>"+Math.round(i.opacityValues[t]*100)+"%<\/option>").appendTo(o);let h=(Math.round(u.opacity*100)/100).toString();o.val(h)}webgis.require("sortable",function(){let t=Sortable.create(f.get(0),{animation:150,ghostClass:"webgis-sorting",onSort:function(){const t=n(".webgis-presentation_toc-holder");f.find(".webgis-service-order-item").each(function(i,r){let f=n(r).data("service");f.setOrder(u.length*10-i*10);webgis.usability.orderPresentationTocContainsByServiceOrder===!0&&t.find(".webgis-presentation_toc-title").each(function(t,i){let r=n(i);console.log(r.attr("data-container"),r.data("serviceGuids"));const u=r.data("serviceGuids");u&&u.includes(f.guid)&&r.attr("data-order",n.presentationToc._calcDataOrderByServiceOrder(f))})});webgis.usability.orderPresentationTocContainsByServiceOrder===!0&&t.webgis_presentationToc("reorder")}})})}}(webgis.$||jQuery),function(n){"use strict";var i,t;n.fn.webgis_addServicesToc=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_addServicesToc");else return t.init.apply(this,arguments)};i={map:null,searchTag:"",allowCustomServices:!1};t={init:function(t){var r=n(this);return t=n.extend({},i,t),this.each(function(){new f(this,t)})}};n.addServicesToc={checkItems:function(){var t=n(".webgis-addservices_toc-holder"),i;if(t.length!==0&&(i=t.get(0)._map,i!==null)){const r=i.serviceIds();t.find(".webgis-addservices_toc-item").each(function(t,i){const u=n(i);if(u.hasClass("collection")){const n=u.attr("data-serviceids")?u.attr("data-serviceids").split(","):[],t=n.length>0&&n.every(n=>r.includes(n)),i=n.some(n=>r.includes(n));console.log("dataServiceIds",n,t,i);t?u.addClass("selected").removeClass("partly-selected").find(".webgis-addservices_toc-checkable-icon").attr("src",webgis.css.imgResource("check1.png","toc")):i?u.addClass("partly-selected").removeClass("selected").find(".webgis-addservices_toc-checkable-icon").attr("src",webgis.css.imgResource("check1.png","toc")):u.removeClass("selected partly-selected").find(".webgis-addservices_toc-checkable-icon").attr("src",webgis.css.imgResource("check0.png","toc"))}else n.inArray(u.attr("data-serviceid"),r)>=0?u.addClass("selected").find(".webgis-addservices_toc-checkable-icon").attr("src",webgis.css.imgResource("check1.png","toc")):u.removeClass("selected").find(".webgis-addservices_toc-checkable-icon").attr("src",webgis.css.imgResource("check0.png","toc"))})}},process:function(t,i,r){var h=n(".webgis-addservices_toc-holder"),u,c,f,l,e,s,o;if(h.length!==0&&(u=h.get(0)._map,u!=null))if(c=u.serviceIds(),n.inArray(i,c)<0){if(n(t).find(".webgis-addservices_toc-checkable-icon").attr("src",webgis.css.imgResource("loader1.gif","hourglass")),f=webgis.serviceInfo(i),f&&f.services){for(l in f.services)e=f.services[l],e.order=e.order||u.maxServiceInsertOrder(e),console.log("service.order",e.order);for(s=u.addServices(f.services),u.recalcServiceOrder(),o=0;o<s.length;o++)s[o].refresh()}}else r!==!0&&u.removeServices([i])}};var f=function(t,i){var h=n(t),e=i.map,v=e.ui.allowAddServices()===!0,y,p,b,k,tt,c,a,f,d,l;t._map=e;i.map.events.on("onaddservice",n.addServicesToc.checkItems,t);i.map.events.on("onremoveservice",n.addServicesToc.checkItems,t);h.addClass("webgis-addservices_toc-holder");h.html("<img src='"+webgis.css.imgResource("loader1.gif","hourglass")+"' />...");n(t).empty();y="In Diensten suchen...";p=n("<div><\/div>").addClass("webgis-addservices_toc-search-holder").appendTo(h).click(function(){var f="",t=n(this);t.hasClass("initialized")||t.hasClass("loading")||(t.addClass("loading"),t.closest(".webgis-addservices_toc-holder").find(".webgis-addservices_toc-item").each(function(t,i){var r=n(i);r.hasClass("initialized")||r.hasClass("loading")||(r.addClass("loading"),f!==""&&(f+=","),f+=n(i).attr("data-serviceid"))}),r(h,f,function(){t.removeClass("loading").addClass("initialized");t.empty();t.webgis_contentsearch({searchTag:i.searchTag,placeholder:y,displayMachted:"inline-block",container_selectors:["li","ul",".webgis-addservices_toc-content"],onMatch:function(t,i,r){var e=i.children(".webgis-addservices_toc-item-text"),h=e.children(".title").html(),c=e.children(".description").html(),l=e.children(".elements").html(),f=i.children(".webgis-addservices_toc-item-info").empty(),a=r.split(" "),o;h&&n("<h3>").addClass("highlightable").html(h).appendTo(f);c&&n("<p>").addClass("highlightable").html(c).appendTo(f);l&&(o=n("<p>").html(l).appendTo(f));s(f,a);o&&u(o)}});t.find("input").addClass("webgis-input").focus()}))});n("<input placeholder='"+y+"' readonly='readonly' >").addClass("webgis-input").appendTo(p);var w=n("<ul id='webgis-addservices_toc-list'><\/ul>").appendTo(h),g=function(t){t.stopPropagation();var i=n(this);i.hasClass("webgis-expanded")?(i.removeClass("webgis-expanded"),i.children(".webgis-addservices_toc-content").slideUp(),i.children(".webgis-addservices_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s")):(i.closest("ul").find(".webgis-expanded").removeClass("webgis-expanded").find(".webgis-addservices_toc-content").slideUp(),i.closest("ul").find(".webgis-addservices_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),i.addClass("webgis-expanded"),i.children(".webgis-addservices_toc-content").slideDown(),i.children(".webgis-addservices_toc-plus").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e"))},nt=function(t,u){var c,f,o,s,l,e,a;if(u&&i.map&&i.map.addCopyright(u),t){for(c=0;c<t.length;c++)if(f=t[c],!f.supportedCrs||!i.map||!(n.inArray(i.map.crsId(),f.supportedCrs)<0)){const u=f.type==="collection";o=null;s=null;w.find(".webgis-addservices_toc-title-text").each(function(t,i){i.innerHTML===f.container&&(o=n(i.parentNode))});o==null?(o=n("<li>").addClass("webgis-addservices_toc-title webgis-addservices_toc-collapsable").appendTo(w),n("<span style='position:absolute' class='webgis-addservices_toc-plus webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(o),n("<div class='webgis-addservices_toc-title-text'>"+f.container+"<\/div>").appendTo(o),l=n("<div class='webgis-addservices_toc-content tiles' style='display:none' id='div_'><\/div>"),l.appendTo(o),s=n("<ul style='margin:8px 0px 0px 0px'><\/ul>"),s.appendTo(l),o.click(g)):s=o.find(".webgis-addservices_toc-content").children("ul");e=n("<li class='webgis-addservices_toc-item'><\/li>").addClass(f.type).addClass("webgis-search-content active").appendTo(s);e.addClass("webgis-addservices_toc-checkable");n("<div>").addClass("webgis-addservices_toc-item-image").appendTo(e);v&&n("<img class='' src="+webgis.css.imgResource("check0.png","toc")+">").addClass("webgis-addservices_toc-checkable-icon").appendTo(e);n("<div>").addClass("webgis-addservices_toc-item-info").appendTo(e);function y(t){var r=n(t).closest(".webgis-addservices_toc-item"),u=r.closest(".webgis-addservices_toc-holder").find(".webgis-addservices_toc-search-holder").find(".webgis-input"),i;r.hasClass("initialized")&&(i=r.find(".webgis-addservices_toc-item-text"),webgis.modalDialog(i.children(".title").text(),function(t){t.addClass("webgis-service-info");n("<div>").addClass("webgis-service-description").html(i.children(".description").html().highlightText((u.val()||"").split(" "))).appendTo(t);n("<div>").addClass("webgis-service-elements").html(i.children(".elements").html().highlightText((u.val()||"").split(" "))).appendTo(t)},function(){}))}u||n("<div>").addClass("webgis-addservices_toc-info").appendTo(e).click(function(n){n.stopPropagation();y(this)});a=n("<div><\/div>").addClass("webgis-addservices_toc-item-text").appendTo(e);n("<div class='more'>").text("mehr...").appendTo(a).click(function(n){n.stopPropagation();y(this)});n("<div>").addClass("title").text(f.name).appendTo(a);u?e.addClass("collection").attr("data-serviceids",f.childServices?f.childServices.toString():""):e.attr("data-serviceid",f.id);v&&e.click(function(t){t.stopPropagation();const i=n(this);if(i.hasClass("collection")){const t=i.hasClass("partly-selected");for(const r of i.closest(".webgis-addservices_toc-item").attr("data-serviceids").split(","))n.addServicesToc.process(this,r,t===!0)}else n.addServicesToc.process(this,i.closest(".webgis-addservices_toc-item").attr("data-serviceid"));n.fn.webgis_contentsearch&&n(".webgis-content-search-holder").webgis_contentsearch("trigger",{})});e.mouseenter(function(){var t=n(this);t.hasClass("initialized")||t.hasClass("loading")||(t.addClass("loading"),r(h,t.attr("data-serviceid")))})}n.addServicesToc.checkItems();i.searchTag&&p.trigger("click")}};if(v===!0)webgis.serviceInfos(nt,!0);else{b=[];k=e.serviceIds();for(tt in k)c=e.getService(k[tt]),c&&b.push({id:c.id,name:c.serviceInfo.name,type:c.serviceInfo.type,container:e.ui.getMapTitle()});nt(b)}i.allowCustomServices===!0&&(a=n("<li class='webgis-addservices_toc-title webgis-addservices_toc-collapsable'><\/li>").appendTo(w).click(g),n("<span style='position:absolute' class='webgis-addservices_toc-plus webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(a),n("<div class='webgis-addservices_toc-title-text'>Benutzerdefinierte Dienste<\/div>").appendTo(a),f=n("<div class='webgis-addservices_toc-content' style='display:none' id='div_'><\/div>").css("padding","10px").appendTo(a).click(function(n){n.stopPropagation()}),n("<div>").addClass("webgis-label-description show").html(webgis.encodeUntrustedHtml(webgis.l10n.get("description-customservice"),!0)).appendTo(f),f.webgis_general_input({name:"webgis-customservice-url",label:"Dienst Url",placeholder:"Url zum WMS/AGS Dienst...",description:webgis.l10n.get("description-customservice-url"),onInit:function(n,t){t.css({width:"100%",boxSizing:"border-box"})}}),f.webgis_general_input({name:"webgis-customservice-displayname",label:"Anzeigename (optional)",placeholder:"Anzeigename des Dienstes...",description:webgis.l10n.get("description-customservice-displayname")}),f.webgis_general_input({name:"webgis-customservice-user",label:"Security (optional)",placeholder:"Username...",description:webgis.l10n.get("description-customservice-security"),onInit:function(t){n("<input name='webgis-customservice-pwd' type='password'>").attr("placeholder","Passwort").addClass("webgis-input").appendTo(t)}}),n("<br/><br/>").appendTo(f),n("<button>Dienst hinzuf&uuml;gen<\/button>").addClass("webgis-button uibutton").appendTo(f).click(function(){var i=n(this),t=i.parent(),r;i.prop("disabled",!0);d.css("display","none").empty();l.css("display","none").empty();r={url:t.webgis_general_input("val",{name:"webgis-customservice-url"}),displayname:t.webgis_general_input("val",{name:"webgis-customservice-displayname"}),user:t.webgis_general_input("val",{name:"webgis-customservice-user"}),password:t.webgis_general_input("val",{name:"webgis-customservice-pwd"})};o(r,function(n){i.prop("disabled",!1);n.id&&n.name?(e.addServices([n]),e.refresh(),t.webgis_general_input("clear",{name:"webgis-customservice-url"}),t.webgis_general_input("clear",{name:"webgis-customservice-displayname"}),t.webgis_general_input("clear",{name:"webgis-customservice-user"}),t.webgis_general_input("clear",{name:"webgis-customservice-pwd"}),console.log("Dienst "+n.name+" wurde erfolgreich der Karte hinzugefügt"),d.html("Dienst "+n.name+" wurde erfolgreich der Karte hinzugefügt").css("display","block")):(n.exception||n.error?l.text("Error: "+(n.exception||n.error)):l.text("Ein unbekannter Fehler ist aufgetreten"),l.css("display","block"))},function(n){i.prop("disabled",!1);webgis.alert("Unknown Error. Statuscode:"+n.status,"error")})}),n("<br/><br/>").appendTo(f),d=n("<div>").addClass("webgis-info").css("display","none").appendTo(f),l=n("<div>").addClass("webgis-info error").css("display","none").appendTo(f))},e=function(t,i){var y=t.removeClass("loading").addClass("initialized").find(".webgis-addservices_toc-item-text"),s,w,e,l,b,f,a,r,u,k,o,v;n("<div>").addClass("description").text(i.servicedescription).appendTo(y);var h=n("<div>").addClass("elements").appendTo(y),c=t.closest(".webgis-addservices_toc-holder"),p=c&&c.length===1?c.get(0)._map:null;if(p&&(s=p.getService(i.id),s&&s.serviceInfo&&(i=s.serviceInfo)),i.presentations){r=n("<div>").appendTo(h);n("<h3>Darstellungsvarianten<\/h3>").appendTo(r);u=n("<ul>").appendTo(r);for(w in i.presentations)e=i.presentations[w],e.layers&&e.layers.length>0&&(l=n("<li>").appendTo(u),n("<div>").addClass("highlightable title").text(e.name).appendTo(l),n("<div>").addClass("highlightable description").text(e.description).appendTo(l))}if(i.queries){r=n("<div>").appendTo(h);n("<h3>Abfragen<\/h3>").appendTo(r);u=n("<ul>").appendTo(r);for(b in i.queries)f=i.queries[b],a=n("<li>").addClass("webgis-addservices-servicequery"+(f.items&&f.items.length>0?" queryable":"")).attr("data-queryid",f.id).attr("onclick","$._webgis_addServicesToc_handleQueryClick(this, event);return false;").appendTo(u),n("<div>").addClass("highlightable title").text(f.name).appendTo(a),n("<div>").addClass("highlightable description").text(f.description).appendTo(a)}if(i.layers){r=n("<div>").appendTo(h);n("<h3>Layer<\/h3>").appendTo(r);u=n("<ul>").appendTo(r);for(k in i.layers)o=i.layers[k],v=n("<li>").addClass("webgis-addservices-servicelayer"+(o.visible?" visible":"")).attr("data-layerid",o.id).attr("onclick","$._webgis_addServicesToc_handleLayerClick(this, event);return false;").appendTo(u),n("<div>").addClass("highlightable title").text(o.name).appendTo(v),n("<div>").addClass("highlightable description").text(o.description).appendTo(v)}},r=function(n,t,i){webgis.ajax({type:"post",data:webgis.hmac.appendHMACData({ids:t,f:"json"}),url:webgis.baseUrl+"/rest/serviceinfo",success:function(t){var u,r,f;for(u in t.services)r=t.services[u],f=n.find(".webgis-addservices_toc-item[data-serviceid='"+r.id+"']"),e(f,r);i&&i(t)}})},o=function(n,t,i){n.f="json";webgis.ajax({type:"post",data:webgis.hmac.appendHMACData(n),url:webgis.baseUrl+"/rest/customserviceinfo",success:function(n){t&&t(n)},error:i})},u=function(t){t.hasClass("webgis-highlight-text")||t.prop("tagName")==="H3"||(t.find(".webgis-highlight-text").length===0?t.remove():t.children().each(function(t,i){u(n(i))}))},s=function(t,i){t.find(".highlightable").each(function(t,r){n(r).html(n(r).text().highlightText(i))})};n._webgis_addServicesToc_handleLayerClick=function(t,i){var u;i.stopPropagation();var r=n(t),f=r.closest(".webgis-addservices_toc-item"),s=f.closest(".webgis-addservices_toc-holder"),e=s.get(0)._map,h=f.attr("data-serviceid"),c=r.attr("data-layerid"),o=e.getService(h);o&&(u=!r.hasClass("visible"),o.setLayerVisibility([c],u),u?r.addClass("visible"):r.removeClass("visible"),e.events.fire("refresh-toc-checkboxes"))};n._webgis_addServicesToc_handleQueryClick=function(t,i){var f;i.stopPropagation();var u=n(t),e=u.closest(".webgis-addservices_toc-item"),h=e.closest(".webgis-addservices_toc-holder"),o=h.get(0)._map,c=e.attr("data-serviceid"),l=u.attr("data-queryid"),r=n(o._webgisContainer).find(".webgis-detail-search-combo"),s=c+"/queries/"+l;r.find("option[value='"+s+"']").length>0&&(r.val(s),r.trigger("change"),r.closest(".webgis-detail-search-holder").css("display")==="none"&&n(o._webgisContainer).find("#webgis-detail-search-button").trigger("click"));f=u.closest(".webgis-modal");f.length===1&&f.webgis_modal("close")}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_servicesToc=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_servicesToc");else return t.init.apply(this,arguments)};var u={map:null,gdi_button:!1,themes:!1,opacity_slider:!0},t={init:function(t){var i=n(this),t=n.extend({},u,t);return this.each(function(){new f(this,t)})}},f=function(t,r){var u=n(t),s,f,o;t._map=r.map;r.map.events.on("onaddservice",i,t);r.map.events.on("onremoveservice",e,t);if(t.options=r,u.addClass("webgis-services_toc-holder"),s=n("<ul class='webgis-services_toc-list'><\/ul>").appendTo(u),r.map!==null)for(f in r.map.services)o=r.map.services[f],i({},o,t);r.gdi_button==!0&&n("<button>Dienste hinzufügen<\/button>").addClass("webgis-button light").appendTo(u).click(function(){var t=this.parentNode._map;n("body").webgis_modal({title:"Dienst hinzufügen",onload:function(n){n.webgis_addServicesToc({map:t})}})})};n.servicesToc={checkItemVisibility:function(t,i,r){r=r||n(".webgis-services_toc-holder");var u=n(r);u.find(".webgis-services_toc-item").each(function(t,i){i.layer&&(i.layer.visible?n(i).find(".webgis-service_toc-checkable-icon").attr("src",webgis.css.imgResource("check1.png","toc")).addClass("webgis-checked"):n(i).find(".webgis-service_toc-checkable-icon").attr("src",webgis.css.imgResource("check0.png","toc")).removeClass("webgis-checked"))})}};var i=function(t,i,u){var u=u||this,c,f,a,v,l,y,o,p,s,e,h;if(i!=null&&(i.serviceInfo.type==="image"||i.serviceInfo.type==="collection")){if(c=n(u).find(".webgis-services_toc-list"),f=n("<li class='webgis-services_toc-title webgis-services_toc-collapsable'><\/li>"),f.prependTo(c),n("<span style='position:absolute' class='webgis-services_toc-plus webgis-api-icon webgis-api-icon-triangle-1-s'><\/span>").appendTo(f),n("<div class='webgis-services_toc-title-text'>"+i.name+"<\/div>").click(function(t){t.stopPropagation();f=n(this.parentNode);n(this.parentNode).hasClass("webgis-expanded")?(f.removeClass("webgis-expanded"),f.children(".webgis-services_toc-content").slideUp(),f.children(".webgis-services_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s")):(f.closest("ul").find(".webgis-expanded").removeClass("webgis-expanded").find(".webgis-services_toc-content").slideUp(),f.closest("ul").find(".webgis-services_toc-plus").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),f.addClass("webgis-expanded"),f.children(".webgis-services_toc-content").slideDown(),f.children(".webgis-services_toc-plus").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e"))}).appendTo(f),a=n("<div class='webgis-services_toc-content' style='display:none' id='div_'><\/div>").appendTo(f),f.get(0).service=i,v=n("<ul>").appendTo(a),u.options&&u.options.themes)for(l=n("<li class='webgis-services_toc-item-group webgis-services_toc-collapsable'>").appendTo(v),n("<div><span style='position:absolute' class='webgis-api-icon webgis-api-icon-triangle-1-s'><\/span><span style='margin-left:14px'>&nbsp;"+webgis.l10n.get("layers")+"<\/span><\/div>").appendTo(l).click(function(){var t=n(this);t.children(".webgis-api-icon-triangle-1-e").length>0?(t.children(".webgis-api-icon-triangle-1-e").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),t.parent().children("ul").slideUp()):(t.children(".webgis-api-icon-triangle-1-s").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e"),t.parent().children("ul").slideDown())}),y=n("<ul style='display:none'>").appendTo(l),o=0,p=i.layers.length;o<p;o++)(s=i.layers[o],s.locked)||(e=s.name.split("\\"),e=e[e.length-1],h=n("<li class='webgis-services_toc-item webgis-services_toc-checkable'><\/li>").appendTo(y),n("<span><img class='webgis-service_toc-checkable-icon' />&nbsp;"+e+"<\/span>").appendTo(h),h.get(0).layer=s,h.click(function(){var r=n(this).closest(".webgis-services_toc-title"),t,i;r.length==1&&(t=r.get(0).service,i=this.layer,t&&i&&t.setLayerVisibility([i.id],!n(this).find(".webgis-service_toc-checkable-icon").hasClass("webgis-checked")))}));r(i.map,c);n.servicesToc.checkItemVisibility(i,u);i.events.on("onchangevisibility",n.servicesToc.checkItemVisibility,u)}},e=function(t,i,u){var u=u||this,f;i!=null&&(f=n(u).find(".webgis-services_toc-list"),f.find("li").each(function(t,r){r.service&&r.service.id==i.id&&n(r).remove()}),r(i.map,f))},r=function(){}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_hourglass=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_hourglass");else return t.init.apply(this,arguments)};var i={map:null,img:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})}},r=function(t,i){var r=n(t),f,u;t._map=i.map;i.img||(i.img=webgis.css.imgResource("loader1.gif","hourglass"));r.addClass("webgis-hourglass-holder");n("<table class='webgis-hourglass-service-loader'><tr><td><img src='"+i.img+"' /><\/td><td nowrap class='webgis-hourglass-text'><\/td><\/tr><\/table>").css("display","none").appendTo(r);n("<div class='webgis-hourglass-scale'><\/div>").css({display:"none"}).appendTo(r).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-hourglass-holder")[0]._map;i.ui.scaleDialog()});f=function(n){return n=Math.round(n/10)*10,"M 1:"+n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")};u=function(t,i){var e,c;try{var l=i.calcCrsResolution(),a=i.calcCrsScale(),s=[1e6,5e5,25e4,1e5,5e4,25e3,1e4,5e3,2500,1e3,500,250,100,50,25,10,5,4,3,2,1],r,u,h=!1;for(e=0;e<s.length;e++)if(r=s[e],u=r/l,u>50&&u<150){h=!0;break}var v=n("<div><\/div>").css({display:"inline-block"}).appendTo(t),y=n("<table><\/table>").appendTo(v),o=n("<tr><\/tr>").appendTo(y);h&&(n("<td><\/td>").addClass("webgis-hourglass-rulertext").appendTo(o).html(r>=1e3?r/1e3+"km":r+"m"),c=n("<td><\/td>").appendTo(o),n("<div><\/div>").addClass("webgis-hourglass-ruler").css({width:u,height:5}).appendTo(c));n("<td><\/td>").addClass("webgis-hourglass-scaletext").html(f(a)).appendTo(o)}catch(p){t.empty();console.log("scalebar",p)}};t._map.events.on("showhourglass",function(t,i,r){var f=r&&r.length>0?r.join(","):null,e;f?(n(this).find(".webgis-hourglass-text").text(f),n(this).find(".webgis-hourglass-scale").css("display","none"),n(this).find(".webgis-hourglass-service-loader").css("display","")):(n(this).find(".webgis-hourglass-service-loader").css("display","none"),e=n(this).find(".webgis-hourglass-scale").css("display","").empty(),u(e,this._map))},t);t._map.events.on("hidehourglass",function(){n(this).find(".webgis-hourglass-service-loader").css("display","none");var t=n(this).find(".webgis-hourglass-scale").css("display","").empty();u(t,this._map)},t)}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_topbar=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_search");else return t.init.apply(this,arguments)};n.fn.webgis_search=n.fn.webgis_topbar;var f={map:null,service:"geojuhu",quick_search:!0,quick_search_service:null,quick_search_categorie:"",detail_search:!0,app_menu:!1},t={init:function(t){var i=n(this);return t=n.extend({},f,t),this.each(function(){new e(this,t)})}},e=function(t,f){var e=n(t),o,s,c,a,h,v;if(e.data("map",f.map),e.addClass("webgis-topbar-holder webgis-ui-trans"),e.css({overflow:"visible",textAlign:"right",position:"absolute"}),o=0,f.app_menu===!0){s=n("<div style='position:absolute;right:"+o+"px;' id='webgis-app-menu-button' class='webgis-topbar-button webgis-app-menu-button'><\/div> ").appendTo(e);n("<div>").addClass("bar0").appendTo(s);n("<div>").addClass("bar1").appendTo(s);n("<div>").addClass("bar2").appendTo(s);n("<div>").addClass("bar3").appendTo(s);o+=35;c=n("<div class='webgis-app-menu-holder' style='position:absolute;right:0px;top:42px;display:none'>").appendTo(e);e.find("#webgis-app-menu-button").click(function(){var i=n(this).closest(".webgis-topbar-holder"),r,t,u;i.find(".webgis-detail-search-holder").css("display","none");r=n(this).closest(".webgis-topbar-holder");t=r.find(".webgis-app-menu-holder");t.length>0&&t.css("display")=="none"?(i.addClass("webgis-ui-trans-hover"),u=r.data("map"),u.events.fire("onshowappmenu",t.get(0)),n("#webgis-app-menu-button").addClass("open")):(i.removeClass("webgis-ui-trans-hover"),n("#webgis-app-menu-button").removeClass("open"));n(t).slideToggle()});f.map.events.on("onhideappmenu",function(t,i){n(i).slideUp();n("#webgis-app-menu-button").removeClass("open")})}if(f.detail_search===!0){n("<div style='position:absolute;right:"+o+"px;background-image:url("+webgis.css.imgResource("binoculars-26.png","ui")+")' id='webgis-detail-search-button' class='webgis-topbar-button'><\/div> ").appendTo(e);o+=35;e.find("#webgis-detail-search-button").click(function(){var t=n(this).closest(".webgis-topbar-holder"),i;t.find(".webgis-app-menu-holder").css("display","none");t.find(".webgis-search-result-holder").css("display","none");i=n(this).closest(".webgis-topbar-holder").find(".webgis-detail-search-holder");i.length>0&&i.css("display")=="none"?t.addClass("webgis-ui-trans-hover"):t.removeClass("webgis-ui-trans-hover");n(i).slideToggle()});var c=n("<div class='webgis-detail-search-holder' style='position:absolute;right:0px;top:42px;display:none'>").appendTo(e),y=n("<div class='webgis-detail-search-combo-holder'><\/div>").appendTo(c),l=n("<select class='webgis-input webgis-detail-search-combo'>").appendTo(y);n("<div class='webgis-detail-search-mask'><\/div>").appendTo(c);l.get(0).func_buildMask=r;l.get(0).func_emtpyMask=i;l.webgis_queryCombo({map:f.map,type:"query",onchange:function(){var t=this.options[this.selectedIndex];t?r(t.value,t.query,n(this).closest(".webgis-topbar-holder")):i(n(this).closest(".webgis-topbar-holder"))},valuefunction:function(n,t){return n.id+"/queries/"+t.id}})}if(f.quick_search===!0){a=n("<div style='position:absolute;top:0px;bottom:0px;right:"+(o+35)+"px;background-color:white;left:0px'><\/div>").appendTo(e);h=n("<input style='width:100%' class='webgis-search-input' type='text' placeholder='"+webgis.l10n.get("quick-search")+"...' />").appendTo(a).data("autocomplete-onenter",function(){u(this)}).click(function(){n(this).closest(".webgis-topbar-holder").addClass("webgis-ui-trans-hover").addClass("webgis-topbar-large");webgis._autocompleteFitMenu(this)}).blur(function(){n(this).closest(".webgis-topbar-holder").removeClass("webgis-ui-trans-hover").removeClass("webgis-topbar-large")});webgis.useMobileCurrent()&&h.data("control-parent-selector",".webgis-topbar-holder");v=f.quick_search_service||f.service;const t=v.split(",").filter((n,t,i)=>i.indexOf(n)===t).toString();h.attr("data-service",t);t!=="geojuhu"&&h.data("map",f.map).webgis_control_search({search_service:t,search_categories:f.quick_search_categorie,on_select_get_original:!0,on_select:function(t,i,r){var u=n(t).data("map"),e,f;u&&(r?(u.removeMarkerGroup("search-temp-marker"),u.queryResultFeatures.clear(),i&&i.metadata&&i.metadata.service_id&&i.metadata.query_id&&u.getQuery(i.metadata.service_id,i.metadata.query_id)?(i.features&&i.features.length!=0?u.ui.showQueryResults(i,!0,!1):webgis.alert("Daten für das Original GIS Element wurden nicht gefunden. Es besteht eventuell ein Schiefstand in den Daten...","info"),i.suppressSendQuickSearchResult=!0):i.features=[]):(e=i.thumbnail?"<img style='max-height:40px' src='"+i.thumbnail+"' />":"",f={type:"FeatureCollection",features:[{oid:i.id,type:"Feature",geometry:{type:"Point",coordinates:i.coords},properties:{_fulltext:"<table><tr><td>"+e+"<\/td><td style='vertical-align:top'><span>"+i.label+"<\/span><br/><span style='color:#aaa;font-size:0.8em'>"+i.subtext+"<\/span><\/td><\/tr><\/table>",_label:i.label},bounds:i.bbox&&Array.isArray(i.bbox)&&i.bbox.length==4?i.bbox:[i.coords[0],i.coords[1],i.coords[0],i.coords[1]]}],bounds:i.bbox&&Array.isArray(i.bbox)&&i.bbox.length==4?i.bbox:[i.coords[0],i.coords[1],i.coords[0],i.coords[1]]},u.ui.showQueryResults(f,!0,!0),u.zoomToBoundsOrScale(f.bounds,webgis.featuresZoomMinScale(f))))}});n("<div id='webgis-search-button' class='webgis-topbar-button webgis-topbar-button-round' style='position:absolute;right:"+o+"px;background-image:url("+webgis.css.imgResource("search-26.png","ui")+")'><\/div> ").appendTo(e).click(function(){u(this)})}webgis._appendAutocomplete(e);webgis.usability.appendContentSearchToSearchResults===!0&&webgis.delayed(function(){n(".webgis-presentation_toc-search.webgis-content-search-holder").length>0&&e.find(".webgis-search-input.webgis-autocomplete").data("data-append-items",[{id:"#content-search",value:"{0}",label:"{0}",subtext:"Nach Inhalten/Diensten suchen...",thumbnail:webgis.css.imgResource("presentations~png","toolbar")}])},1500)},i=function(t){var i=n(t).find(".webgis-detail-search-mask");return i.empty(),i};let r=function(t,r,u){let o=i(u);if(r!=null&&r.items!=null&&r.items.length!=0){n("<br/>").appendTo(o);let f=n("<form id='details_form' action='javascript:$.webgis_search_fire_detail(\"details_form\",\""+webgis.baseUrl+"/rest/services/"+t+"?f=json\")'><\/form>").appendTo(o);f.get(0).query=r;for(var e=0;e<r.items.length;e++){let i=r.items[e];if(i.visible!==!1){n("<div>").addClass("webgis-input-label").text(i.name).appendTo(f);let u=n("<input>").attr("type","text").addClass("webgis-input").attr("name",i.id).appendTo(f);i.autocomplete===!0&&u.addClass("webgis-autocomplete").data("depends_on",i.autocomplete_depends_on).attr("data-source",webgis.baseUrl+"/rest/services/"+t+"?c=autocomplete&_item="+i.id).attr("data-minlength",i.autocomplete_minlength);i.required===!0&&u.attr("required","required");i.examples&&u.attr("placeholder",i.examples);u.change(function(){let t=n(this),r=t.closest("form"),i=t.attr("name");r.find(".webgis-autocomplete").each(function(t,r){var u=n(r),f=u.data("depends_on");f&&u.attr("name")!==i&&n.inArray(i,f)>=0&&(u.val()==""&&(u.val("~"),webgis._triggerAutocomplete(u)),u.val(""),webgis._triggerAutocomplete(u))})})}}n("<br/><br/><div><div style='display:inline;margin-right:20px' class='webgis-detail-search-hourglass'><\/div><button type='submit' class='webgis-button webgis-detail-search-button'>"+webgis.l10n.get("search")+"<\/button><\/div>").appendTo(f);webgis._appendAutocomplete(f)}};n.webgis_search_fire_detail=function(t,i){var r={},u=n("#"+t),o,f,c,s,h,e,l,a;(u.find(".webgis-input").each(function(t,i){r[i.name]=n(i).val()}),o=u.closest(".webgis-topbar-holder"),f=o.data("map"),f._queryResultsHolder)&&(c="",s=o.find(".webgis-detail-search-combo"),s.length>0&&(h=s.get(0).options[s.get(0).selectedIndex],h&&h.query&&(c=h.query.name)),u.find(".webgis-detail-search-hourglass").html("<img src='"+webgis.css.imgResource("loader1.gif","hourglass")+"' /><span>Suche "+c+"...<\/span>"),r.filters||(e=i.toLowerCase().indexOf("/services/"),e>0&&(e+=10,l=i.indexOf("/",e+1),l>0&&(a=i.substring(e,l),r=f.appendRequestParameters(r,a)))),webgis.ajax({url:i,type:"post",data:webgis.hmac.appendHMACData(r,!0),success:function(n){webgis.checkResult(n)&&(f.events.fire("onnewfeatureresponse",n),f.ui.showQueryResults(n,!0),o.find(".webgis-detail-search-holder").slideUp());u.find(".webgis-detail-search-hourglass").html("")},error:function(){webgis.alert("unknown error","error");u.find(".webgis-detail-search-hourglass").html("")}}))};var u=function(t){if(t.getAttribute("data-service")=="geojuhu")s(t);else if(t._focused==null){o(t);try{n(t).autocomplete("close")}catch(i){}}},o=function(t){var h=n(t).closest(".webgis-topbar-holder"),l=h.find(".webgis-search-input"),o=l.val(),i,e,s,r,u,f,c;o&&(i=h.data("map"),e=i._queryResultsHolder,e)&&(h.find(".webgis-detail-search-holder").slideUp(),s=n(e),e.search_term!==o)&&(i.events.fire("showqueryresults",{map:i,buttons:{clearresults:!1,showtable:!1}}),u=i.ui.getQueryResultTabControl(),f="webgis-search-tabcontrol-tab",u?(c=u.webgis_tab_control("getTab",{id:f}),c?(r=u.webgis_tab_control("getContent",{id:f}),c.data("suppressShowQueryResults",!0),u.webgis_tab_control("setTabPayload",{id:f,payload:{}}).webgis_tab_control("select",{id:f,counter:0})):u.webgis_tab_control("add",{id:f,title:webgis.l10n.get("quick-search")+"...",select:!0,pinable:!1,counter:5,onCreated:function(n,t,u){r=u.addClass("webgis-search-result-holder");r.data("map",i);t.data("suppressShowQueryResults",!0)},onSelected:function(n,t,i){if(t.data("suppressShowQueryResults"))t.data("suppressShowQueryResults",!1);else{var r=i.payload.map,u=i.payload.features;r&&u&&(r.unloadDynamicContent(),r.queryResultFeatures.showClustered(u,!0),r.ui.refreshUIElements())}},onRemoved:function(n,t){t.selected&&i.queryResultFeatures.clear(!1);i.ui._setResultFrameSize(n)}})):r=s.find(".webgis-search-result-list"),u?r.webgis_queryResultListWithFeatureDetails("empty",{map:i}):r.webgis_queryResultsList("empty",{map:i}),r.html("<img src='"+webgis.css.imgResource("loader1.gif","hourglass")+"' /><span>Suche läuft...<\/span>"),webgis.ajax({url:webgis.baseUrl+"/rest/search/"+l.attr("data-service"),data:webgis.hmac.appendHMACData({term:o,f:"geojson",rows:100}),type:"post",success:function(n){var t,h,c;e.search_term=o;r.empty();i.queryResultFeatures.showClustered(n,!0);t=0;n&&n.features&&n.features.length>0?(h={map:i,features:n.features,onRemove:function(){u.webgis_tab_control("remove",{id:f})}},u?r.webgis_queryResultListWithFeatureDetails(h):r.webgis_queryResultsList(h),s.webgis_queryResultsHolder("showbuttons",{clearresults:!0,showtable:!1}),t=n.features.length):(r.html("Keine Ergebnisse gefunden..."),s.webgis_queryResultsHolder("showbuttons",{clearresults:!1,showtable:!1}));u&&(c=u.webgis_tab_control("getTab",{id:f}),u.webgis_tab_control("setTabPayload",{id:f,payload:{features:n,map:i}}).webgis_tab_control("setTabCounter",{id:f,counter:t}).webgis_tab_control("resize"),i.ui._setResultFrameSize())},error:function(){r.html("Es ist ein Fehler aufgetreten...")}}))},s=function(t){var o=n(t).closest(".webgis-topbar-holder"),s=o.find(".webgis-search-input"),e=s.val(),i,f,u,r;e&&(i=o.data("map"),f=i._queryResultsHolder,f)&&(o.find(".webgis-detail-search-holder").slideUp(),u=n(f),f.search_term!==e)&&(i.events.fire("showqueryresults",{map:i,buttons:{clearresults:!1,showtable:!1}}),r=u.find(".webgis-search-result-list"),r.webgis_queryResultsList("empty",{map:i}),r.html("<img src='"+webgis.css.imgResource("loader1.gif","hourglass")+"' /><span>Suche läuft...<\/span>"),webgis.ajax({url:webgis.baseUrl+"/rest/search/geojuhu",data:webgis.hmac.appendHMACData({term:e,services:i.serviceIds().join(","),f:"json"}),type:"post",success:function(t){var o,h,s;if(f.search_term=e,r.empty(),o=[],i.queryResultFeatures.showClustered(t,!0),t&&t.features&&t.features.length>0){h=n("<div>").appendTo(r);r.webgis_queryResultsList({map:i,features:t.features,beforeAdd:function(t,r){if(!o[r.id]){o[r.id]=0;var f=n("<div class='webgis-geojuhu-switch'>").appendTo(h);n("<label id='"+r.id+"'><input id='__geojuhu_switch_"+r.id+"' type='checkbox' checked='checked' />&nbsp;"+r.name+"<span class='webgis-geojuhu-switch-counter' id='counter_"+r.id+"'><\/span><\/label>").appendTo(f).find("#__geojuhu_switch_"+r.id).click(function(){u.find("."+this.parentNode.id).css("display",n(this).prop("checked")?"":"none");var t={features:[]};u.find(".webgis-geojuhu-result").each(function(i,r){n(r).css("display")!=="none"&&r.feature&&(t.features.push(r.feature),t.bounds==null?t.bounds=[r.feature.bounds[0],r.feature.bounds[1],r.feature.bounds[2],r.feature.bounds[3]]:(t.bounds[0]=Math.min(t.bounds[0],r.feature.bounds[0]),t.bounds[1]=Math.min(t.bounds[1],r.feature.bounds[1]),t.bounds[2]=Math.max(t.bounds[2],r.feature.bounds[2]),t.bounds[3]=Math.max(t.bounds[3],r.feature.bounds[3])))});i.queryResultFeatures.showClustered(t,!0)})}o[r.id]++}});for(s in o)r.find("#counter_"+s).html(o[s]);u.webgis_queryResultsHolder("showbuttons",{clearresults:!0,showtable:!1})}else r.html("Keine Ergebnisse gefunden..."),u.webgis_queryResultsHolder("showbuttons",{clearresults:!1,showtable:!1})},error:function(){r.html("Es ist ein Fehler aufgetreten...")}}))}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_queryResultsHolder=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$webgis_queryResultsHolder");else return t.init.apply(this,arguments)};var i={map:null},t={init:function(t){var u=n(this),t=n.extend({},i,t);return this.each(function(){new r(this,t)})},showbuttons:function(t){return this.each(function(){n(this).find(".webgis-search-result-clearresults").css("display",t&&t.clearresults?"":"none");n(this).find(".webgis-search-result-showtable").css("display",t&&t.showtable?"":"none")})}},r=function(t,i){if(i.map){var r=n(t);r.data("map",i.map);r.addClass("webgis-search-result-holder");n("<div class='webgis-search-result-list'><\/div>").appendTo(r);i.map._queryResultsHolder=r.get(0);i.map.events.on("feature-highlighted",function(t,i,r){var u=n(this);u.find("."+n.fn.webgis_queryResultsList.selectedItemClass).removeClass(n.fn.webgis_queryResultsList.selectedItemClass);u.find(".webgis-result[data-id='"+r.oid+"']").addClass(n.fn.webgis_queryResultsList.selectedItemClass)},t);i.map.events.on("feature-highlight-removed",function(){var t=n(this);t.find("."+n.fn.webgis_queryResultsList.selectedItemClass).removeClass(n.fn.webgis_queryResultsList.selectedItemClass)},t)}}}(webgis.$||jQuery),function(n){"use strict";var i,t;n.fn.webgis_queryResultsList=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$webgis_queryResultsList");else return t.init.apply(this,arguments)};i={map:null,features:null,beforeAdd:null,showToolbar:!0,dynamicContentQuery:null};t={init:function(t){var r=n(this),t=n.extend({},i,t);return this.each(function(){new u(this,t)})},empty:function(t){f(n(this),t.map)}};n.fn.webgis_queryResultsList.selectedItemClass="webgis-geojuhu-result-selected";var u=function(t,i){var l=n(t),e=i.map,c=i.features,it=i.beforeAdd,rt=i.dynamicContentQuery,u=null,s=null,p=[],k=e.queryResultFeatures.supportsSelectFeatures(),d,o,g,nt,b,et,tt,ut,w,f,a,h,ft,v,y;for(w in c){if(f=c[w],u=rt,!u&&f.oid.substring(0,1)!=="#"){if(a=f.oid.split(":"),s=e.services[a[0]],!s)continue;if(u=s.getQuery(a[1]),!u)continue;f.__queryId=u.id;f.__serviceId=s.id;k===!0&&(d=s.getLayer(u.layerid),d!=null&&d.selectable===!1&&(k=!1))}u&&n.inArray(u.name,p)<0&&p.push(u.name)}if(e.getSelection("selection").remove(),e.getSelection("custom").remove(),i.showToolbar){o=n("<ul>").addClass("webgis-queryresult-tools").css({margin:0,padding:0}).appendTo(l);webgis.queryResultOptions.showMenu===!1&&o.css("display","none");k&&(g=n("<li><span><img src='"+webgis.css.imgResource("select_features.png","tools")+"'><div class='webgis-toolbox-tool-item-label'>"+webgis.l10n.get("button-select")+"<\/div><\/span><\/li>").addClass("webgis-toolbox-tool-item webgis-selection-button webgis-toggle-button").appendTo(o).click(function(){var t=n(this).closest(".webgis-search-result-holder").data("map");t&&t.queryResultFeatures.setSelection(n(this).toggleClass("selected").hasClass("selected"),n(this))}),e.queryResultFeatures.supportsBufferFeatures()&&n("<li><span><img src='"+webgis.css.imgResource("buffer.png","tools")+"'><div class='webgis-toolbox-tool-item-label'>"+webgis.l10n.get("button-buffer")+"<\/div><\/span><\/li>").addClass("webgis-toolbox-tool-item").appendTo(o).click(function(){var t=n(this).closest(".webgis-search-result-holder").data("map");t&&t.ui.showBufferDialog()}));n("<li><span><img src='"+webgis.css.imgResource("results.png","tools")+"'><div class='webgis-toolbox-tool-item-label'>"+webgis.l10n.get("button-table")+"<\/div><\/span><\/li>").addClass("webgis-toolbox-tool-item webgis-dependencies webgis-dependency-queryfeatureshastableproperties").appendTo(o).click(function(){var t=n(this).closest(".webgis-search-result-holder").data("map");t&&t.queryResultFeatures.showTable()});b=n("<li><span><img src='"+webgis.css.imgResource("remove.png","tools")+"'><div class='webgis-toolbox-tool-item-label'>"+webgis.l10n.get("button-remove-results")+"<\/div><\/span><\/li>").addClass("webgis-toolbox-tool-item remove-queryresults").appendTo(o).click(function(){var t=n(this).closest(".webgis-search-result-holder").data("map"),r,u,f;if(t&&(r=n(this).closest(".webgis-search-result-holder"),u=n.webgis_search_result_histories[t]!=null&&n.webgis_search_result_histories[t].count()>0,t.queryResultFeatures.clear(u),t.getSelection("selection").remove(),r.find(".webgis-search-result-list").webgis_queryResultsList("empty",{map:t}),r.get(0).search_term="",u?n.webgis_search_result_histories[t].render(r.find(".webgis-search-result-list")):t.events.fire("hidequeryresults"),t.getSelection("query").remove(),t.getSelection("custom").remove(),f=t.getActiveTool(),f&&f.hasui!==!0&&t.setDefaultTool(),i.onRemove))i.onRemove(t)});e.queryResultFeatures.supportsRemoveFeatures()||b.css("display","none");e.getTool("webgis.tools.addtoselection")&&(nt=n("<li><span><img src='"+webgis.css.imgResource("cursor-plus-26-b.png","tools")+"'><div class='webgis-toolbox-tool-item-label'>Selektion erweitern<\/div><\/span><\/li>").addClass("webgis-toolbox-tool-item").attr("data-toolid","webgis.tools.addtoselection").appendTo(o).click(function(){var t=n(this).closest(".webgis-search-result-holder").data("map"),i;n(this).hasClass("selected")?t.setActiveTool(t.getDefaultTool()):(i=t.getTool("webgis.tools.addtoselection"),i&&t.setActiveTool(i))}));e.getTool("webgis.tools.removefromselection")&&(b=n("<li><span><img src='"+webgis.css.imgResource("cursor-minus-26-b.png","tools")+"'><div class='webgis-toolbox-tool-item-label'>Selektion einschränken<\/div><\/span><\/li>").addClass("webgis-toolbox-tool-item").attr("data-toolid","webgis.tools.removefromselection").appendTo(o).click(function(){var t=n(this).closest(".webgis-search-result-holder").data("map"),i;n(this).hasClass("selected")?t.setActiveTool(t.getDefaultTool()):(i=t.getTool("webgis.tools.removefromselection"),i&&t.setActiveTool(i))}));switch(e.getToolId(e.getActiveTool())){case"webgis.tools.addtoselection":nt&&nt.addClass("selected");break;case"webgis.tools.removefromselection":b&&b.addClass("selected")}webgis.usability.tsp&&webgis.usability.tsp.allowOrderFeatures===!0&&!e.queryResultFeatures.isExtentDependent()&&(et=n("<li><span><img src='"+webgis.css.imgResource("roundtrip-26.png","tools")+"'><div class='webgis-toolbox-tool-item-label'>Rundreise<\/div><\/span><\/li>").addClass("webgis-toolbox-tool-item webgis-dependencies webgis-dependency-calc-tsp").appendTo(o).click(function(){var t=n(this).closest(".webgis-search-result-holder").data("map");webgis.tsp.orderFeaturesWithUI(t)}));p.length===1&&n("<h3>"+(webgis.queryResultOptions.showHeadingCount===!1?"":"<span class='webgis-results-counter'>"+c.length+"<\/span> aus ")+p[0]+":<\/h3>").appendTo(l);o.webgis_toolbar("intialize",{map:e});o.closest(".webgis-container").find(".webgis-toolbox-tool-item[data-toolid='webgis.tools.editing.edit']").length>=1&&n("<li><span><img src='"+webgis.css.imgResource(webgis.baseUrl+"/rest/toolresource/webgis-tools-editing-edit-edit","tools")+"'><div class='webgis-toolbox-tool-item-label'>Bearbeiten (Edit)<\/div><\/span><\/li>").css("display","none").addClass("webgis-selection-edittool-shortcut").addClass("webgis-toolbox-tool-item").appendTo(o).click(function(){n(this).closest(".webgis-container").find(".webgis-toolbox-tool-item[data-toolid='webgis.tools.editing.edit']").trigger("click")})}tt=e.queryResultFeatures.reorderAble();ut=n("<ol class='webgis-geojuhu-results'>").appendTo(l);for(w in c){if(f=c[w],u=rt,!u&&f.oid.substring(0,1)!=="#"){if(a=f.oid.split(":"),s=e.services[a[0]],!s)continue;if(u=s.getQuery(a[1]),!u)continue;it&&it(s,u,f)}if(h=n("<li data-id='"+f.oid+"'><\/li>").addClass("webgis-geojuhu-result webgis-result "+(u?u.id:"")).attr("data-id",f.oid).data("feature",f).appendTo(ut),u&&u.draggable===!0)h.attr("draggable",!0).data("feature",f).on("dragstart",function(t){var i=n(this).data("feature"),r={type:"FeatureCollection",features:[{type:"Feature",geometry:i.geometry,properties:i.drag_properties||(Array.isArray(i.properties)?i.properties.length>0?i.properties[0]:{}:i.properties),meta:{query:u.id}}]},f=JSON.stringify(r);t.originalEvent.dataTransfer.setData("text",f)});tt&&n("<div>").addClass("webgis-reorder-handle").appendTo(h.addClass("reorderable"));p.length>1&&u&&n("<div class='webgis-geojuhu-reslut-category'>Ergebnis aus "+u.name+"<\/div>").appendTo(h);e.queryResultFeatures.supportsRemoveFeature()&&c.length>1&&n("<div><\/div>").addClass("webgis-result-remove").appendTo(h).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-search-result-holder").data("map");i.queryResultFeatures.removeFeature(n(this).closest("li").attr("data-id"))});ft=n("<div>").addClass("webgis-result-fulltext").appendTo(h);v=webgis.hooks.query_result_feature["default"]||r;f.__queryId&&f.__serviceId&&(v=webgis.hooks.query_result_feature[f.__queryId]||v,v=webgis.hooks.query_result_feature[f.__serviceId+":"+f.__queryId]||v);v(e,ft,f,r);y=e.queryResultFeatures.markerImg(f._fIndex||w);y&&y.url&&h.css({backgroundImage:webgis.queryResultOptions.showMarker===!1?"none":"url("+y.url+")",backgroundPosition:"left center",minHeight:y.height,paddingLeft:webgis.queryResultOptions.showMarker===!1?0:y.width+5});h.click(function(){var r=n(this),e=r.closest(".webgis-geojuhu-results"),t=r.closest(".webgis-search-result-holder").data("map"),u=r.data("feature"),f;if(u&&t&&(f=n(this).hasClass(n.fn.webgis_queryResultsList.selectedItemClass),e.find("."+n.fn.webgis_queryResultsList.selectedItemClass).removeClass(n.fn.webgis_queryResultsList.selectedItemClass),t.queryResultFeatures.handlers.featureResultClick(u,f,n(this).hasClass("webgis-result-suppresszoom")),t.ui.tabsInSidebar()===!1&&t.events.fire("hidequeryresults"),i.onItemClick))i.onItemClick(this,u)})}e.queryResultFeatures.isSelected()&&g&&g.trigger("click");tt&&webgis.require("sortable",function(){Sortable.create(l.children("ol.webgis-geojuhu-results").get(0),{animation:150,ghostClass:"webgis-sorting",handle:".webgis-reorder-handle",onSort:function(){var t=[];l.children("ol.webgis-geojuhu-results").children(".webgis-geojuhu-result").each(function(i,r){t.push(n(r).attr("data-id"))});e.queryResultFeatures.reorderFeatures(t)}})});n("#"+l.closest(".webgis-search-result-holder").attr("id")+"-counter").css("display","").text(c.length)},f=function(t,i){t.empty();n("#"+t.closest(".webgis-search-result-holder").attr("id")+"-counter").css("display","none").html("");i&&i.getSelection("query").remove();n(i.ui.webgisContainer()).find(".webgis-presentation_toc-dyncontent-item.webgis-presentation_toc-dyncontent-item-selected").removeClass("webgis-presentation_toc-dyncontent-item-selected")},r=function(t,i,r){var f="",u=Array.isArray(r.properties)?r.properties.length>0?r.properties[0]:{}:r.properties,e;if(u._fulltext)f=u._fulltext.replaceAll("\\n","<br/>");else{for(e in u)if(e.substring(0,1)!="_"&&u.hasOwnProperty(e)&&u[e]){f=e+": "+u[e];break}f===""&&u._title&&(f=u._title)}u._distanceString&&(f+="<br/>📐"+u._distanceString);i.html(i.html()+webgis.secureHtml(f));i.find("a[target='dialog']").each(function(t,i){var r=n(i),u=r.attr("href");r.attr("href","").attr("onclick","webgis.iFrameDialog('"+u+"','"+r.html()+"');return false;")})};n.webgis_search_result_histories=[]}(webgis.$||jQuery),function(n){"use strict";var i,r;n.fn.webgis_queryResultListWithFeatureDetails=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$webgis_queryResultListWithFeatureDetails");else return t.init.apply(this,arguments)};var u={map:null,features:null},t={init:function(t){var i=n(this),t=n.extend({},u,t);return this.each(function(){new f(this,t)})},empty:function(t){n(this).find("td.details").empty();n(this).find("td.list").webgis_queryResultsList("empty",t)}},f=function(t,r){var u=n(t).addClass("webgis-result-"),f=n("<div>").css({position:"absolute",inset:"0px 0px 0px 0px",overflow:"hidden"}).appendTo(u),e=n("<div>").css({position:"absolute",left:0,top:0,bottom:0,width:320,overflow:"auto",paddingLeft:8}).addClass("list webgis-scroll-offset-element").appendTo(f),o=n("<div>").css({position:"absolute",inset:"0px auto 0px 320px",paddingLeft:8,overflow:"auto"}).addClass("details").appendTo(f);if(r.onItemClick=function(n,t){i(u,r.map,t)},n("<div>").appendTo(e).webgis_queryResultsList(r),r.map){r.map.events.off("onmarkerclick",n.fn.webgis_queryResultListWithFeatureDetails.onMarkerClick);r.map.events.on("onmarkerclick",n.fn.webgis_queryResultListWithFeatureDetails.onMarkerClick,u)}};n.fn.webgis_queryResultListWithFeatureDetails.onMarkerClick=function(t,r,u){i(n(this),r,u)};i=function(n,t,i){var u=n.find("div.details");i.oid.indexOf("#service:#default:")==0&&i.properties&&i.properties._details?webgis.showFeatureResultDetails(t.guid,i.properties._details,function(n,f,e,o){n==!1&&delete i.properties._details;r(t,u,f||i,e,o)}):r(t,u,i)};r=function(t,i,r,u,f){i.empty();u&&n("<h2>").text(u).appendTo(i);t.queryResultFeatures.showFeatureTable(r,"",i,f)}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_queryResultsTable=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$webgis_queryResultsList");else return t.init.apply(this,arguments)};n.fn.webgis_queryResultsTable.selectedRowClass="webgis-table-result-selected";var i={map:null,features:null,reorderable:!1,addCheckboxes:!1,addZoomTo:!1,appendAdvancedFeatureButtons:!1},t={init:function(t){var u=n(this),t=n.extend({},i,t);return this.each(function(){new r(this,t)})},selectRow:function(t){var i=n(this),r,u;i.find("."+n.fn.webgis_queryResultsTable.selectedRowClass).removeClass(n.fn.webgis_queryResultsTable.selectedRowClass);r=i.find(".webgis-result[data-id='"+t.dataId+"']").addClass(n.fn.webgis_queryResultsTable.selectedRowClass);t.scrollTo===!0&&(u=r.closest(".webgis-scroll-offset-element"),webgis.scrollTo(u.length===1?u:i,r))},unselectRows:function(t){t.map&&n(t.map._webgisContainer).find(".webgis-result[data-id]."+n.fn.webgis_queryResultsTable.selectedRowClass).removeClass(n.fn.webgis_queryResultsTable.selectedRowClass)}},r=function(t,i){var gt=n(t),s=i.map,e=i.features,wt,a,tt,r,ht,rt,ct,p,ti,k,bt,ut,l,kt,ft,lt,v,dt,d,w,o,y,c,at;if(!e)return"Keine Abfrageergebnisse vorhanden.";var g=e.metadata&&e.metadata.table_fields?e.metadata.table_fields:null,et=[],nt=!1;for(a=0,tt=e.features.length;a<tt;a++)if(r=e.features[a],Array.isArray(r.properties)&&r.properties.length>1){nt=!0;break}var it="webgis.tools.presentation.visfilter",ni="webgis.tools.editing.updatefeature",vt="webgis.tools.editing.edit",ot="webgis-tools-editing-edit",yt="webgis.tools.identify",pt=i.reorderable===!0&&nt===!1,b=n("<table>").addClass("webgis-result-table features").appendTo(gt);if(e.features.length>0){var h,st=Array.isArray(e.features[0].properties)?e.features[0].properties[0]:e.features[0].properties,l=n("<tr>").appendTo(b),o=n("<td>").addClass("webgis-result-table-header webgis-result-table-menucell").attr("colspan",3).appendTo(l);i.addCheckboxes&&n("<div class='menubutton inline checkbox'><\/div>").appendTo(o);i.addZoomTo&&n("<div class='menubutton inline zoom'><\/div>").appendTo(o);e.metadata&&e.metadata.has_attachments&&n("<div class='menubutton inline attachments has-attachments trigger-click'><\/div>").data("map",s).data("oids",e.features.map(function(n){return n.oid})).appendTo(o).click(function(){var t=[],i=n(this).data("map");t["feature-oids"]=n(this).data("oids");n(this).closest("table").find(".menubutton.attachments").removeClass("has-attachments").addClass("query-has-attachments");webgis.tools.onButtonClick(i,{command:"query_has_attachments",type:"servertoolcommand_ext",id:yt,map:i},this,null,t);n(this).remove()});i.appendAdvancedFeatureButtons&&e.metadata&&e.metadata.applicable_filters&&s.getTool(it);nt&&n("<td>").addClass("webgis-result-table-header").appendTo(l);for(h in st)if(h.substring(0,1)!=="_"||h==="_distanceString"){if(c=g?n.grep(g,function(n){return n.name===h}):null,c&&c.length===1&&c[0].visible===!1){et.push(h);continue}st.hasOwnProperty(h)&&n("<td>").addClass("webgis-result-table-header").text(h==="_distanceString"?"📐":h).appendTo(l)}for(wt=et.length>0,a=0,tt=e.features.length;a<tt;a++){r=e.features[a];!r.__queryId&&r.oid&&r.oid.indexOf(":")>0&&(ht=r.oid.split(":"),rt=s.services[ht[0]],rt&&(ct=rt.getQuery(ht[1]),ct&&(r.__queryId=ct.id,r.__serviceId=rt.id)));p=Array.isArray(r.properties)?r.properties:[r.properties];p.length==0&&(p=[{}]);ti=p.length>1;k=0;for(bt in p){if(ut=p[bt],l=n("<tr>").addClass("webgis-result").attr("data-id",r.oid).data("feature-bbox",r.bounds).appendTo(b).contextmenu(function(t){return t.stopPropagation(),f(n(this),t),!1}),k===0){if(kt=s.queryResultFeatures.markerImg(r._fIndex),o=n("<td>").addClass("webgis-result-table-menucell checkbox").attr("colspan",3).appendTo(l),i.addCheckboxes&&n("<div>").addClass("menubutton inline checkbox"+(r._tableChecked===!0?" checked":"")).appendTo(o),i.addZoomTo&&r.bounds&&(n("<div>").addClass("menubutton inline zoom").attr("shortcut","z").attr("title",webgis.l10n.get("zoom-to")+"...").appendTo(o),n("<div>").addClass("menubutton pan").attr("shortcut","c").attr("title",webgis.l10n.get("center")+"...").appendTo(o)),i.appendAdvancedFeatureButtons){if(r.__queryId&&r.__serviceId&&(ft=s.getEditThemes(r.__serviceId,r.__queryId),ft))for(lt in ft)v=ft[lt],n("<div>").addClass("menubutton inline webgis-dependencies webgis-dependency-not-activetool "+ot).attr("title",v.name+": "+webgis.l10n.get("edit-attributes")).attr("shortcut","e").data("edittheme",v).data("map",s).data("oid",r.oid).css("background-image","url("+webgis.css.imgResource("edit-attributes-26.png","tools")+")").appendTo(o).click(function(t){t.stopPropagation();var i=[],r=n(this).data("map");i["feature-oid"]=n(this).data("oid");i.edittheme=n(this).data("edittheme").themeid;i["edit-map-scale"]=r.scale();i["edit-map-crsid"]=r.calcCrs().id;n(this).hasClass("webgis-triggered-by-shortcut")||r.setViewFocus(n(this).closest("tr").data("feature-bbox"),.3);webgis.tools.onButtonClick(r,{command:"editattributes",type:"servertoolcommand_ext",id:ni,map:r},this,null,i)}),n("<div>").addClass("menubutton inline webgis-dependencies webgis-dependency-activetool "+ot).attr("title",v.name+": "+webgis.l10n.get("edit-geometry-and-attributes")).attr("shortcut","e").data("edittheme",v).data("map",s).data("oid",r.oid).css("background-image","url("+webgis.css.imgResource("webgis-tools-editing-edit-update.png","tools")+")").appendTo(o).click(function(t){t.stopPropagation();var i=[],r=n(this).data("map");i["feature-oid"]=n(this).data("oid");i.edittheme=n(this).data("edittheme").themeid;i["edit-map-scale"]=r.scale();i["edit-map-crsid"]=r.calcCrs().id;webgis.tools.onButtonClick(r,{command:"updatefeature",type:"servertoolcommand",id:vt,map:r},this,null,i)}),n("<div>").addClass("menubutton webgis-dependencies webgis-dependency-activetool "+ot).attr("title",v.name+": "+webgis.l10n.get("edit-delete")).attr("shortcut","d").data("edittheme",v).data("map",s).data("oid",r.oid).css("background-image","url("+webgis.css.imgResource("webgis-tools-editing-edit-delete.png","tools")+")").appendTo(o).click(function(t){t.stopPropagation();var i=[],r=n(this).data("map");i["feature-oid"]=n(this).data("oid");i.edittheme=n(this).data("edittheme").themeid;i["edit-map-scale"]=r.scale();i["edit-map-crsid"]=r.calcCrs().id;n(this).hasClass("webgis-triggered-by-shortcut")||r.setViewFocus(n(this).closest("tr").data("feature-bbox"),.3);webgis.tools.onButtonClick(r,{command:"deletefeature",type:"servertoolcommand",id:vt,map:r},this,null,i)});if(e.metadata&&e.metadata.applicable_filters&&s.getTool(it)&&(n.each(e.metadata.applicable_filters.split(","),function(t,i){var u,f;i.indexOf("~")>0&&(u=s.getService(i.split("~")[0]),u&&(f=u.getFilter(i.split("~")[1]),f&&n("<div>").addClass("menubutton").attr("title",f.name).data("map",s).data("oid",r.oid).data("filterid",i).css("background-image","url("+webgis.css.imgResource("filter-26.png","tools")+")").appendTo(o).click(function(t){t.stopPropagation();var i=[];i.feature_oid=n(this).data("oid");i.filter_id=n(this).data("filterid");webgis.tools.onButtonClick(s,{command:"setfeaturefilter",type:"servertoolcommand_ext",id:it,map:s},this,null,i)})))}),n("<div>").addClass("menubutton").addClass("webgis-dependencies webgis-dependency-hasfilters").attr("title","Alle entfernen").attr("data-applicable-filters",e.metadata.applicable_filters).data("map",s).data("oid",r.oid).css("background-image","url("+webgis.css.imgResource("filter-remove-26.png","tools")+")").appendTo(o).click(function(){var t=[];t.feature_oid=n(this).data("oid");webgis.tools.onButtonClick(s,{command:"unsetfeaturefilter",type:"servertoolcommand_ext",id:it,map:n(this).data("map")},this,null,t)})),e.metadata&&e.metadata.has_attachments&&n("<div>").addClass("menubutton inline attachments").attr("id","attachments-"+r.oid.replaceAll("@","-").replaceAll(":","-")).attr("title","Attachements").data("map",s).data("oid",r.oid).appendTo(o).click(function(){var t=[],i=n(this).data("map");t["feature-oid"]=n(this).data("oid");webgis.tools.onButtonClick(i,{command:"show_attachments",type:"servertoolcommand_ext",id:yt,map:i},this,null,t)}),webgis.usability.singleResultButtons)for(dt in webgis.usability.singleResultButtons)d=webgis.usability.singleResultButtons[dt],d.url&&(w=d.url,r.geometry&&r.geometry.coordinates&&r.geometry.coordinates.length>=2&&(w=w.replaceAll("{lon}",r.geometry.coordinates[0]),w=w.replaceAll("{lat}",r.geometry.coordinates[1])),n("<a>").addClass("menubutton").css("background-image","url("+d.img+")").attr("href",w).attr("target","_blank").attr("title",d.name).appendTo(o))}n("<div><img src='"+kt.url+"' style='max-height:32px'/><\/div>").addClass("menubutton inline marker").appendTo(o);pt&&(n("<div>").addClass("webgis-reorder-handle").appendTo(o),l.addClass("reorderable"));nt&&n("<td class='webgis-result-table-menucell index'>"+(k+1)+"<\/td>").appendTo(l)}else n("<td class='webgis-result-table-menucell sub' colspan='3'><\/td>").appendTo(l),n("<td class='webgis-result-table-menucell sub index'>"+(k+1)+"<\/td>").appendTo(l);for(h in st)if((h.substring(0,1)!=="_"||h==="_distanceString")&&(!wt||!(n.inArray(h,et)>=0))&&(o=n("<td class='webgis-result-table-cell'>").appendTo(l).click(u),ut.hasOwnProperty(h)))if(y=ut[h],y.indexOf("<a ")>=0){const t=n(y);if(t.attr("target")==="dialog"){const n=t.attr("href");t.attr("href","").attr("onclick","webgis.iFrameDialog('"+n+"','"+t.text()+"');return false;");y=t.prop("outerHTML")}o.html(y)}else if(y.indexOf("<img ")===0){const i=n(y),t=i.attr("src");if(t){const i=n("<img>").attr("src",t).appendTo(o);c=g?n.grep(g,function(n){return n.name===h}):null;c&&c.length===1&&(c[0].image_width&&i.css("width",c[0].image_width+"px"),c[0].image_height&&i.css("height",c[0].image_height+"px"))}}else o.text(ut[h]);k++;lt}}pt&&webgis.require("sortable",function(){Sortable.create(b.get(0),{handle:".webgis-reorder-handle",onSort:function(){var t=[];b.children("tr.reorderable").each(function(i,r){t.push(n(r).attr("data-id"))});s.queryResultFeatures.reorderFeatures(t)}})})}at=b.find(".trigger-click");at.length>0&&webgis.delayed(function(n){n.trigger("click")},500,at)},u=function(t){if(t&&t.originalEvent){var i=n(this),r=i.offset(),u={right:i.outerWidth()-(t.originalEvent.pageX-r.left),top:t.originalEvent.pageY-r.top};u.right>=4&&u.right<=28&&(t.stopPropagation(),webgis.copy(i))}},f=function(t,i){if(!n.fn.webgis_contextMenu)return!1;var r=[];t.find(".menubutton").each(function(t,i){var u=n(i),f=u.attr("style");(!f||f.replaceAll(" ","").indexOf("display:none;")<0)&&u.attr("title")&&r.push({icon:u.css("backgroundImage"),text:u.attr("title"),data:u,shortcut:u.attr("shortcut")})});t.find("td > a").each(function(t,i){var u=n(i);u.hasClass("menubutton")||r.push({text:u.text(),data:u})});n("body").webgis_contextMenu({sender:t,clickEvent:i,items:r,callback:function(n){n.attr("href")?n[0].click():n.trigger("click")}})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_queryBuilder=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$webgis_queryBuilder");else return t.init.apply(this,arguments)};var r={map:null,id:"querybuilder",field_defs:[],show_geometry_option:!1,event:null},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})}},u=function(t,r){let u=n(t).addClass("webgis-query-builder").data("options",r);if(r.show_geometry_option===!0){let t=n("<select>").addClass("webgis-input webgis-query-builder-geometry-option").css("margin","4px 4px 16px 4px").appendTo(u);n("<option>").attr("value","use").text(webgis.l10n.get("querybuilder-use-geometry")).appendTo(t);n("<option>").attr("value","ignore").text(webgis.l10n.get("querybuilder-ignore-geometry")).appendTo(t)}let o=n("<table>").addClass("webgis-query-builder-table").appendTo(u),s=n("<input>").attr("type","hidden").attr("id",r.id+"-result").addClass("webgis-tool-parameter").appendTo(u),f=n("<div>").css({textAlign:"right",padding:"10px 0px 10px 0px"}).appendTo(u);n("<button>").addClass("webgis-button").text(webgis.l10n.get("apply")).appendTo(f).click(function(){var n=r.map,t,i;console.log("options.event",r.event);t=[];t[r.id+"-result"]=JSON.stringify(e(u,r));i=new webgis.tools.wrapperEvent(r.event,t);webgis.tools.onButtonClick(n,{id:n.getActiveTool().id,command:"querybuilder",type:"servertoolcommand_ext",map:n,event:i})});i(u)},i=function(t){var c,s;let r=t.data("options");if(r.field_defs){let l=t.find(".webgis-query-builder-table"),u=n("<tr>").attr("row-id",f(t)).addClass("webgis-query-builder-table-row").appendTo(l),a=n("<td>").addClass("fields").appendTo(u),v=n("<td>").addClass("operators").appendTo(u),h=n("<td>").addClass("value").appendTo(u),y=n("<td>").addClass("logical-operators").appendTo(u),o=n("<select>").addClass("webgis-input webgis-query-builder-fields").appendTo(a),p=n("<select>").addClass("webgis-input webgis-query-builder-operators depends-on-fields").appendTo(v),w=n("<input>").addClass("webgis-input webgis-query-builder-value depends-on-fields").attr("type","text").appendTo(h),b=n("<input>").addClass("webgis-input webgis-query-builder-value-template").attr("type","hidden").appendTo(h),e=n("<select>").addClass("webgis-input  webgis-query-builder-logical-operators depends-on-fields").appendTo(y);n("<option>").attr("value","").text("-- "+webgis.l10n.get("select-field")+" --").appendTo(o);n("<option>").attr("value","").appendTo(e);n("<option>").attr("value","and").text("AND").appendTo(e);n("<option>").attr("value","or").text("OR").appendTo(e);for(c in r.field_defs)s=r.field_defs[c],n("<option>").attr("value",s.name).text(s.name).appendTo(o);o.change(function(){var i=n(this),u=i.closest(".webgis-query-builder-table-row"),t=i.val()?n.grep(r.field_defs,function(n){return n.name===i.val()})[0]:null,o=u.find(".webgis-input.webgis-query-builder-operators").empty(),e,f;if(t&&t.operators){u.find(".webgis-input.depends-on-fields").css("display","block");for(e in t.operators)f=t.operators[e],n("<option>").attr("value",f).text(f).appendTo(o)}else u.find(".webgis-input.depends-on-fields").css("display","")});e.change(function(){var r=n(this),e=r.val(),u=r.closest(".webgis-query-builder-table-row"),o=u.attr("row-id"),s=u.closest(".webgis-query-builder-table"),f=n.grep(s.children("tr"),function(t){return n(t).attr("row-id")>o});e?f.length===0&&i(t):n.each(f,function(t,i){n(i).remove()})})}},f=function(t){let i=0,r=t.find(".webgis-query-builder-table");return r.children("tr").each(function(t,r){i=Math.max(n(r).attr("row-id"))}),i+1},e=function(t,i){let f=t.find(".webgis-query-builder-table"),r=[];f.children("tr").each(function(t,u){let f=n(u),e=f.find(".webgis-input.webgis-query-builder-fields").val(),s=f.find(".webgis-input.webgis-query-builder-operators").val(),h=f.find(".webgis-input.webgis-query-builder-value").val(),c=f.find(".webgis-input.webgis-query-builder-logical-operators").val();if(!e)return r.length==0?void 0:(alert("Not a valid query"),!1);var o=n.grep(i.field_defs,function(n){return n.name===e})[0];r.push({field:e,operator:s,value:h,value_template:o?o.value_template:null,logical_operator:c})});var u=t.find(".webgis-query-builder-geometry-option");return{geometry_option:u.length>0?u.val():null,query_defs:r}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_modal=function(t){if(r[t])return r[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_modal");else return r.init.apply(this,arguments)};var i={meta_left_frame:!1,width:"50%",height:"80%",minWidth:"330px",slide:!0,closebutton:!0,blockerclickclose:!0,id:"modaldialog",blocker_alpha:.5,dock:"center",mobile_fullscreen:!0,animate:!0,hasBlocker:!0,titleButtons:null},r={init:function(t){var r=n.extend({},i,t);return this.each(function(){new f(this,r)})},content:function(r){var u=n.extend({},i,r);return n(t(u)).find("#webgis-modal-content")},title:function(r){var u=n.extend({},i,r);return n(t(u)).find(".webgis-modal-title")},close:function(r){if(r=n.extend({},i,r),n(this).hasClass("modal-dialog"))n(this).remove();else if(n(t(r)).length>0)return n(t(r)).remove(),!0;return!1},hide:function(r){r=n.extend({},i,r);n(t(r)).css("display","none")},show:function(r){r=n.extend({},i,r);n(t(r)).css("display","")},toggle_fullscreen:function(r){r=n.extend({},i,r);var u=n(t(r)).find(".webgis-modal-body").get(0);n.fullScreenEnabled()?(u.style.left=u.style.top=u.style.right=u.style.bottom="10px",u.style.border="1px solid #888888",n.exitFullScreen()):(u.style.left=u.style.top=u.style.right=u.style.bottom="0px",u.style.border="",n.fullScreen(u))},toggle_maximize:function(r){r=n.extend({},i,r);var u=n(t(r)).find(".webgis-modal-body").get(0);u.style.width=u.style.height="";u.style.left!=="0px"?u.style.left=u.style.top=u.style.right=u.style.bottom="0px":(u.style.left=u.style.top=u.style.right=u.style.bottom="10px",u.style.border="1px solid #888888")},fit:function(r){var s;if(r=n.extend({},i,r),s=n(window).width()<1024,!s){var f=n(t(r)).find(".webgis-modal-body"),u=f.find("#webgis-modal-content"),e=0,o=0;if(u.children().each(function(t,i){e=Math.max(n(i).outerWidth()+parseInt(parseInt(n(i).css("marginLeft"))+parseInt(n(i).css("marginRight"))),e);o+=n(i).outerHeight()+parseInt(parseInt(n(i).css("marginTop"))+parseInt(n(i).css("marginBottom")))}),o+=parseInt(u.css("paddingTop"))+parseInt(u.css("paddingBottom")),e+=parseInt(u.css("paddingLeft"))+parseInt(u.css("paddingRight")),r.dock==="left"||r.dock==="right")f&&f.css({width:e+parseInt(parseInt(u.css("paddingLeft"))+parseInt(u.css("paddingRight")))});else{const n=f.position();n&&f.css({width:e,height:o+60,maxHeight:"calc(100% - "+f.position().top+"px)"})}}}},f=function(i,r){var k=n(window).width(),d=n(window).height(),w=n(i),s,c,l,e,h,a;w.find(t(r)).each(function(n,t){t.parentNode.removeChild(t)});s=n(window).width()<1024&&r.mobile_fullscreen===!0;c=s&&screen.width<800;let y=c===!1&&(r.dock==="left"||r.dock==="right"),g=y&&!r.closebutton;var b=r.framepos?r.framepos:s&&r.dock==="center"||c&&r.dock!=="center"?"left:4px;right:4px;top:4px;bottom:4px;":"width:"+r.width+";height:"+r.height+";min-width:"+r.minWidth+";max-height:"+r.maxHeight+";max-width:100%;",o=n("<div id='"+u(r)+"' style='z-index:9999;position:fixed;left:0px;right:0px;top:0px;bottom:0px;background:rgba(0,0,0,"+r.blocker_alpha+");' class='webgis-modal'><\/div>"),f=n("<div id='"+(r.hasBlocker===!0?"":u(r))+"' style='z-index:1000;position:absolute;"+b+"background:white;opacity:0;"+(s===!0?"":"display:none;")+"' class='webgis-modal-body "+r.dock+"'><\/div>").appendTo(o),p;if(p=s===!0?"left:0px;top:44px;right:0px;bottom:0px":"left:0px;top:44px;right:0px;bottom:0px",l=n("<div id='webgis-modal-content' class='webgis-modal-content' style='z-index:1;position:absolute;overflow:auto;"+p+"'><\/div>"),r.content&&l.html(r.content),o.appendTo(n(i)),l.appendTo(f),f.click(function(n){n.stopPropagation()}),r.blockerclickclose){o.on("mousedown",function(t){n(this).data("mousedown_x",t.originalEvent.offsetX);n(this).data("mousedown_y",t.originalEvent.offsetY)});o.click(function(t){var i=t.originalEvent.offsetX-n(this).data("mousedown_x"),r=t.originalEvent.offsetY-n(this).data("mousedown_y");Math.abs(i)<5&&Math.abs(r)<5&&(n(this).find(".webgis-modal-close").length>0?n(this).find(".webgis-modal-close").trigger("click"):n(this).find(".webgis-modal-close-element").length>0&&n(this).find(".webgis-modal-close-element").trigger("click"))})}if(c===!1&&r.dock==="left")f.css({left:0,bottom:0,top:0,height:"",maxHeight:"",width:r.width}),r.hasBlocker===!1&&o.css({right:"",width:r.width});else if(c===!1&&r.dock==="right")f.css({right:0,bottom:0,top:0,height:"",maxHeight:"",width:r.width}),r.hasBlocker===!1&&o.css({left:"",width:r.width});else if(r.dock==="center"){let n=Math.max(0,(o.height()/2-f.height()/2)/2);f.css({left:o.width()/2-f.width()/2,top:n,maxHeight:"calc(100% - "+2*n+"px)"})}e=n("<div style='position:absolute;left:0px;right:0px;top:0px;height:35px'><div class='webgis-modal-title'>"+(r.title?r.title:"")+"<\/div><\/div>");h=null;e.appendTo(f);let v=0;if(r.closebutton&&(v++,e.children(".webgis-modal-title").addClass("has-closebutton"),y||(v++,n("<div class='webgis-modal-resize'><\/div>").appendTo(e)),h=n("<div class='webgis-modal-close'><\/div>"),h.appendTo(e).get(0).options=r,h.click(function(t){t.stopPropagation();r.onclose&&r.onclose();n(null).webgis_modal("close",this.options)})),r.titleButtons&&r.titleButtons.length>0)for(let t in r.titleButtons){let i=r.titleButtons[t];n("<div>").addClass("webgis-modal-title-button").css({right:v*44,backgroundImage:"url("+i.img+")"}).data("tileButton",i).appendTo(e).click(function(t){t.stopPropagation();let i=n(this).data("tileButton");if(i.onClick)i.onClick(i)});v++}if(y?(f.addClass("enlargeable"),e.click(function(){var t=n(this).closest(".webgis-modal-body"),i=n(this).closest(".webgis-modal");t.hasClass("modal-large")?(t.css("width",330),r.hasBlocker===!1&&i.css("width",Math.min(screen.width,330))):(t.css("width",640),r.hasBlocker===!1&&i.css("width",Math.min(screen.width,640)));t.toggleClass("modal-large")})):r.dock==="center"&&e.css("cursor","pointer").click(function(){var t=n(this).closest(".webgis-modal-body");t.hasClass("maximized")?t.css({width:t.attr("data-normal-width"),height:t.attr("data-normal-height"),left:t.attr("data-normal-left"),top:t.attr("data-normal-top"),right:"",bottom:""}).removeClass("maximized"):(t.attr("data-normal-width",t.css("width")).attr("data-normal-height",t.css("height")).attr("data-normal-left",t.css("left")).attr("data-normal-top",t.css("top")),t.css({left:"0px",top:"0px",right:"0px",bottom:"0px",width:"auto",height:"auto"}).addClass("maximized"));r&&r.onresize&&webgis.delayed(function(){r.onresize()},500)}),s===!1&&(r.onmaximize||r.allowfullscreen===!0)&&(a=n("<table style='cursor:pointer;color:black;font-size:14px;font-weight:bold;position:absolute;top:2px;right:72px;margin:4px'><tr><td>Fullscreen<\/td><td><div class='i8-button-26 i8-maximize-26-w'><\/div><\/td><\/tr><\/table>"),a.appendTo(e),r.onmaximize?(a.get(0).onmaximize=r.onmaximize,a.click(function(){this.onmaximize()})):a.click(function(){n(null).webgis_modal("toggle_fullscreen")})),f.css("display","block"),r.onload)r.onload(l);h&&webgis.setHistoryItem(h,l);f.removeClass("animate");webgis.delayed(function(t){if(r.animate&&r.show!==!1){var i=t.css("height"),u=t.css("width"),f=t.position().left,e=t.position().top,o=t.css("min-height"),s=t.css("min-width");t.css(r.dock=="left"?{opacity:1,minWidth:"0px",width:"0px",height:i,left:0,top:0}:{width:"0px",height:"0px",minWidth:"0px",minHeight:"0px",left:n(document).width()/5,top:n(document).height()/2});webgis.delayed(function(n){n.addClass("animate").css({opacity:1,minWidth:s,minHeight:o,width:u,height:i,left:f,top:e})},10,t)}else t.css("opacity",1)},10,f)},u=function(n){if(n.id)return"webgis-modal-"+n.id.replace(/\./g,"-").replace(/:/g,"-")},t=function(n){var t=u(n);return t===""?".webgis-modal":"#"+t+".webgis-modal"}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_modalprogress=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_modalprogress");else return t.init.apply(this,arguments)};var i={title:"webGIS",message:"...",width:"200px",height:"120px",slide:!1,closebutton:!1,cancelable:!1,oncancel:function(){},blocker_alpha:0,id:"webgis-modalprogress"},t={init:function(t){var r=n.extend({},i,t);return this.each(function(){var i=n(this).webgis_modal("content",r),u;i.length>0?(u=null,i.find(".webgis-progress-message").each(function(t,i){n(i).data("message")===r.message&&(u=n(i))}),u||n("<div class='webgis-progress-message webgis-progress-message-running'><img class='webgis-progress-message-img' src='"+webgis.baseUrl+"/content/api/img/hourglass/loader1.gif' style='width:16px;height:16px' />&nbsp;"+r.message+"<\/div>").data("message",r.message).appendTo(i)):(r.onload=function(i){if(i.css({padding:"10px",background:"white",color:"black"}),i.parent().css({background:""}).addClass("webgis-tabs-tab-header").css("font-size","1em").css("font-weight","normal"),n("<div class='webgis-progress-message webgis-progress-message-running'><img class='webgis-progress-message-img' src='"+webgis.baseUrl+"/content/api/img/hourglass/loader1.gif' style='width:16px;height:16px' />&nbsp;"+r.message+"<\/div>").data("message",r.message).appendTo(i),r.cancelable){var u=n("<div><\/div>").css({"text-align":"right","margin-top":10}).appendTo(i);n("<button class='webgis-button'>Abbrechen<\/button>").appendTo(u).data("options",t).click(function(){var t=n(this).data("options");n(null).webgis_modal("close",{id:"webgis-modalprogress"});t.oncancel&&t.oncancel()})}},r.mobile_fullscreen=!1,n(this).webgis_modal(r))})},close:function(t){var f=n(this),r=n.extend({},i,t),u=f.webgis_modal("content",r);u.length>0&&(u.find(".webgis-progress-message").each(function(t,i){n(i).data("message")===r.message&&n(i).removeClass("webgis-progress-message-running").fadeOut()}),u.find(".webgis-progress-message-running").length===0&&webgis.delayed(function(){u.find(".webgis-progress-message-running").length===0;f.webgis_modal("close",r)},300,r))}}}(webgis.$||jQuery),function(n){n.fn.webgis_toolbox=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_toolbox");else return t.init.apply(this,arguments)};var f={map:null,fireEvent:!1,containers:[{name:"Navigation",tools:[webgis.tools.navigation.fullExtent,webgis.tools.navigation.currentPos,webgis.tools.navigation.zoomBack,webgis.tools.navigation.refreshMap,webgis.tools.navigation.saveMap,webgis.tools.navigation.loadMap]},{name:"Abfragen",tools:[webgis.tools.info.identify,webgis.tools.info.coordinates,webgis.tools.info.queryResults]},{name:"Werkeuge",tools:[webgis.tools.advanced.measureDistance,webgis.tools.advanced.measureArea,webgis.tools.advanced.profile,webgis.tools.advanced.mapmarkup,webgis.tools.advanced.edit]}]},t={init:function(t){var i=n(this);return t=n.extend({},f,t),this.each(function(){new e(this,t)})}},e=function(t,i){var u=n(t);if(!u.hasClass("no-toolbox")&&(t._map=i.map,t._containers=t._containers&&t._containers.length>0?t._containers:i.containers,u.addClass("webgis-toolbox-holder"),t.tools?r(t):(u.html("<img src='"+webgis.css.imgResource("loader1.gif","hourglass")+"' />..."),webgis.toolInfos(i.tools,null,function(f){var c,h,s,e;if(t.tools=f,i.usertools){c={name:i.usertools_containername||"Benutzerdef. Werkzeuge",tools:[]};for(e in i.usertools)c.tools.push(i.usertools[e].id),t.tools.push(i.usertools[e]);t._containers.push(c)}for(h=0;h<t._containers.length+1;h++)for(s=h+1;s<t._containers.length;s++)if(t._containers[h].name===t._containers[s].name){for(e in t._containers[s].tools)n.inArray(t._containers[s].tools[e],t._containers[h].tools,0)<0&&t._containers[h].tools.push(t._containers[s].tools[e]);t._containers[s].tools=null}for(e in f)o(t._containers,f[e])&&i.map.addTool(f[e]);t._containers=i.map._mapToolsToServerContainers(t._containers);r(t);u.hasClass("no-toolbox")&&u.empty();i.fireEvent&&t._map.events.fire("toolboxloaded",t._map);n.fn.webgis_toolbox._toolsLoaded=!0})),i.map)){webgis.delayed(function(){i.map.ui.refreshUIElements()},100);i.map.events.on("onchangeactivetool",function(t,i){var u=i.getActiveTool(),f,r;n(".webgis-toolbox-tool-item.selected").each(function(){n(this).hasClass("webgis-toggle-button")||n(this).removeClass("selected")});u&&(f=n(".webgis-toolbox-tool-item[data-toolid='"+u.id+"']"),f.addClass("selected"),r=n(".webgis-toolbar-holder"),r.length===1&&n.fn.webgis_toolbar&&r.webgis_toolbar("selectCurrentToolTab"))})}},r=function(t){var b,r,a,k,c,d,f,e,o,s,g;$elem=n(t);$elem.empty();var v=t.tools,h=t._containers,l=n("<ul id='webgis-toolbox-list'><\/ul>").appendTo($elem),y=!1,p=n("<ul>").appendTo(u(l,"Favoriten"));if(webgis.custom.tools){e=webgis.custom.tools.toArray();for(o in e){var s=e[o],w=n.grep(h,function(n){return n.name==s.container}),r=w.length===0?null:w[0];r===null&&h.push(r={name:s.container});r.hasCustomTools=!0}}for(b in h)if(r=h[b],r.tools&&r.options||r.hasCustomTools||r.tools||r.options){if(!r.tools&&r.options){try{f=t._map.getTool(webgis.tools.getToolId(r.name));f&&(f.options=r.options)}catch(nt){}continue}a=n("<ul>").css("display","none").appendTo(u(l,r.name));for(o in r.tools||[])for(k=r.tools[o],c=0,d=v.length;c<d;c++)f=v[c],f.id===k&&(f.uiElement=t,f.map=t._map,f.onRelease=function(t){if(console.log("onRelease",t),t.parentTool)webgis.tools.onButtonClick(t.map,t.parentTool);else t.type=="clientbutton"||t.type=="serverbutton"||(t.map.setActiveTool(null),n(t.uiElement).webgis_uibuilder("empty",{map:t.map}).webgis_toolbox({map:t.map}))},f.favorite_priority&&(i(p,f,!0),y=!0),i(a,f));if(r.hasCustomTools&&webgis.custom.tools){e=n.grep(webgis.custom.tools.toArray(),function(n){return n.container===r.name});for(o in e)s=e[o],t._map.getTool(s.id)==null&&t._map.addTool(s),g=i(a,s)}}y===!1&&p.parent().remove();l.find(".webgis-toolbox-container-title:first").trigger("click")},u=function(t,i){var r=n("<li class='webgis-toolbox-tool-item-group webgis-toolbox-collapsable'>").attr("data-name",i).appendTo(t),u=n("<div class='webgis-toolbox-container-title'><span style='position:absolute' class='webgis-api-icon webgis-api-icon-triangle-1-s'><\/span><span style='margin-left:14px'>&nbsp;"+i+"<\/span><\/div>").appendTo(r).click(function(){var t=n(this),i=this;t.children(".webgis-api-icon-triangle-1-e").length>0?(t.children(".webgis-api-icon-triangle-1-e").removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s"),t.parent().removeClass("selected").children("ul").slideUp()):(t.parent().parent().find(".webgis-toolbox-container-title .webgis-api-icon-triangle-1-e").each(function(t,i){n(i).removeClass("webgis-api-icon-triangle-1-e").addClass("webgis-api-icon-triangle-1-s");n(i).parent().parent().children("ul").slideUp()}),t.parent().parent().find(".selected").removeClass("selected"),t.children(".webgis-api-icon-triangle-1-s").removeClass("webgis-api-icon-triangle-1-s").addClass("webgis-api-icon-triangle-1-e"),t.parent().addClass("selected").children("ul").slideDown())});return r},i=function(t,i,r){var u,e,f;if(!(n.inArray(i.id,["webgis.tools.addtoselection","webgis.tools.removefromselection"])>=0)){if($li=n("<li class='webgis-toolbox-tool-item'>").attr("data-toolid",i.id),r&&i.favorite_priority?($li.attr("data-priority",i.favorite_priority),u=null,t.children().each(function(t,r){u==null&&n(r).attr("data-priority")&&parseInt(n(r).attr("data-priority"))>i.favorite_priority&&(u=n(r))}),u!==null?$li.insertBefore(u):$li.appendTo(t)):$li.appendTo(t),e="",e=i.image?webgis.css.imgResource(i.image,"tools"):i.hasui==!0?webgis.css.imgResource("enter-26.png","ui"):webgis.css.imgResource(i.image,"tools"),n("<span class='webgis-toolbox-tool-item-span'><img src='"+e+"' /><span class='webgis-toolbox-tool-item-label'>&nbsp;"+i.name+"<\/span><\/span>").appendTo($li).attr("alt",i.name+": "+i.tooltip).attr("title",i.name+": "+i.tooltip),$li.get(0).tool=i,i.dependencies&&i.dependencies.length>0)for($li.addClass("webgis-dependencies"),f=0;f<i.dependencies.length;f++)$li.addClass("webgis-dependency-"+i.dependencies[f]);return $li.click(function(){var t=n(this).closest(".webgis-toolbox-holder"),i=t.get(0)._map,r=this.tool;webgis.tools.onButtonClick(i,r)}),$li}},o=function(t,i){var f,u,e,r;for(f in t)if(u=t[f],u.tools)for(e in u.tools)if(u.tools[e]===i.id)return!0;if(webgis.usability.appendMapTools&&n.inArray(i.id,webgis.usability.appendMapTools)>=0){if(r=n.grep(t,function(n){return n.name===i.container}),r.length===1)return r[0].tools=r[0].tools||[],r[0].tools.push(i.id),!0;if(r.length===0)return t.push({name:i.container,tools:[i.id]}),!0}return!1}}(webgis.$||jQuery),function(n){n.fn.webgis_toolbar=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_toolbar");else return t.init.apply(this,arguments)};var r={map:null,containers:null},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new f(this,t)})},intialize:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})},selectCurrentToolTab:function(){var r=n(this),u=r.find(".webgis-toolbox-tool-item.selected"),t,f,i;u.length===1&&(t=u.closest(".webgis-toolbar-tabcontent[data-index]"),t.length===1&&(f=t.attr("data-index"),i=r.find(".webgis-toolbar-tab[data-index='"+f+"']"),i.hasClass("selected")||i.trigger("click")))}},f=function(t,r){var l=n(t).addClass("webgis-toolbar-holder").data("map",r.map),b,v,d,f,nt,p,y,o,s,h,g,c;if(r.containers){var a=n("<ul>").addClass("webgis-toolbar-tabs").appendTo(l),e=0,w=!1;if(n("<li>&nbsp;<\/li>").addClass("webgis-toolbar-tab favorites").attr("data-index",e).appendTo(a),b=n("<ul>").addClass("webgis-toolbar-tabcontent favorites").attr("data-index",e).css("display","none").appendTo(l),e++,v=r.map._mapToolsToServerContainers(r.containers)||[],webgis.custom.tools){o=webgis.custom.tools.toArray();for(s in o){var h=o[s],k=n.grep(v,function(n){return n.name==h.container}),f=k.length===0?null:k[0];f===null&&v.push(f={name:h.container});f.hasCustomTools=!0}}for(d in v)if(f=v[d],f.tools&&f.tools.length!==0||f.hasCustomTools){nt=n("<li>"+f.name+"<\/li>").addClass("webgis-toolbar-tab").attr("data-index",e).appendTo(a);p=n("<ul>").addClass("webgis-toolbar-tabcontent").attr("data-index",e).css("display","none").appendTo(l);for(s in f.tools||[])(y=r.map._tools[f.tools[s]],y)&&(y.favorite_priority&&(i(b,r,y,!0),w=!0),g=i(p,r,y));if(f.hasCustomTools&&webgis.custom.tools){o=n.grep(webgis.custom.tools.toArray(),function(n){return n.container===f.name});for(s in o)h=o[s],r.map.getTool(h.id)==null&&r.map.addTool(h),g=i(p,r,h)}e++}if(webgis.help.url&&(c=n("<li>?<\/li>").addClass("webgis-toolbar-tab help").appendTo(a),r.map))r.map.events.on("onchangeactivetool",function(n,t){var i=t.getActiveTool();t.isDefaultTool(i)?(c.css("background-image",""),i.help_urlpath_defaulttool?c.addClass("help-exists"):c.removeClass("help-exists")):i&&i.help_urlpath?c.addClass("help-exists").css("background-image","url("+webgis.css.imgResource(i.image,"tools")+")"):c.removeClass("help-exists").css("background-image","")});w===!1&&(l.find(".webgis-toolbar-tab.favorites").remove(),l.find(".webgis-toolbar-tabcontent.favorites").remove());a.children(".webgis-toolbar-tab").click(function(){var i=n(this),f=i.closest(".webgis-toolbar-tabs"),u=f.closest(".webgis-toolbar-holder"),r,t;i.hasClass("help")?(r=u.data("map"),t=r.getActiveTool(),webgis.showHelp(t?r.isDefaultTool(t)&&t.help_urlpath_defaulttool?t.help_urlpath_defaulttool:t.help_urlpath:null,r)):(f.find(".webgis-toolbar-tab").removeClass("selected"),u.find(".webgis-toolbar-tabcontent").css("display","none"),i.addClass("selected"),u.find(".webgis-toolbar-tabcontent[data-index='"+i.attr("data-index")+"']").css("display","block"))});a.find(".webgis-toolbar-tab").first().trigger("click");r.map;u(t,r)}},i=function(t,i,r,u){var f,o,s,e;if(!(n.inArray(r.id,["webgis.tools.addtoselection","webgis.tools.removefromselection"])>=0))return f=n("<li class='webgis-toolbox-tool-item'>"),o="",o=r.image?webgis.css.imgResource(r.image,"tools"):r.hasui==!0?webgis.css.imgResource("enter-26.png","ui"):webgis.css.imgResource(r.image,"tools"),s=n("<span class='webgis-toolbox-tool-item-span'><img src='"+o+"' /><span class='webgis-toolbox-tool-item-label'>&nbsp;"+r.name+"<\/span><\/span>").appendTo(f).attr("alt",r.name+": "+r.tooltip).attr("title",r.name+": "+r.tooltip),u===!0&&r.favorite_priority?(f.attr("data-priority",r.favorite_priority),e=null,t.children().each(function(t,i){e==null&&n(i).attr("data-priority")&&parseInt(n(i).attr("data-priority"))>r.favorite_priority&&(e=n(i))}),e!==null?f.insertBefore(e):f.appendTo(t)):f.appendTo(t),f.click(function(){var t=n(this).closest(".webgis-toolbar-holder"),i=t.data("map"),r=n(this).data("tool");webgis.tools.onButtonClick(i,r)}),f.data("tool",r).attr("data-toolid",r.id),f},u=function(t,i){if(i.map){var u=n(t),r=i.map;u.find(".webgis-toolbox-tool-item[data-toolid]").each(function(){var u=n(this),t=r.getTool(u.attr("data-toolid")),i;if(t&&t.dependencies&&t.dependencies.length>0)for(u.addClass("webgis-dependencies"),i=0;i<t.dependencies.length;i++)u.addClass("webgis-dependency-"+t.dependencies[i])});r.ui.refreshUIElements()}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_uibuilder=function(t){if(u[t])return u[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_uibuilder");else return u.init.apply(this,arguments)};var f={map:null,tool:null,elements:null,title:"UI",closebutton:!0,onclose:null,oncloseArgument:null,append:!1,event:null,toolDialogId:null},u={init:function(t){var i=n(this),t=n.extend({},f,t);return i.length==0?o(this,t):this.each(function(){new o(this,t)})},append_ctrl_bbox_info:function(t){var i=n(this),t=n.extend({},f,t);return i.length==0?s(this,t):this.each(function(){new s(this,t)})},removeSecondoaryToolUI:function(n){n.map&&(n.map.ui.advancedToolBehaviour()===!0?n.map.ui.webgisContainer().find(".webgis-tabs-tab-content").find(".webgis-tooldialog-header.secondary span.close").trigger("click"):(n.map.ui.webgisContainer().webgis_modal("close",{id:e.serverButtonModalDialogId}),n.map.ui.webgisContainer().find(".webgis-tabs-holder").webgis_tabs("hide",{tab:"tools"})))},empty:function(t){return r(n(this),t),n(this)}},e={serverButtonModalDialogId:"server-button-modal-dialog"},o=function(t,u){var s=n(t),v=s,et=null,ot=null,pt=null,wt=null,bt=null,kt=null,ut,ft,k,p,li,a,b,f,rt,o,yt;if(u.map&&u.tool&&u.tool.id&&u.map.events.fire("onbuildtoolui"),u.toolDialogId||(u.toolDialogId=u.map&&u.map.getActiveTool()?u.map.getActiveTool().id:null),s.addClass("webgis-ui-holder"),u.elements){var dt=!1,nt=!1,d=!1,gt=!1,ni=!1,ti=!1,ii=!1,ri=!1,g=u.title,y=u.title,tt=u.title,st=u.title,ht=u.title,ct="330px",it=null,ui=!1,fi=!1,ei=!1,oi=!1,si=!1,hi=!1,lt=!0,at=!0,vt=!0,ci=!1,w=null;for(f=0,rt=u.elements.length;f<rt;f++)if(!u.elements[f].target||u.elements[f].target.indexOf("#")!==0){u.map&&u.map.events.fire("onbuildui-"+u.elements[f].target);switch(u.elements[f].target){case"modaldialog":w=u.elements[f];nt=!0;g=u.elements[f].targettitle||g;ct=u.elements[f].targetwidth||ct;it=u.elements[f].targetheight||it;ui=i(u.elements[f]);break;case"modaldialog_hidden":w=u.elements[f];nt=!0;lt=!1;g=u.elements[f].targettitle||g;break;case"tool_modaldialog":w=u.elements[f];d=!0;y=u.elements[f].targettitle||y;fi=i(u.elements[f]);break;case"tool_modaldialog_hidden":w=u.elements[f];d=!0;at=!1;y=u.elements[f].targettitle||y;break;case"tool_modaldialog_noblocking":w=u.elements[f];d=!0;vt=!1;y=u.elements[f].targettitle||y;break;case"tool_modaldialog_noblocking_closable":w=u.elements[f];d=!0;vt=!1;ci=!0;y=u.elements[f].targettitle||y;break;case"tool_sidebar_bottom":ni=!0;st=u.elements[f].targettitle||st;oi=i(u.elements[f]);break;case"tool_sidebar_top":ti=!0;ht=u.elements[f].targettitle||ht;si=i(u.elements[f]);break;case"tool_sidebar_left":gt=!0;tt=u.elements[f].targettitle||tt;ei=i(u.elements[f]);break;case"tool_aside":ii=!0;hi=i(u.elements[f]);break;case"tool_persistent_topic":ri=!0;break;default:dt=!0}}for(dt===!0&&(u.append||(ut=!u.tool||u.tool.type!=="clientbutton"&&u.tool.type!=="serverbutton",ut||u.map.ui.advancedToolBehaviour()!==!1?(ut?r(s,u):s.find(".webgis-tooldialog-header.secondary span.close").trigger("click"),u.closebutton?(s.children(".webgis-tooldialog-header").addClass("collapsed"),s.length>0&&(k=n("<div style='cursor:pointer'><h2>"+(u.title||"Dialog")+"<span class='close'><\/span><\/h2><\/div>").addClass("webgis-tooldialog-header"+(ut?" primary":" secondary")).appendTo(s).click(function(){var t=n(this);if(t.hasClass("collapsed"))t.parent().children(".webgis-tooldialog-header").each(function(t,i){n(i).addClass("collapsed")}),t.removeClass("collapsed"),t.parent().children(".webgis-tooldialog-header.secondary").find("span.close").trigger("click");else if(this.onclose){let i=t.closest("#tab-tools-content").find(".webgis-form-container"),n=this;webgis.confirmDiscardChanges(i,u.map,function(){n.onclose(n.oncloseArgument)})}}).get(0),n(k).find("span.close").click(function(t){var i,f;t.stopPropagation();i=n(this).closest(".webgis-tooldialog-header");i.hasClass("primary")?i.removeClass("collapsed").trigger("click"):i.hasClass("secondary")&&(i.parent().children(".webgis-tooldialog-header.primary.collapsed").first().trigger("click"),f=i.next(".webgis-tooldialog-content"),r(f,u),f.remove(),i.remove())}),n(k).hasClass("secondary")&&u.tool&&u.tool.image&&n(k).css("background-image","url("+webgis.css.imgResource(u.tool.image,"tools")+")"),u.map&&u.tool&&u.tool.help_urlpath&&n("<div>").addClass("help").data("map",u.map).data("tool",u.tool).appendTo(n(k)).click(function(t){t.stopPropagation();var r=n(this).data("map"),i=n(this).data("tool")||r.getActiveTool();webgis.showHelp(i?r.isDefaultTool(i)&&i.help_urlpath_defaulttool?i.help_urlpath_defaulttool:i.help_urlpath:null,r)}),k.onclose=u.onclose,k.oncloseArgument=u.oncloseArgument),s=n("<div>").addClass("webgis-tooldialog-content").addClass(u.tool&&u.tool.id?u.tool.id.replaceAll(".","-"):"").appendTo(s)):u.title&&n("<div><h2>"+u.title+"<\/h2><\/div>").appendTo(s)):(ft={width:"330px",title:u.title,id:e.serverButtonModalDialogId},s=u.map.ui.webgisContainer().webgis_modal("content",ft),s.length===0&&(u.map.ui.webgisContainer().webgis_modal(ft),s=u.map.ui.webgisContainer().webgis_modal("content",ft)),u.append!==!0&&r(s,u)))),nt===!0&&(ui?u.map.ui.webgisContainer().webgis_modal("close"):(u.map.ui.webgisContainer().webgis_modal({width:ct,height:it,show:lt,title:g,slide:!1,onclose:()=>c(u.map,w)}),v=et=u.map.ui.webgisContainer().webgis_modal("content"))),d===!0&&(fi?u.map.ui.webgisContainer().webgis_modal("close",{id:u.toolDialogId}):(u.map.ui.webgisContainer().webgis_modal({width:"330px",show:at,title:y,hasBlocker:vt,slide:!1,id:u.toolDialogId,closebutton:ci,onclose:()=>c(u.map,w),dock:"left",animate:!0}),v=ot=u.map.ui.webgisContainer().webgis_modal("content",{id:u.toolDialogId}))),ni===!0&&(oi?u.map.ui.webgisContainer().webgis_dockPanel("close",{dock:"bottom",id:u.toolDialogId}):(u.map.ui.webgisContainer().webgis_dockPanel({title:st,dock:"bottom",id:u.toolDialogId,refElement:u.map.ui.mapContainer(),map:u.map}),v=wt=u.map.ui.webgisContainer().webgis_dockPanel("content",{id:u.toolDialogId}))),ti===!0&&(si?u.map.ui.webgisContainer().webgis_dockPanel("close",{dock:"top",id:u.toolDialogId}):(u.map.ui.webgisContainer().webgis_dockPanel({title:ht,dock:"top",id:u.toolDialogId,refElement:u.map.ui.mapContainer(),map:u.map,autoResizeBoth:!0,onload:function(){}}),v=bt=u.map.ui.webgisContainer().webgis_dockPanel("content",{id:u.toolDialogId}))),gt===!0&&(ei?u.map.ui.webgisContainer().webgis_dockPanel("close",{dock:"left",id:u.toolDialogId}):(u.map.ui.webgisContainer().webgis_dockPanel({title:tt,dock:"left",id:u.toolDialogId,refElement:u.map.ui.mapContainer(),map:u.map}),v=pt=u.map.ui.webgisContainer().webgis_dockPanel("content",{id:u.toolDialogId}))),ii===!0&&(hi?u.map.ui.webgisContainer().webgis_dockPanel("close",{dock:"right",id:u.toolDialogId+"_aside"}):(u.map.ui.webgisContainer().webgis_dockPanel({title:tt,dock:"right",id:u.toolDialogId+"_aside",useIdSelector:!0,size:340,adverseSize:400,maximizeAdverse:!0,canClose:!1,refElement:u.map.ui.mapContainer(),map:u.map}),v=kt=u.map.ui.webgisContainer().webgis_dockPanel("content",{id:u.toolDialogId+"_aside"}),v.css("padding","5px"))),ri===!0&&(b=u.map.getActiveTool(),b&&b.id&&(v=n("#"+b.id.replaceAll(".","-")+"-persistent-topic"))),p=0,li=u.elements.length;p<li;p++){if(u.elements[p].target&&u.elements[p].target.indexOf("#")===0)a=n(u.elements[p].target),u.append||a.empty();else switch(u.elements[p].target){case"modaldialog":case"modaldialog_hidden":a=et;break;case"tool_modaldialog":case"tool_modaldialog_hidden":case"tool_modaldialog_noblocking":case"tool_modaldialog_noblocking_closable":a=ot;break;case"tool_sidebar_bottom":a=wt;break;case"tool_sidebar_top":a=bt;l(a);break;case"tool_sidebar_left":a=pt;break;case"tool_aside":a=kt;break;case"tool_persistent_topic":b=u.map.getActiveTool();b&&b.id&&(a=n("#"+b.id.replaceAll(".","-")+"-persistent-topic"),u.append||l(a));break;default:a=s;u.map&&u.map.ui.uncollapseSidebar()}h(u.map,a,u.elements[p],u);u.map.events.fire("ui-builder-targetelement-changed",u.map,{target:u.elements[p].target,element:a})}nt===!0&&(it||u.map.ui.webgisContainer().webgis_modal("fit"),lt===!1&&u.map.ui.webgisContainer().webgis_modal("hide"));d===!0&&(u.map.ui.webgisContainer().webgis_modal("fit",{id:u.toolDialogId,dock:"left"}),at===!1&&u.map.ui.webgisContainer().webgis_modal("hide",{id:u.toolDialogId}))}if(u.setters)for(f=0,rt=u.setters.length;f<rt;f++)o=u.setters[f],o.name==="addclass"?n("#"+o.id).addClass(o.val):o.name==="removeclass"?n("#"+o.id).removeClass(o.val):o.name==="selectoption"?(yt=n("#"+o.id),yt.find(".webgis-ui-option-selected").removeClass("webgis-ui-option-selected"),yt.find("[data-value='"+o.val+"']").addClass("webgis-ui-option-selected")):o.name==="_anonymous-user-id"?webgis.localStorage.setAnonyousUserId(o.val):(o.id==="_webgis_setter_persistent_parameters_"&&u.map&&u.map.applyPersistentToolParameters(o.val,function(n){n.hasClass("webgis-validation")&&n.webgis_validation("validate")}),n("#"+o.id).each(function(t,i){var f,u,e;let r=n(i);if(r.hasClass("webgis-ui-optionscontainer"))i.value=o.val,r.children().removeClass("webgis-ui-option-selected").each(function(t,i){var r=n(i);if(r.data("_value")==o.val)return r.addClass("webgis-ui-option-selected"),!1});else if(r.hasClass("webgis-bbox-input-holder"))r.webgis_bbox_input("val",o.val);else if(r.hasClass("webgis-size-input-holder"))r.webgis_size_input("val",o.val);else if(r.hasClass("webgis-static-overlay-control"))r.webgis_staticOverlayControl("val",o.val);else switch(i.nodeName.toLowerCase()){case"input":r.val(o.val);break;case"select":if(o.options&&o.options.length>0){n(i).empty();for(f in o.options)u=o.options[f],n("<option value='"+u.value+"'>"+u.label+"<\/option>").appendTo(n(i));e=this.map.getTool(n(i).attr("data-tool-id"))||this.map.getActiveTool();n(i).val(o.val||n(i).data("initial-value")||this.map.getPersistentToolParameter(e,this.id));n(i).hasClass("webgis-validation")&&n(i).webgis_validation("validate")}else o.options&&o.options.length===0&&n(i).empty(),n(i).val(o.val).data("initial-value",o.val);break;default:r.html(o.val)}r.hasClass("webgis-validation")&&r.webgis_validation("validate")}));webgis._appendAutocomplete(s);webgis._appendAutocomplete(et);webgis._appendAutocomplete(ot);v.find(".webgis-ui-added.webgis-select-has-dependency-field-ids").each(function(t,i){var r,t;n(i).removeClass("webgis-ui-added").change(function(){n(this).val()&&n(this).data("initial-value",n(this).val())});i.map=u.map;i.refillSelect=function(t){webgis.delayed(function(t){var i=n(t),f={"combo-id":i.attr("id")},r="servertoolcommand",u=null;i.data("dependency_field_ids_callback_toolid")&&(r="servertoolcommand_ext",u=i.data("dependency_field_ids_callback_toolid"));webgis.tools.onButtonClick(t.map,{command:"_event_handler_onupdatecombo",type:r,id:u,map:t.map},this,null,f)},1,t)};r=n(i).data("dependency-field-ids");for(t in r)n("#"+r[t]).change(function(){var t=n(this);v.find(".webgis-select-has-dependency-field-ids").each(function(i,r){n.inArray(t.attr("id"),n(r).data("dependency-field-ids"))>=0&&r.refillSelect(r)})});i.refillSelect(i)});v.find(".webgis-ui-added.webgis-dependencies.webgis-dependency-elementvalue").each(function(t,i){var f=n(i).removeClass("webgis-ui-added").attr("data-dependency-element-id"),u,r;f&&(u=function(t){var i=n(t).val(),r=n(t).attr("id");n(".webgis-dependencies.webgis-dependency-elementvalue").each(function(t,u){var o=n(u).attr("data-dependency-element-id"),f,e;o===r&&(f=n(u).attr("data-dependency-arguments").split(","),e=n(u).attr("data-dependency-condition_result"),i&&(n.inArray("*",f)>=0).toString()==e.toString()||(n.inArray(i,f)>=0).toString()==e.toString()?n(u).css("display","block"):n(u).css("display","none"))})},r=n("#"+f),r.length>0&&(r.change(function(){u(this)}),webgis.delayed(function(n){u(n)},100,r)))});s.hasClass("webgis-temp-tool-ui-element remove-after-build")&&s.remove()},s=function(t){var i=n(t);i.children(".webgis-tooldialog-content").length===1&&(i=i.children(".webgis-tooldialog-content"));i.find(".webgis-ctrl-bbox-info").length==0&&n("<div><strong>"+webgis.l10n.get("tip")+":&nbsp;<\/strong>"+webgis.l10n.get("tip-bbox-tool")+"<\/div>").addClass("webgis-info webgis-ctrl-bbox-info").appendTo(i)},h=function(i,r,u,f){var o,vt,ut,ri,e,ft,ui,yt,d,s,et,di,ot,g,nt,pt,fi,ei,wt,bt,oi,st,kt,c,l,ht,dt,ct,si,gt,ci,tt,k,li,ai,ti,w,it,vi,nr,yi,b,pi,lt,at,rt,wi,ii,bi,ki;if(r&&u){if(o=n(r),u.iscollapsable===!0&&(vt=u.collapsestate==="expanded",ut=n("<div>").appendTo(o).addClass("webgis-ui-collapsable"),u.expandbahavior==="exclusive"&&ut.addClass("webgis-ui-collabsable-exclusive"),ri=n("<div>").appendTo(ut).addClass("webgis-ui-collapsable-title").click(function(){var i=n(this).closest(".webgis-ui-collapsable"),t=i.find(".webgis-ui-collapsable-content");t.css("display")=="none"?(i.parent().find(".webgis-ui-collabsable-exclusive").each(function(t,i){n(i).find(".webgis-ui-collapsable-content").css("display")!=="none"&&n(i).find(".webgis-ui-collapsable-title").trigger("click")}),n(this).find("img").attr("src",webgis.css.imgResource("expanded-26.png","ui")),t.slideDown(),t.find(".webgis-ui-collapsable-autoclick").trigger("click").addClass("webgis-loading").removeClass("webgis-ui-collapsable-autoclick")):(n(this).find("img").attr("src",webgis.css.imgResource("collapsed-26.png","ui")),t.slideUp())}),n("<h2><img src='"+webgis.css.imgResource(vt?"expanded-26.png":"collapsed-26.png","ui")+"'>"+(u.type==="optionscontainer"?"&nbsp;<div class='webgis-ui-selected-option' style='display:inline-block;position:relative;top:7px;height:28px;overflow:hidden'><\/div>":"")+"&nbsp;"+u.title+"<\/h2>").appendTo(ri),o=n("<div>").addClass("webgis-ui-collapsable-content").css("display",vt?"block":"none").appendTo(ut)),e=null,u.type==="label"){ft=u.label.split("|");e=n("<div"+t(u)+"><\/div>").addClass("webgis-label").appendTo(o);const i=u.is_trusted===!0?webgis.asMarkdownOrRawHtml:webgis.asMarkdownOrText;if(ft.length==1)e.html(i(u.label));else for(ui in ft)n("<p>").html(i(ft[ui])).appendTo(e)}else if(u.type==="title")e=n("<h1"+t(u)+"><\/h1>").html(u.label).appendTo(o);else if(u.type==="input-text")e=n("<input type='text' "+t(u)+"/>").appendTo(o).add_webgis_form_element_events(),u.label&&e.val(u.label),e.hasClass("webgis-print-textelement")&&!e.val()&&e.val(i.getPersistentToolParameter("webgis.tools.print","LAYOUT_TEXT_"+e.attr("id")));else if(u.type==="input-textarea")e=n("<textarea rows='5' "+t(u)+"><\/textarea>").appendTo(o).add_webgis_form_element_events(),u.value&&e.text(u.value);else if(u.type==="input-date")e=n("<input type='text' "+t(u)+"/>").appendTo(o).add_webgis_form_element_events(),u.label&&e.val(u.label),webgis.require("flatpickr",function(n){n.flatpickr({weekNumbers:!0,locale:"de",dateFormat:u.date_only===!0?"d.m.Y":"d.m.Y H:i",enableTime:u.date_only!==!0,time_24hr:!0})},e);else if(u.type==="input-number")e=n("<input type='number' "+t(u)+" min='"+u.minValue+"' max='"+u.maxValue+"' step='"+u.stepWidth+"' />").appendTo(o).add_webgis_form_element_events(),u.value&&e.val(u.value);else if(u.type==="hidden")e=n("<input type='hidden' "+t(u)+"/>").appendTo(o).val(u.value),e.hasClass("webgis-map-anonymous-user-id")&&(yt=webgis.localStorage.getAnonymousUserId(),yt?e.val(yt):webgis.localStorage.setAnonyousUserId(e.val()));else if(u.type==="input-autocomplete")e=n("<input type='text' "+t(u)+"/>").appendTo(o),e.addClass("webgis-autocomplete").attr("data-source",u.source),u.label&&e.val(u.label);else if(u.type==="button")e=n("<button "+t(u)+">"+u.text+"<\/button>").appendTo(o),e.addClass("uibutton"),e.data("_value",u.value),s=e.get(0),s.buttoncommand=u.buttoncommand,s.buttoncommand_argument=u.buttoncommand_argument,s.buttontype=u.buttontype,s.map=f.map,u.icon&&e.css("background-image","url("+webgis.css.imgResource(u.icon)+")"),u.ctrl_shortcut&&(e.attr("data-ctrl-shortcut",u.ctrl_shortcut),d=u.ctrl_shortcut.toUpperCase(),e.text().indexOf(d)>=0?e.html(e.html().replaceAll(d,"<u>"+d+"<\/u>")):e.html(e.html()+" (<u>"+d+"<\/u>)")),n(s).click(function(){var t=n(this),i,e,r,u,f;if(t.hasClass("uibutton-validate-input")&&(i=t.closest(".webgis-validation-container"),i.find(".webgis-validation").each(function(t,i){n(i).webgis_validation("validate")}),i.find(".webgis-validation.webgis-not-valid").length>0)){webgis.alert("Bitte geben Sie alle erfordlichen Werte ein!","Eingabevalidierung");return}e=t.closest(".webgis-ui-holder");r=this.map;switch(this.buttoncommand){case"setgraphicsdistancecircleradius":u=n(this).closest(".webgis-ui-optionscontainer").find(".webgis-graphics-distance_circle-radius");t.data("_value",u.length===1?parseFloat(u.val()):null);break;case"setgraphicshectolineinterval":f=n(this).closest(".webgis-ui-optionscontainer").find(".webgis-graphics-hectoline-interval");t.data("_value",f.length===1?parseFloat(f.val()):null)}webgis.tools.onButtonClick(r,{command:this.buttoncommand,argument:this.buttoncommand_argument,type:this.buttontype,id:this.id,map:r,value:t.data("_value")},this)});else if(u.type==="imagebutton")e=n("<div "+t(u)+">").addClass("webgis-ui-imagebutton").appendTo(o),u.src&&e.css("background-image","url("+webgis.css.imgResource(u.src)+")"),e.data("_value",u.value),s=e.get(0),s.buttoncommand=u.buttoncommand,s.buttoncommand_argument=u.buttoncommand_argument,s.buttontype=u.buttontype,s.map=f.map,u.text&&n("<div>").text(u.text).addClass("webgis-ui-imagebutton-text").appendTo(e),n(s).click(function(){var u=n(this),t=n(this).closest(".webgis-ui-optionscontainer"),i,f,r;t.length>0&&(i=t.get(0),i.value=u.data("_value"),t.find(".webgis-ui-option-selected").removeClass("webgis-ui-option-selected"),n(this).addClass("webgis-ui-option-selected"),i.onChange&&i.onChange());t.parent().parent().find(".webgis-ui-selected-option").html(n(this).clone().css({minHeight:"0px",height:"24px",backgroundPosition:"center",border:"none"}).removeClass("webgis-ui-option-selected"));f=n(this).closest(".webgis-ui-holder");r=this.map;webgis.tools.onButtonClick(r,{command:this.buttoncommand,argument:this.buttoncommand_argument,type:this.buttontype,id:this.id,map:r,value:u.data("_value")},this)});else if(u.type==="buttongroup")e=n("<div class='webgis-ui-buttongroup'><\/div>").appendTo(o);else if(u.type==="undobutton")e=n("<div "+t(u)+"><\/div>").addClass("webgis-undobutton").attr("data-undotool",u.undotool).data("map",i).appendTo(o),u.src?(e.addClass("webgis-ui-imagebutton"),e.css("background-image","url("+webgis.css.imgResource(u.src)+")"),n("<div>").addClass("webgis-ui-imagebutton-text").text(u.text).appendTo(e)):e.addClass("webgis-ui-undobutton").text(u.text),e.click(function(){var r=n(this),t=r.data("map"),i=t.getTool(r.attr("data-undotool"));i&&i.undos&&i.undos.length&&t.ui.webgisContainer().webgis_modal({width:"330px",title:r.html(),slide:!1,animate:!1,closebutton:!0,dock:"left",id:"webgis-undo-modal",onload:function(r){var h=n("<ul>").addClass("webgis-ui-undo-list").appendTo(r),e,f,o,u,s;for(e in i.undos)f=i.undos[e],o=n("<li><h2>"+f.title+"<\/h2><\/li>").addClass("webgis-ui-undo-item").data("undo",f).prependTo(h).mouseenter(function(){var i=n(this).data("undo");t.graphics.addPreviewFromJson(i.preview)}).mouseleave(function(){t.graphics.removePreview()}).click(function(){t.graphics.removePreview();webgis.tools.onToolUndoClick(t,i.id,n(this).data("undo"))}),f._ticks&&(u=((new Date).getTime()-f._ticks)/1e3,s=u<60?"vor "+Math.round(u)+" Sekunden...":u<3600?"vor "+Math.round(u/60)+" Minute(n)...":"vor "+Math.round(u/3600)+" Stunde(n)...",n("<div>").addClass("webgis-ui-undo-span").html(s).appendTo(o))},onclose:function(){t.graphics.removePreview()}})});else if(u.type==="menu")e=n("<ul style='list-style:none;padding:0px;' class='webgis-toolbox-tool-item-group-details'><\/ul>").appendTo(o),u.header&&n("<li><h2>"+u.header+"<\/h2><\/li>").appendTo(e),u.collapsable&&e.addClass("collapsable");else if(u.type==="menuitem")et=u.icon_large||u.icon?webgis.css.imgResource(u.icon_large||u.icon):webgis.css.imgResource("enter-26.png","ui"),di=-1,e=n("<li "+t(u)+"><div>"+u.text+"<\/div><\/li>").addClass("webgis-toolbox-tool-item").css({padding:u.icon_large?"36px 4px 4px 105px":"12px 4px 12px 32px"}).appendTo(o),u.text2&&n("<div>").addClass("text2").text(u.text2).appendTo(e),u.subtext&&n("<div>").addClass("subtext").text(u.subtext).appendTo(e),et.indexOf("data:")==0?(e.css({position:"relative"}),n("<img src='"+et+"'>").css({position:"absolute",left:3,top:8,maxHeight:22}).appendTo(e)):e.css({backgroundImage:"url("+et+")",backgroundPosition:"2px 10px",backgroundRepeat:"no-repeat"}),u.icon_large&&e.css({backgroundSize:"90px",height:"110px",whiteSpace:"normal"}),u.removable===!0&&n("<div>").addClass("remove remove-element").text("✖").appendTo(e),u.show_checkbox&&(ot=u.value.split(":"),ot.length===2&&(g=i.getService(ot[0]),g&&(nt=g.getQuery(ot[1]),nt&&nt.associatedlayers&&nt.associatedlayers.length>0&&(pt=n.map(nt.associatedlayers,function(n){return n.id}),fi=g.checkLayerVisibility(pt)!==0,n("<div>").data("service",g).data("layers",pt).addClass("webgis-checkbox").css("backgroundImage","url("+webgis.css.imgResource(fi?"check1.png":"check0.png","toc")+")").appendTo(e.addClass("checkable").css({paddingLeft:"70px",backgroundPosition:"36px center"})).click(function(t){t.stopPropagation();var i=n(this).data("service"),r=n(this).data("layers"),u=i.checkLayerVisibility(r)!==0;i.setLayerVisibilityDelayed(r,u?!1:!0);n(this).css("backgroundImage","url("+webgis.css.imgResource(u?"check0.png":"check1.png","toc")+")")}))))),y(e,u,f),u.highlight_feature&&(typeof u.highlight_feature=="string"&&(u.highlight_feature=webgis.$.parseJSON(u.highlight_feature)),e.data("highlight-feature",u.highlight_feature).mouseenter(function(){i.graphics.addPreviewFromJson(n(this).data("highlight-feature").features[0].geometry)}).mouseleave(function(){i.graphics.removePreview()}).click(function(){i.graphics.removePreview()})),o.hasClass("collapsable");else if(u.type==="checkable-div")e=n("<div "+t(u,f)+"><\/div>").addClass("webgis-checkable-div").appendTo(o).click(function(t){t.stopPropagation();var i=n(this);i.addClass("checked");i.children(".webgis-checkable-div-status").val("checked")}),n("<div>").addClass("checkbox").appendTo(e).click(function(t){t.stopPropagation();var i=n(this).parent();i.toggleClass("checked");i.children(".webgis-checkable-div-status").val(i.hasClass("checked")?"checked":"")}),ei=n("<input class='webgis-checkable-div-status' type='hidden' "+t(u,f)+"/>").val(e.hasClass("checked")?"checked":"").appendTo(e),e.data("webgis-value-element",ei);else if(u.type==="option-list")wt=n("<div>").addClass("webgis-ui-option-list-holder").appendTo(o),n("<input type='hidden'"+t(u,f)+" />").addClass("webgis-ui-option-list-value").appendTo(wt),e=n("<ul>").addClass("webgis-ui-option-list").appendTo(wt);else if(u.type==="option-list-item")e=n("<li>").addClass("webgis-ui-option-list-item").data("value",u.value).appendTo(o),e.click(function(t){t.stopPropagation();n(this).closest(".webgis-ui-option-list-holder").find(".webgis-ui-option-list-value").val(n(this).data("value"));n(this).parent().children(".selected").removeClass("selected");n(this).addClass("selected")}),o.children(".webgis-ui-option-list-item").length===1&&e.trigger("click");else if(u.type==="querycombo")e=n("<select "+t(u,f)+"><\/select>").appendTo(o),e.webgis_queryCombo({map:f.map,type:u.combotype,customitems:u.customitems});else if(u.type==="editthemecombo")e=n("<select "+t(u,f)+"><\/select>").appendTo(o),e.webgis_editthemeCombo({map:f.map,customitems:u.customitems,dbrights:u.dbrights});else if(u.type==="editthemetree")e=n("<div "+t(u,f)+"><\/div>").appendTo(o),e.webgis_editthemeTree({id:u.id,map:f.map,customitems:u.customitems,dbrights:u.dbrights});else if(u.type==="chainagethemecombo")e=n("<select "+t(u,f)+"><\/select>").appendTo(o),e.webgis_chainageCombo({map:f.map});else if(u.type==="visfiltercombo")e=n("<select "+t(u,f)+"><\/select>").appendTo(o),e.webgis_visfilterCombo({map:f.map,val:u.value});else if(u.type==="labelingcombo")e=n("<select "+t(u,f)+"><\/select>").appendTo(o),e.webgis_labelingCombo({map:f.map,val:u.value});else if(u.type==="circleradiuscombo"){e=n("<select "+t(u,f)+"><\/select>").appendTo(o).data("map",i).change(function(){var t=n(this).data("map");t.showCircleMarker(null,parseInt(n(this).val()))});bt=u.radii||webgis.const.circleMarkerRadii;for(oi in bt)st=bt[oi],n("<option value='"+st+"' "+(st===i._circleMarkerOptions.radius?"selected='selected'":"")+">"+st.toString().numberWithCommas()+" m<\/option>").appendTo(e)}else if(u.type==="print-query-labelfield-combo"){if(e=n("<select "+t(u,f)+"><\/select>").appendTo(o),n("<option value=''>--- Beschriften (optional) ---<\/option>").appendTo(e),c=i.queryResultFeatures.first(),c&&c.properties){kt=Array.isArray(c.properties)?c.properties.length>0?c.properties[0]:{}:c.properties;for(l in kt)a(l,kt[l])&&n("<option value='"+l+"'>"+v(l)+"<\/option>").appendTo(e)}e.webgis_multi_select({separator:";",map:i})}else if(u.type==="print-coordinates-labelfield-combo"){if(e=n("<select "+t(u,f)+"><\/select>").appendTo(o),u.showCoordinatePairsOnly||(n("<option value=''>--- Beschriftung (optional) ---<\/option>").appendTo(e),e.webgis_multi_select({separator:";",map:i})),c=i.queryResultFeatures.firstToolResult("webgis.tools.coordinates"),c&&c.properties)for(l in c.properties)if(ht=c.properties[l],a(l,ht)){let t=!0;if(ht instanceof Array?(dt=0,n.each(ht,function(n,t){t&&dt++}),dt!==2&&(t=!1)):t=!1,u.showCoordinatePairsOnly===!0&&t==!1)continue;n("<option value='"+l+"'>"+v(l)+"<\/option>").appendTo(e)}}else if(u.type==="sketchselect"){ct=i.currentToolSketches();e=n("<select "+t(u,f)+"><\/select>").data("current-tool-sketches",ct).data("map",i).appendTo(o);n("<option value=''>--- nicht anzeigen ---<\/option>").appendTo(e);for(si in ct)gt=ct[si],n("<option value='"+gt.id+"'>"+gt.name+"<\/option>").appendTo(e);e.change(function(){var r=n(this).val(),t=n(this).data("map"),i=n.grep(n(this).data("current-tool-sketches"),function(n){return n.id===r});i.length===1?t.sketch.load(i[0].storedSketch,t.getActiveTool()?t.getActiveTool().id:null):t.sketch.remove()})}else if(u.type==="select"){if(e=n("<"+u.type+t(u,f)+"><\/"+u.type+">").appendTo(o).add_webgis_form_element_events(),u.allow_addvalues===!0&&e.webgis_extCombo({inputType:"number"}),u.options&&u.options.length>0)for(w=0;w<u.options.length;w++)n("<option value='"+u.options[w].value+"'"+(u.defaultvalue&&u.options[w].value==u.defaultvalue?"selected='selected'":"")+">"+u.options[w].label+"<\/option>").appendTo(e);else if(e.hasClass("webgis-map-scales-select")){var gi=i.scale(),hi=i.scales(),ni=-1;for(ci in hi)tt=Math.round(hi[ci]/10)*10,n("<option value='"+tt+"'>1:"+tt.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")+"<\/option>").appendTo(e),(ni<0||gi<tt)&&(ni=tt);e.val(ni)}k=e.get(0);u.changecommand&&u.changecommand!=="unknown"&&(k.changetype=u.changetype,k.toolId=u.changetool||k.id,k.changecommand=u.changecommand,k.map=f.map,e.change(function(){webgis.tools.onButtonClick(this.map,{command:this.changecommand,type:this.changetype,id:this.toolId,map:this.map,value:n(this).val()},this)}));u.dependency_field_ids&&u.dependency_field_ids.length>0&&e.addClass("webgis-ui-added").addClass("webgis-select-has-dependency-field-ids").data("dependency-field-ids",u.dependency_field_ids).data("dependency_field_ids_callback_toolid",u.dependency_field_ids_callback_toolid);e.hasClass("webgis-print-show-query-markers-select")&&e.change(function(){i.queryResultFeatures.setMarkerVisibility(n(this).val()==="show"?!0:!1)});e.hasClass("webgis-print-show-coordinate-markers-select")&&e.change(function(){i.queryResultFeatures.setToolMarkerVisibility("webgis.tools.coordinates",n(this).val()==="show"?!0:!1)});e.hasClass("webgis-print-show-chainage-markers-select")&&e.change(function(){i.queryResultFeatures.setToolMarkerVisibility("webgis.tools.chainage",n(this).val()==="show"?!0:!1)});u.allow_pro_behaviour===!0&&webgis.usability.select_pro_behaviour==="select2"&&webgis.require("select2",function(n){n.select2({width:"100%"})},e)}else if(u.type==="optionscontainer")e=n("<div "+t(u,f)+">").appendTo(o).addClass("webgis-ui-optionscontainer"),u.allow_null_values===!0&&e.addClass("allow-null-values"),e.get(0).value=u.value;else if(u.type==="drop-list")e=n("<div "+t(u,f)+">").attr("id",u.id+"_droplist").attr("data-id",u.id).appendTo(o).data("map",f.map).addClass("webgis-ui-droplist"),n("<input type='hidden' "+t(u,f)+"/>").appendTo(o).val(u.value),e.on("dragover",function(n){n.preventDefault()}).on("drop",function(t){var r,u,f,i,e;t.preventDefault();r=n(this).data("map");u=t.originalEvent.dataTransfer.getData("text").split(";");for(f in u)(i=u[f],n(this).children("div[data-dropvalue='"+i+"']").length>0)||(e=n("<div><span>"+i+"<\/span><\/div>").addClass("webgis-ui-droplist-item").attr("data-dropvalue",i).appendTo(n(this)),r.events.fire("ondrop-add",r,{id:n(this).attr("data-id"),value:i}),n("<div>X<\/div>").addClass("webgis-ui-droplist-item-x").appendTo(e).click(function(){var t=n(this).closest(".webgis-ui-droplist"),i=t.data("map");i.events.fire("ondrop-remove",i,{id:n(this).closest(".webgis-ui-droplist").attr("data-id"),value:n(this).closest(".webgis-ui-droplist-item").attr("data-dropvalue")});n(this).closest(".webgis-ui-droplist-item").remove();t.data("calcVal")(t)}));n(this).data("calcVal")(n(this))}).data("calcVal",function(t){var r=t.parent().children("input[id='"+t.attr("data-id")+"']"),i="";t.children(".webgis-ui-droplist-item").each(function(){i!==""&&(i+=",");i+=n(this).attr("data-dropvalue")});r.val(i)});else if(u.type==="upload-file")e=n("<button>"+(u.text?u.text:webgis.l10n.get("file-upload"))+"<\/button>").addClass("webgis-button").appendTo(o).attr("id",u.id).click(function(t){t.stopPropagation();var i=n("#"+n(this).attr("id")+"_file_input").trigger("click")}),li=n("<div><\/div>").css("display","none").appendTo(o),ai=n("<input type='file' name='"+u.id+"' id='"+u.id+"_file_input' />").appendTo(li).data("servercommand",u.servercommand).data("toolid",u.toolid).data("map",i),ai.change(function(){var r=n(this).data("map"),i,t;for(i in this.files)(t=this.files[i],t&&t.size)&&webgis.tools.uploadFile(r,n(this).data("toolid"),n(this).data("servercommand"),n(this).attr("name"),t)});else if(u.type==="upload-file-control")e=n("<div><\/div>").appendTo(o).webgis_control_upload({edit_service:u.edit_service,edit_theme:u.edit_theme,field_name:u.field_name,hidden_class:u.css,onload:function(n,t){console.log(t)}});else if(u.type==="graphics-info-container")e=n("<div><\/div>").appendTo(o),n.fn.webgis_graphicsInfoContainer&&e.webgis_graphicsInfoContainer({map:f.map});else if(u.type==="graphics-info-stage")e=n("<div><\/div>").appendTo(o),n.fn.webgis_graphicsInfoStage&&e.webgis_graphicsInfoStage({map:f.map});else if(u.type==="sketch-info-container")ti=!0,(webgis.useMobileCurrent()||webgis.isMobileDevice()&&webgis.usability.clickBubble==!1)&&(ti=!1),ti&&(e=n("<div><\/div>").appendTo(o),n.fn.webgis_sketchInfoContainer&&e.webgis_sketchInfoContainer({map:f.map}));else if(u.type==="sharelink-buttons"){if(e=n("<div>").addClass("contains-lables webgis-ui-optionscontainer").appendTo(o),u.link)for(w in webgis.shareOptions)it=webgis.shareOptions[w],it.available()&&(vi=n("<div>").addClass("webgis-ui-imagebutton").css("background-image","url("+it.img()+")").appendTo(e).data("link",u.link).data("subject",u.subject).data("qr_base64",u.qr_base64).data("shareOption",it).click(function(){var t=n(this).data("shareOption");t.share(n(this).data("link"),n(this).data("subject"),n(this).data("qr_base64"))}),n("<div>").addClass("webgis-ui-imagebutton-text").text(it.name).appendTo(vi))}else if(u.type==="literal")o.html(o.html()+webgis.encodeUntrustedHtml(u.literal,!0));else if(u.type==="literal-bold")o.html(o.html()+"<strong>"+webgis.encodeUntrustedHtml(u.literal,!0)+"<\/strong>");else if(u.type==="image")e=n("<img "+t(u,f)+" src='"+u.src+"' />").appendTo(o);else if(u.type==="input-bbox")e=n("<div "+t(u,f)+"><\/div>").appendTo(o),e.webgis_bbox_input({readonly:u.readonly});else if(u.type==="input-size")e=n("<div "+t(u,f)+"><\/div>").appendTo(o),e.webgis_size_input({readonly:u.readonly});else if(u.type==="condition_div"&&u.condition_arguments&&u.condition_arguments.length>0)nr=u.codition_logical_operator==="and"?!0:!1,e=n("<div "+t(u,f)+"><\/div>").addClass("webgis-dependencies webgis-dependency-"+u.condition_type).attr("data-dependency-arguments",u.condition_arguments).attr("data-dependency-logical_operator",u.condition_logical_operator).attr("data-dependency-condition_result",u.condition_result).attr("data-dependency-element-id",u.contition_element_id).appendTo(o),u.condition_type=="elementvalue"&&e.addClass("webgis-ui-added");else if(u.type==="opacity-control")e=n("<div "+t(u,f)+"><\/div>").appendTo(o),e.webgis_opacity_control({service:i.getService(u.serviceId)});else if(u.type==="query-builder")e=n("<div "+t(u,f)+"><\/div>").appendTo(o),e.webgis_queryBuilder({map:i,id:u.id,field_defs:u.field_defs,show_geometry_option:u.show_geometry_option,event:f.event});else if(u.type==="ui-liveshare")e=n("<div "+t(u,f)+"><\/div>").appendTo(o),e.webgis_liveshare();else if(u.type==="static-overlay-control")e=n("<div "+t(u,f)+"><\/div>").appendTo(o),e.webgis_staticOverlayControl({map:i,command_buttons:u.command_buttons});else if(u.type==="image-selector")e=n("<div "+t(u,f)+"><\/div>").appendTo(o).webgis_image_selector({image_urls:u.image_urls,image_labels:u.image_labels,image_width:u.image_width,image_height:u.image_height,multi_select:u.multi_select,selected:u.value});else for(yi=u.repeat||1,b=0;b<yi;b++)u.type==="table"&&u.insert_type&&o.find("#"+u.id).length>0?(e=n("#"+u.id),u.insert_type==="replace"&&e.empty()):e=n("<"+u.type+t(u,f)+"><\/"+u.type+">").appendTo(o);if(e){if(p(i,f.tool,u,e),e.attr("element-target",u.target),e&&u.elements&&u.elements.length>0){for(b=0,pi=u.elements.length;b<pi;b++)h(i,e.get(0),u.elements[b],f);u.type==="buttongroup"&&(lt=e.children(".uibutton").length,lt>0&&e.children(".uibutton").css("width",100/lt-(lt-1)+"%"))}if(u.type==="optionscontainer")if(at=e.get(0),at.value||e.hasClass("allow-null-values"))at.setValue(at.value);else{rt=null;for(wi in webgis.usability.optionContainerDefault)ii=webgis.usability.optionContainerDefault[wi],ii.id===u.id&&(rt=ii.value);rt&&e.children("[data-value='"+rt+"']").length===1?e.children("[data-value='"+rt+"']").trigger("click"):e.children(":first-child").trigger("click")}u.type==="table"&&e.hasClass("webgis-tool-parameter-persistent")&&(bi=webgis.tools.getElementValue(e.get(0)),ki=f.tool||i.getActiveTool(),i.setPersistentToolParameter(ki,e.attr("id"),bi));e.hasClass("webgis-tool-persistent-topic")&&e.attr("data-tool-id")&&n(null).webgis_tool_persist_topic_handler("deserialize",{map:f.map,element:e,id:e.attr("data-tool-id")});e.hasClass("webgis-validation")&&(e.webgis_validation("validate"),e.change(function(){e.webgis_validation("validate")}))}}},y=function(t,i,r){i&&i.callback&&(r.map&&i.callback.tool&&(i.callback.tool=r.map.getTool(i.callback.tool.id)||i.callback.tool),t.data("_callback",i.callback).data("_type",i.type).data("_value",i.value).data("_map",r.map).data("_event",r.event).click(function(t){var i=n(this),o,f;if(i.data("_type")==="menuitem"&&(t.stopPropagation(),f=n(this).closest("ul"),f.hasClass("collapsable"))){if(o=f.hasClass("collapsed"),f.toggleClass("collapsed"),o===!0){r.map.events.fire("ui-builder-collapsable-expanded",r.map,{$element:f});return}f.children().removeClass("selected-collapsed");n(this).addClass("selected-collapsed")}var u=i.data("_callback"),s=i.data("_value"),e={};if(e[i.data("_type")+"-value"]=s,n(this).attr("data-item-command")&&(e[i.data("_type")+"-item-command"]=n(this).attr("data-item-command")),u.type==="toolevent"&&u.tool)webgis.tools.sendToolRequest(i.data("_map"),u.tool,u.type,i.data("_event"),e);else if(u.type==="servertoolcommand")webgis.tools.onButtonClick(i.data("_map"),{command:u.command,type:"servertoolcommand",id:u.tool.id,map:i.data("_map")},this,null,e);else if(u.type==="servertoolcommand_ext")webgis.tools.onButtonClick(i.data("_map"),{command:u.command,type:"servertoolcommand_ext",id:u.tool.id,map:i.data("_map")},this,null,e);i.data("_type")==="menuitem"&&(f=n(this).closest("ul"),f.attr("element-target")==="modaldialog"&&r.map.ui.webgisContainer().webgis_modal("close"))}),t.children(".remove-element").click(function(t){t.stopPropagation();var i=n(this).parent();i.attr("data-item-command","remove-element").trigger("click");i.remove()}))},t=function(n,t){var r=n.css||"",i,u;n.vis_dependency&&(r+=" "+n.vis_dependency);switch(n.type){case"input-text":case"input-date":case"input-textarea":case"input-autocomplete":case"input-number":r+=" webgis-input";break;case"select":case"querycombo":case"editthemecombo":case"chainagethemecombo":case"visfiltercombo":case"labelingcombo":case"sketchselect":case"circleradiuscombo":case"print-query-labelfield-combo":case"print-coordinates-labelfield-combo":r+=" webgis-select";break;case"button":r+=" webgis-button"}return n.visible===!1&&(n.style=n.style?n.style+";display:none":"display:none"),i="",n.id&&(i+=" id='"+n.id+"'"),r&&(i+=" class='"+r+"'"),n.parameterservercommands&&n.parameterservercommands.length>0&&(i+=" data-parameter-servercommands='"+n.parameterservercommands.toString()+"'"),n.style&&(i+=" style='"+n.style+"'"),(n.type==="td"||n.value&&typeof n.value=="string")&&(u=(n.value||"").replaceAll("'","&#39;"),i+=" data-value='"+u+"'",(n.type==="input-text"||n.type==="input-date"||n.type==="input-autocomplete"||n.type==="select")&&(i+=" value='"+u+"'")),typeof n.minlength=="number"&&(i+=" data-minlength='"+n.minlength+"'"),n.readonly===!0&&(i+=" readonly='readonly'"),t&&t.tool&&(i+=" data-tool-id='"+t.tool.id+"'"),n.placeholder&&(i+=" placeholder='"+n.placeholder+"'"),i},p=function(t,i,r,u){if(u&&u.length!==0){var f=u.get(0);r.onchange?(f.map=t,f.onchange_command=r.onchange,u.change(function(){var i=this.map.getTool(n(this).attr("data-tool-id"))||this.map.getActiveTool();if(this.map.getPersistentToolParameter(i,this.id)!==n(this).val())if(this.map.setPersistentToolParameter(i,this.id,n(this).val()),i.type==="serverbutton")webgis.tools.onButtonClick(t,{command:this.onchange_command,type:"servertoolcommand_ext",id:i.id,map:this.map},this);else webgis.tools.onButtonClick(t,{command:this.onchange_command,type:"servertoolcommand",id:this.id,map:this.map},this)})):u.hasClass("webgis-tool-parameter-persistent")&&(f.map=t,r.type==="optionscontainer"&&(f.onChange=function(){this.map.setPersistentToolParameter(this.map.getActiveTool(),this.id,this.value)},f.value=t.getPersistentToolParameter(t.getActiveTool(),f.id)||f.value),r.type==="table"||u.change(function(){this.map.setPersistentToolParameter(this.map.getActiveTool(),this.id,n(this).val())}));r.type==="optionscontainer"&&(f.setValue=function(){n(this).children().each(function(t,i){var r=n(i);if(r.data("_value")==f.value||r.data("_value")&&r.data("_value").id&&f.value&&f.value.id&&r.data("_value").id===f.value.id)return r.trigger("click"),!1})});r.has_validation&&n.fn.webgis_validation&&u.webgis_validation({minlen:r.validation_minlen,regex:r.validation_regex,error:r.validation_errormsg,required:r.validation_required});r.required_message&&u.data("required-message",r.required_message)}},i=function(n){return n.type==="empty"&&n.closetarget===!0},c=function(n,t){if(n&&t&&t.targetonclosetype&&t.targetonclosecommand)webgis.tools.onButtonClick(n,{type:t.targetonclosetype,command:t.targetonclosecommand})},l=function(n){n.removeClass("anim").addClass("fade-in").empty();webgis.delayed(function(n){n.addClass("anim")},300,n)},a=function(n,t){if(n.indexOf("_")===0)switch(n){case"_fulltext":case"_label":break;default:return!1}return typeof t=="string"&&(t=t.trim(),t.length>0&&t[0]==="<"&&t[t.length-1]===">")?!1:!0},v=function(n){switch(n){case"_fulltext":return"(Kurz) Zusammenfassung";case"_label":return"Beschriftung";default:return n}},r=function(t,i){var r=t.find(".webgis-tool-persistent-topic");r.length===1&&r.attr("data-tool-id")&&n(null).webgis_tool_persist_topic_handler("serialize",{map:i.map,element:r,id:r.attr("data-tool-id")});t.empty()}}(webgis.$||jQuery),function(n){n.fn.webgis_collapsable_paragraph=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_collapsable_paragraph");else return t.init.apply(this,arguments)};var r={},t={init:function(t){var u=n(this);return(t=n.extend({},r,t),u.length===0)?i(this,t):this.each(function(){new i(this,t)})}},i=function(t){webgis.delayed(function(){var i=n(t),r=i.height();i.addClass("webgis-collapsable-paragraph collapsed");i.height()<r?(console.log(r,i.height()),n("<div><\/div>").addClass("switcher").appendTo(i).click(function(t){t.stopPropagation();n(this).closest(".webgis-collapsable-paragraph").toggleClass("collapsed")})):i.css("height","auto")},100)}}(webgis.$||jQuery),function(n){n.fn.webgis_bbox_input=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_bbox_input");else return t.init.apply(this,arguments)};var i={readonly:!1},t={init:function(t){return this.each(function(){new r(this,n.extend({},i,t))})},val:function(t){if(typeof t=="string"){var i=n(this),r=t.split(",");r.length==4&&(i.find(".webgis-bbox-value").val(t),i.find(".webgis-bbox-minx").val(parseFloat(r[0])),i.find(".webgis-bbox-miny").val(parseFloat(r[1])),i.find(".webgis-bbox-maxx").val(parseFloat(r[2])),i.find(".webgis-bbox-maxy").val(parseFloat(r[3])))}return n(this).find(".webgis-bbox-value").val()}},r=function(t,i){var r=n(t).addClass("webgis-bbox-input-holder"),f=n("<div>").addClass("row").appendTo(r),u=n("<div>").addClass("row").appendTo(r),e=n("<div>").addClass("row").appendTo(r);n("<input type='number' class='webgis-bbox-input webgis-bbox-maxy'>").appendTo(f);n("<input type='number' class='webgis-bbox-input webgis-bbox-minx'>").appendTo(u);n("<input type='number' class='webgis-bbox-input webgis-bbox-maxx'>").appendTo(u);n("<input type='number' class='webgis-bbox-input webgis-bbox-miny'>").appendTo(e);$valueElement=n("<input type='hidden' class='webgis-bbox-value' />").appendTo(r);r.data("webgis-value-element",$valueElement);r.find(".webgis-bbox-input").change(function(){var t=n(this).closest(".webgis-bbox-input-holder"),i=t.find(".webgis-bbox-minx").val()+","+t.find(".webgis-bbox-miny").val()+","+t.find(".webgis-bbox-maxx").val()+","+t.find(".webgis-bbox-maxy").val();t.find(".webgis-bbox-value").val(i)});i.readonly===!0&&r.find(".webgis-bbox-input").attr("readonly","readonly")}}(webgis.$||jQuery),function(n){n.fn.webgis_size_input=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_size_input");else return t.init.apply(this,arguments)};var i={readonly:!1},t={init:function(t){return this.each(function(){new r(this,n.extend({},i,t))})},val:function(t){if(typeof t=="string"){var i=n(this),r=t.split(",");r.length==2&&(i.find(".webgis-size-value").val(t),i.find(".webgis-size-x").val(parseFloat(r[0])),i.find(".webgis-size-y").val(parseFloat(r[1])))}return n(this).find(".webgis-size-value").val()}},r=function(t,i){var r=n(t).addClass("webgis-size-input-holder");n("<input type='number' class='webgis-size-input webgis-size-x'>").appendTo(r);n("<div>x<\/div>").appendTo(r);n("<input type='number' class='webgis-size-input webgis-size-y'>").appendTo(r);n("<input type='hidden' class='webgis-size-value' />").appendTo(r);r.find(".webgis-size-input").change(function(){var t=n(this).closest(".webgis-size-input-holder"),i=t.find(".webgis-size-x").val()+","+t.find(".webgis-size-y").val();t.find(".webgis-size-value").val(i)});i.readonly===!0&&r.find(".webgis-size-input").attr("readonly","readonly")}}(webgis.$||jQuery),function(n){n.fn.webgis_general_input=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_general_input");else return t.init.apply(this,arguments)};var i={type:"text",name:null,inputElement:"input",label:null,placeholder:null,onInit:null},t={init:function(t){return this.each(function(){new r(this,n.extend({},i,t))})},val:function(t){return n(this).children("input[name='"+t.name+"']").val()},clear:function(t){n(this).children("input[name='"+t.name+"']").val("")}},r=function(t,i){var r=n(t),f,u,e,o;if(r.children(".webgis-input").length>0&&n("<br/>").appendTo(r),i.label&&(f=n("<div>").addClass("webgis-label").text(i.label+":").appendTo(r),i.description&&(n("<span>").css("display","inline-block").addClass("webgis-api-icon webgis-api-icon-help").appendTo(f),u=i.description,e=!1,u.indexOf("md:")===0&&(u=u.substr(3),e=!0),n("<div>").addClass("webgis-label-description").html(webgis.encodeUntrustedHtml(u,e)).appendTo(r),f.click(function(){n(this).next(".webgis-label-description").toggleClass("show")})),n("<br/>").appendTo(r)),i.inputElement&&(o=n("<"+i.inputElement+" name='"+i.name+"' type='"+i.type+"'>").addClass("webgis-input").appendTo(r),i.placeholder&&o.attr("placeholder",i.placeholder)),i.onInit)i.onInit(r,o)}}(webgis.$||jQuery),function(n){var r,t;n.fn.webgis_map_contextmenu=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_map_contextmenu");else return t.init.apply(this,arguments)};r={map:null,clickX:0,clickY:0,force:!1};t={init:function(t){return this.each(function(){new f(this,n.extend({},r,t))})},hide:function(){n._webgisMapContextMenu&&n._webgisMapContextMenu.css("display","none")}};n._webgisMapContextMenu=null;var f=function(t,i){var f,h,c,l,y,s;if(i.map){var p=t?n(t):n("body"),r=i.map,v=!1;if(n("body").find(".webgis-contextmenu.webgis-tool-contextmenu").each(function(t,i){n(i).css("display")!=="none"&&(v=!0)}),v==!0)if(i.force)n("body").find(".webgis-contextmenu.webgis-tool-contextmenu").css("display","none");else return;if(n._webgisMapContextMenu==null){n._webgisMapContextMenu=n("<div class='webgis-contextmenu icons' style='z-index:9999999;display:none;position:absolute;background:#fff' oncontextmenu='return false;'>").appendTo(p).click(function(){r.resetShowServiceExcusives();n(null).webgis_map_contextmenu("hide")});r.events.on(["refresh","zoomstart","movestart","mousedown"],function(){n(null).webgis_map_contextmenu("hide")});r.events.on(["onfocusservices","onresestfocusservices"],function(){u()})}if(n._webgisMapContextMenu.empty(),f=n("<ul>").addClass("webgis-toolbox-tool-item-group-details").css({padding:0,margin:0,minWidth:"200px"}).appendTo(n._webgisMapContextMenu),h=n("<li style='font-weight:bold;padding: 16px 10px 10px 10px'>").addClass("webgis-menu-item-title").appendTo(f),n("<i>").text(r.name).appendTo(h),n("<div>").addClass("webgis-close-button").appendTo(h),n("<li>").text("Alle Darstellungsfilter entfernen").css("background-image","url("+webgis.css.imgResource("filter-remove-26.png","tools")+")").addClass("webgis-tool-button webgis-dependencies webgis-dependency-hasfilters").appendTo(f).click(function(){r.unsetAllFilters();r.refresh();r.ui.refreshUIElements()}),n("<li>").text("Alle (Such)ergebnisse aus der Karte entfernen").css("background-image","url("+webgis.css.imgResource("marker-remove-26.png","tools")+")").addClass("webgis-tool-button webgis-dependencies webgis-dependency-queryresultsexists").appendTo(f).click(function(){var t=n(r._webgisContainer).find(".webgis-toolbox-tool-item.remove-queryresults");t.length>0?t.click():(r.queryResultFeatures.clear(!1),r.getSelection("selection").remove());r.unloadDynamicContent()}),n("<li>").text("Focus auf Dienst entfernen").css("background-image","url("+webgis.css.imgResource("focus_remove-26.png","tools")+")").addClass("webgis-tool-button webgis-dependencies webgis-dependency-focused-service-exists").appendTo(f).click(function(){r.resetFocusServices()}),r.services){n("<li style='font-weight:bold'><i>"+webgis.l10n.get("map-services")+"<\/i><\/li>").appendTo(f);c=r.sortedServices("name");l=n("<li>").text(webgis.l10n.get("basemaps")).addClass("basemap").css("background-image","url("+webgis.css.imgResource("tile-service.png")+")").appendTo(f).click(function(t){t.stopPropagation();var i=n(this);i.hasClass("subitems-collapsed")?(i.removeClass("subitems-collapsed"),i.parent().children().css("display","block").removeClass("webgis-menu-item-hidden"),i.parent().find("li.webgis-submenu-item").addClass("webgis-menu-item-hidden"),r.ui.refreshUIElements()):(i.addClass("subitems-collapsed"),i.parent().children("li").addClass("webgis-menu-item-hidden"),i.parent().children(".webgis-menu-item-title").removeClass("webgis-menu-item-hidden"),i.parent().children(".basemap").removeClass("webgis-menu-item-hidden"))});e(f,r);for(y in c)(s=c[y],serviceClass=s.id.replace(""),s.isBasemap!==!0)&&(s.isWatermark()||(l=n("<li>").addClass(s.guid).addClass("service-item").text(s.name).css("background-image","url("+webgis.css.imgResource("image-service.png")+")").data("service",s).appendTo(f).click(function(t){t.stopPropagation();var i=n(this),u=n(this).data("service");i.hasClass("subitems-collapsed")?(i.removeClass("subitems-collapsed"),i.parent().children().css("display","block").removeClass("webgis-menu-item-hidden"),i.parent().find("li.webgis-submenu-item").addClass("webgis-menu-item-hidden"),r.ui.refreshUIElements()):(i.addClass("subitems-collapsed"),i.parent().children("li").addClass("webgis-menu-item-hidden"),i.parent().children(".webgis-menu-item-title").removeClass("webgis-menu-item-hidden"),i.parent().children("."+u.guid).removeClass("webgis-menu-item-hidden"))}).mouseenter(function(){var t=n(this).data("service");r.showServiceExclusive(t.id,.08)}).mouseleave(function(){r.resetShowServiceExcusives()}),o(f,s),s.hasVisibleLayersInScale()||l.addClass("webgis-outofscale")))}f.find("li").addClass("webgis-toolbox-tool-item");f.find("li.webgis-submenu-item").addClass("webgis-menu-item-hidden");n._webgisMapContextMenu.css("display","inline-block");var w=Math.max(0,Math.min(n(window).width()-n._webgisMapContextMenu.width()-10,i.clickX)),a=Math.max(0,Math.min(n(window).height()-n._webgisMapContextMenu.height()-10,i.clickY)),b=n(window).height()-a-10;console.log("maxHeight",n(window).height()-a-20);n._webgisMapContextMenu.css({left:w,top:a,maxHeight:b,overflow:"auto"});u();r.ui.refreshUIElements()}},e=function(t,r){var f=r.services,e=null,o,u;$menuItem=n("<li>").addClass("webgis-submenu-item service basemap").addClass(r.currentBasemapServiceId()?"":"selected").text(webgis.l10n.get("no-basemap")).css({paddingLeft:"48px"}).appendTo(t).click(function(t){t.stopPropagation();var u=n(this);r.setBasemap(null,!1);i(e,null);u.parent().children(".webgis-submenu-item.service.basemap.selected").removeClass("selected");r.setBasemap(null,!0);u.parent().children(".webgis-submenu-item.service.basemap.checked").removeClass("checked").addClass("unchecked");u.addClass("selected")});for(o in f)u=f[o],u.isBasemap===!0&&u.basemapType!=="overlay"&&($menuItem=n("<li>").addClass("webgis-submenu-item service basemap").addClass(u.id===r.currentBasemapServiceId()?"selected":"").text(u.name).css({backgroundImage:"url("+u.getSampleTileUrl()+")",backgroundSize:"41px",backgroundPosition:"0px 0px",paddingLeft:"48px"}).data("service",u).appendTo(t).click(function(t){var u,o,f;t.stopPropagation();u=n(this);o=u.data("service");r.setBasemap(o.id,!1);f=r.getService(r.currentBasemapServiceId());f&&i(e,f);u.parent().children(".webgis-submenu-item.service.basemap.selected").removeClass("selected");u.addClass("selected")}));for(o in f)u=f[o],u.isBasemap===!0&&u.basemapType==="overlay"&&($menuItem=n("<li>").addClass("webgis-submenu-item service basemap").addClass(r.currentBasemapOverlayServiceIds().includes(u.id)?"checked":"unchecked").css({backgroundPosition:"13px center",paddingLeft:"48px"}).text(u.name).data("service",u).appendTo(t).click(function(t){var i,u;t.stopPropagation();i=n(this);i.hasClass("checked")?(r.setBasemap(null,!0),i.removeClass("checked").addClass("unchecked")):(u=i.data("service"),r.setBasemap(u.id,!0),i.removeClass("unchecked").addClass("checked"))}));e=n("<li>").text(webgis.l10n.get("opacity")).css("background-image","url("+webgis.css.imgResource("opacity_0-26.png","tools")+")").addClass("webgis-submenu-item service basemap").data("service",u).appendTo(t);i(e,r.getService(r.currentBasemapServiceId()))},o=function(t,r){var u,f;r&&r.map&&(n("<li>").text(webgis.l10n.get("remove-service")).css("background-image","url("+webgis.css.imgResource("remove.png","tools")+")").addClass("webgis-submenu-item service").addClass(r.guid).data("service",r).appendTo(t).click(function(){var t=n(this).data("service");webgis.confirm({message:webgis.l10n.get("confirm-remove-service"),cancelText:webgis.l10n.get("confirm-remove-service-cancel"),okText:webgis.l10n.get("confirm-remove-service-ok"),onOk:function(){t.map.removeServices([t.id])}})}),n("<li>").text(webgis.l10n.get("service-order")).css("background-image","url("+webgis.css.imgResource("rest/toolresource/webgis-tools-serviceorder-service_order","tools")+")").addClass("webgis-submenu-item service").addClass(r.guid).data("service",r).appendTo(t).click(function(){var t=n(this).data("service");webgis.modalDialog(webgis.l10n.get("service-order"),function(n){n.webgis_serviceOrder({map:t.map,selected:t.id})})}),n("<li>").text(webgis.l10n.get("legend")).css("background-image","url("+webgis.css.imgResource("legend.png","tools")+")").addClass("webgis-submenu-item service").addClass(r.guid).data("service",r).appendTo(t).click(function(){var t=n(this).data("service");n.presentationToc.showLegend(this,t.map,[t],t.name)}),u=n("<li>").text(webgis.l10n.get("focus-service")).css("background-image","url("+webgis.css.imgResource("focus-26.png","tools")+")").addClass("webgis-submenu-item service").addClass(r.guid).appendTo(t),s(u,r),f=n("<li>").text(webgis.l10n.get("opacity")).css("background-image","url("+webgis.css.imgResource("opacity_0-26.png","tools")+")").addClass("webgis-submenu-item service").addClass(r.guid).data("service",r).appendTo(t),i(f,r))},i=function(n,t){if(!t){n.css("display","none");return}n.addClass("webgis-menu-imagebutton-container-holder").css("display","");n.webgis_opacity_control({service:t})},s=function(n,t){n.webgis_focusservice_control({service:t})},u=function(){n._webgisMapContextMenu&&n(n._webgisMapContextMenu).find(".webgis-toolbox-tool-item.service-item").each(function(t,i){var e=n(i),r=e.data("service"),u,f;r&&r.map&&(u=r.map.focusedServices(),f=webgis.css.imgResource("image-service.png"),u&&u.ids&&n.inArray(r.id,u.ids)>=0&&(f=webgis.css.imgResource("focus-26.png","tools")),e.css("background-image","url("+f+")"))})}}(webgis.$||jQuery),function(n){var u,t;n.fn.webgis_opacity_control=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_opacity_control");else return t.init.apply(this,arguments)};u={service:null};t={init:function(t){return this.each(function(){new s(this,n.extend({},u,t))})},refresh:function(){return this.each(function(){new o(this)})}};n.webgis_opacity_control_globals=[];var s=function(t,u){var h=n(t),s,f,o;if(h.children(".webgis-menu-item-imagebutton-container.opacity").remove(),s=r(u.service),s&&s.map){if(f=s.map,!n.webgis_opacity_control_globals[f.guid]){n.webgis_opacity_control_globals[f.guid]=f;f.events.on(["onfocusservices","onresestfocusservices"],function(){e()})}o=n("<div>").data("service",u.service).addClass("webgis-opacity-control-holder webgis-menu-item-imagebutton-container opacity").appendTo(h);n("<div>").addClass("webgis-menu-item-imagebutton webgis-dependencies webgis-dependency-focused-service-exists").css("background-image","url("+webgis.css.imgResource("focus_remove-26.png","tools")+")").data("map",f).appendTo(o).click(function(t){t.stopPropagation();var i=n(this).data("map");i.resetFocusServices()});n("<div>").addClass("webgis-menu-item-imagebutton 25").css("background-image","url("+webgis.css.imgResource("opacity_25-26.png","tools")+")").appendTo(o).click(function(n){n.stopPropagation();i(this,.25)});n("<div>").addClass("webgis-menu-item-imagebutton 50").css("background-image","url("+webgis.css.imgResource("opacity_50-26.png","tools")+")").appendTo(o).click(function(n){n.stopPropagation();i(this,.5)});n("<div>").addClass("webgis-menu-item-imagebutton 75").css("background-image","url("+webgis.css.imgResource("opacity_75-26.png","tools")+")").appendTo(o).click(function(n){n.stopPropagation();i(this,.75)});n("<div>").addClass("webgis-menu-item-imagebutton 100").css("background-image","url("+webgis.css.imgResource("opacity_100-26.png","tools")+")").appendTo(o).click(function(n){n.stopPropagation();i(this,1)});o.find(".webgis-menu-item-imagebutton."+Math.round(s.getOpacity()*100)).addClass("selected");e();f.ui.refreshUIElements()}},i=function(t,i){const u=n(t),e=u.closest(".webgis-opacity-control-holder");if(!u.hasClass("disabled")){const o=r(e.data("service"));f(o,i);u.parent().children().removeClass("selected");u.addClass("selected")}},f=function(n,t){if(n&&(n.setOpacity(t),n.map&&n.isBasemap===!0))for(let i of n.map.currentBasemapOverlayServiceIds()){const r=n.map.getService(i);r&&r.setOpacity(t)}},r=function(n){return typeof n=="function"&&(n=n()),n},e=function(){o(null)},o=function(t){var i=n(t||"body");i.hasClass("webgis-opacity-control-holder")===!1&&(i=i.find(".webgis-opacity-control-holder"));i.each(function(t,i){var e=n(i),u=r(e.data("service")),o,s;u&&u.map&&(o=u.map.focusedServices(),o?(e.css("opacity",.8),s=o.ids&&n.inArray(u.id,o.ids)>=0?1:o.opacity,e.children(".webgis-menu-item-imagebutton").css("display","none").removeClass("selected"),e.children(".webgis-menu-item-imagebutton."+Math.round(s*100)).addClass("disabled").css("display","")):(e.removeClass("disabled").css("opacity",""),e.children(".webgis-menu-item-imagebutton").css("display","").removeClass("disabled").removeClass("selected"),e.children(".webgis-menu-item-imagebutton."+u.getOpacity()*100).addClass("selected"),u.isBasemap&&f(u,u.getOpacity())))})}}(webgis.$||jQuery),function(n){n.fn.webgis_focusservice_control=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_focusservice_control");else return t.init.apply(this,arguments)};var i={service:null},t={init:function(t){return this.each(function(){new r(this,n.extend({},i,t))})}},r=function(t,i){var f=n(t),r=i.service,u;r&&(f.addClass("webgis-menu-imagebutton-container-holder").children(".webgis-menu-item-imagebutton-container.focus").remove(),u=n("<div>").addClass("webgis-menu-item-imagebutton-container focus").appendTo(f),n("<div>").addClass("webgis-menu-item-imagebutton webgis-dependencies webgis-dependency-focused-service-exists").css("background-image","url("+webgis.css.imgResource("focus_remove-26.png","tools")+")").data("service",r).appendTo(u).click(function(t){t.stopPropagation();var i=n(this).data("service");i.map.resetFocusServices()}),n("<div>").addClass("webgis-menu-item-imagebutton").data("service",r).css("background-image","url("+webgis.css.imgResource("focus_75-26.png","tools")+")").appendTo(u).click(function(t){t.stopPropagation();var i=n(this).data("service");i.map.focusServices(i.id,.75)}),n("<div>").addClass("webgis-menu-item-imagebutton").data("service",r).css("background-image","url("+webgis.css.imgResource("focus_50-26.png","tools")+")").appendTo(u).click(function(t){t.stopPropagation();var i=n(this).data("service");i.map.focusServices(i.id,.5)}),n("<div>").addClass("webgis-menu-item-imagebutton").data("service",r).css("background-image","url("+webgis.css.imgResource("focus_25-26.png","tools")+")").appendTo(u).click(function(t){t.stopPropagation();var i=n(this).data("service");i.map.focusServices(i.id,.25)}))}}(webgis.$||jQuery),function(n){var i,t,r;n.fn.webgis_form=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_focusservice_control");else return t.init.apply(this,arguments)};i={name:null,input:[],onSubmit:null,submitText:"Sumit"};t={init:function(t){return this.each(function(){new r(this,n.extend({},i,t))})}};n._webgis_form_persistent=[];r=function(t,i){var f=n(t).addClass("webgis-form").click(function(n){n.stopPropagation()}),o,r,u,s,e;for(o in i.input){if(r=i.input[o],u=n("<div>").addClass("webgis-input-group").appendTo(f),r.label&&(n("<div>").addClass("webgis-label").text(r.label).appendTo(u),n("<br>").appendTo(u)),r.type==="select"){if($input=n("<select>").addClass("webgis-input").attr("name",r.name).appendTo(u),r.options)for(s in r.options)e=r.options[s],n("<option>").attr("value",e.value).text(e.text).appendTo($input)}else $input=n("<input>").addClass("webgis-input").attr("type",r.type||"text").attr("name",r.name).attr("placeholder",r.placeholder||"").appendTo(u).keypress(function(t){var i=t.which;if(i===13)return n(this).closest(".webgis-form").children(".webgis-form-submit").trigger("click"),!1;n(this).closest(".webgis-form").children(".webgis-form-errors").empty()});r.value!=null?$input.val(r.value):i.name&&n._webgis_form_persistent[i.name]&&n._webgis_form_persistent[i.name][r.name]!=null&&$input.val(n._webgis_form_persistent[i.name][r.name]);r.required&&$input.attr("required","required")}n("<div>").css("color","red").addClass("webgis-form-errors").appendTo(f);n("<button>").addClass("webgis-button webgis-form-submit").text(i.submitText).appendTo(f).click(function(){var u={},r="";n(this).parent().find(".webgis-input").each(function(t,f){var e=n(f),o=e.val();switch(e.attr("type")){case"number":o=parseFloat(o)}o||e.attr("required")!=="required"||(r+=e.attr("name")+" is required<\/br>");u[e.attr("name")]=o;i.name&&(n._webgis_form_persistent[i.name]=n._webgis_form_persistent[i.name]||[],n._webgis_form_persistent[i.name][e.attr("name")]=o)});r?n(this).closest(".webgis-form").children(".webgis-form-errors").html(r):i.onSubmit&&i.onSubmit.apply(t,[u])})}}(webgis.$||jQuery),function(n){n.fn.webgis_image_selector=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_image_selector");else return t.init.apply(this,arguments)};var r={image_urls:[],image_labels:null,image_width:null,image_height:null,selected:null},t={init:function(t){return this.each(function(){new u(this,n.extend({},r,t))})}},u=function(t,r){var u=n(t).addClass("webgis-image-selector"),e,o;console.log(r);e=n("<input type='hidden'>").appendTo(u);u.data("webgis-value-element",e);for(o in r.image_urls){var s=r.image_urls[o],f=n("<div>").data("imageUrl",s).addClass("webgis-image-selector-image-container").click(function(t){var f,o;t.stopPropagation();f=n(this);r.multi_select?f.toggleClass("selected"):(o=f.hasClass("selected"),u.children(".webgis-image-selector-image-container").removeClass("selected"),o||f.addClass("selected"));i(u,e)}),h=n("<div>").addClass("webgis-image-selector-image").css({backgroundImage:'url("'+webgis.css.imgResource(s)+'")'}).appendTo(f),c=n("<div>").addClass("webgis-image-selector-image-label");r.image_width&&(f.css("width",r.image_width),c.css("width",r.image_width),h.css("width",r.image_width));r.image_height&&(f.css("height",r.image_labels?r.image_height+30:r.image_height),h.css("height",r.image_height));r.image_labels&&o<r.image_labels.length&&c.text(r.image_labels[o]).appendTo(f);r.selected&&r.selected===s&&f.addClass("selected");f.appendTo(u)}i(u,e)},i=function(t,i){i.val("");var r="";t.children(".webgis-image-selector-image-container.selected").each(function(t,i){r&&(r+=",");r+=n(i).data("imageUrl")});i.val(r)}}(webgis.$||jQuery),function(n){n.fn.webgis_tool_persist_topic_handler=function(t){if(i[t])return i[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_persist_topic_handler");else return i.init.apply(this,arguments)};var t={map:null,id:null,element:null,clearDeserialzed:!0},i={init:function(i){return this.each(function(){new r(n.extend({},t,i))})},serialize:function(i){u(n.extend({},t,i))},deserialize:function(i){f(n.extend({},t,i))}},r=function(t){var i=t.map.ui.webgisContainer().find(".webgis-tool-persistent-topic-handler");return i.length===0&&(i=n("<div>").addClass("webgis-tool-persistent-topic-handler").css("display","none").appendTo(t.map.ui.webgisContainer())),i},u=function(t){var u=r(t),i;if(t.element&&t.id){if(n(t.element).find(".webgis-tool-parameter-persistent").length>0){console.log("persistent topic contains webgis-tool-parameter-persistent => ignored");return}i=u.children(".webgis-persistent-container[data-id='"+t.id+"']");i.length===0&&(i=n("<div>").addClass("webgis-persistent-container").attr("data-id",t.id).appendTo(u));i.empty();n(t.element).children().each(function(t,r){n(r).clone(!0,!0).appendTo(i)})}},f=function(t){var f=r(t),u,i;t.element&&t.id&&(u=n(t.element),i=f.children(".webgis-persistent-container[data-id='"+t.id+"']"),i.length>0&&(i.children().each(function(t,i){n(i).clone(!0,!0).appendTo(u)}),t.clearDeserialzed&&i.empty()))}}(webgis.$||jQuery),function(n){n.fn.webgis_multi_select=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_multi_select");else return t.init.apply(this,arguments)};var u={separator:",",map:null},t={init:function(t){return this.each(function(){new f(this,n.extend({},u,t))})}},f=function(t,u){var s,h;let f=n(t),e=n("<div>").insertBefore(f),o=n("<input type='hidden'>").attr("id",f.attr("id")).appendTo(e);if(f.appendTo(e),f.removeAttr("id"),n("<div>").addClass("webgis-multiselect-container").appendTo(e),f.hasClass("webgis-tool-parameter")&&(f.removeClass("webgis-tool-parameter"),o.addClass("webgis-tool-parameter")),f.hasClass("webgis-tool-parameter-persistent")&&(f.removeClass("webgis-tool-parameter-persistent"),o.addClass("webgis-tool-parameter-persistent"),u.map)){if(s=u.map.getPersistentToolParameter(u.map.getActiveTool(),o.attr("id")),s){h=s.split(u.separator);for(let n=0;n<h.length;n++)r(h[n],e,u)}i(e,u)}f.change(function(){r(f.val(),e,u);i(e,u);f.val("")})},r=function(t,r,u){if(t){$itemsContainer=r.children(".webgis-multiselect-container");let f=!1;if($itemsContainer.children().each(function(i,r){n(r).data("value")===t&&(f=!0)}),!f){let e=n("<div>").addClass("webgis-multiselect-continer-item").data("value",t).text(t).appendTo($itemsContainer);n("<div>").addClass("remove").text("X").appendTo(e).click(function(){n(this).closest(".webgis-multiselect-continer-item").remove();i(r,u)})}}},i=function(t,i){var r="";$itemsContainer=t.children(".webgis-multiselect-container");$itemsContainer.children().each(function(t,u){r&&(r+=i.separator);r+=n(u).data("value")});t.children("input").val(r)}}(webgis.$||jQuery),function(n){n.fn.add_webgis_form_element_events=function(){var t=n(this);return t.closest(".webgis-form-container").length===1&&t.bind("change keyup",function(){n(this).closest(".webgis-form-container").addClass("webgis-is-dirty")}),this}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_tabs=function(t){if(i[t])return i[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_tabs");else return i.init.apply(this,arguments)};var r={top:null,right:0,left:null,bottom:null,width:"100%",height:40,content_size:"normal",selected:null,add_presentations:!0,add_settings:!0,add_tools:!0,add_queryResults:!0,add_custom:null,options_presentations:{},options_settings:{},options_tools:{},options_queryResults:{},header_buttons:[]},i={init:function(t){var i=n(this);return t=n.extend({},r,t),t.options_presentations.map=t.options_settings.map=t.options_tools.map=t.options_queryResults.map=t.map,this.each(function(){new u(this,t)})},show:function(t){var i=typeof t=="string"?t:t.tab;n(this).find("#tab-"+i).removeClass("webgis-tabs-tab-selected").trigger("click")},hide:function(t){var i=typeof t=="string"?t:t.tab;n(this).find("#tab-"+i).hasClass("webgis-tabs-tab-selected")&&n(this).find("#tab-"+i).trigger("click")},hideAll:function(){n(this).find(".webgis-tabs-tab-selected").trigger("click")},resize:function(){var t=0,i;n(this).find(".webgis-tabs-tab").each(function(i,r){n(r).css("display")!=="none"&&t++});i=99.99/Math.max(1,t)+"%";n(this).find(".webgis-tabs-tab").css("width",i)}},u=function(i,r){var c=n(i),u,l,y,h,a,p,f,w,v;i._map=r.map;var e=n("<div class='webgis-tabs-holder webgis-ui-trans'><\/div>").appendTo(c).css({position:"absolute",left:r.left,top:r.top,right:r.right,bottom:r.bottom,height:r.height,width:r.width}),o=null,s=null;try{o=parseInt(r.top);isNaN(o)&&(o=null)}catch(b){}try{s=parseInt(r.bottom);isNaN(s)&&(s=null)}catch(b){}if(u=n("<div class='webgis-tabs-tab-content-holder'><\/div>").appendTo(c).css({position:"absolute",left:r.left,right:r.right,top:o!==null?parseInt(o+r.height+1):null,bottom:s!==null?parseInt(s+r.height):null,width:r.width}),o!==null&&u.addClass("under"),r.content_size=="fill"&&(u.css({maxWidth:"100%",maxHeight:"100%"}),o!==null?u.css({left:0,right:0,bottom:0}):s!==null?u.css({left:0,right:0,top:0}):u.css({left:0,right:0,bottom:0,top:0})),r.add_presentations&&(n("<div id='tab-presentations' class='webgis-tabs-tab'><img src='"+webgis.css.imgResource("presentations.png","toolbar")+"' /><\/div>").appendTo(e),l=webgis.localStorage.get("currentBranch"),f=n("<div><\/div>").addClass("webgis-tabs-tab-header").css("display","none").attr("id","tab-presentations-header").text(webgis.l10n.get("content")+(l?"["+l+"]":"")).appendTo(u),t(f,r,"presentations"),n.fn.webgis_presentationToc&&n("<div><\/div>").css({float:"right",width:32,height:32,cursor:"pointer",margin:-2,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url("+webgis.css.imgResource("legend-24.png","toc")+")"}).appendTo(f).data("map",r.map).click(function(t){t.stopPropagation();var i=n(this).data("map");n(null).webgis_presentationToc("show_services_legend",{map:i,sender:this})}),n("<div id='tab-presentations-content' class='webgis-tabs-tab-content' style='display:none'><\/div>").appendTo(u).webgis_presentationToc(r.options_presentations)),r.add_queryResults&&(n("<div id='tab-queryresults' class='webgis-tabs-tab' style='position:relative;display:none'><img src='"+webgis.css.imgResource("markers.png","toolbar")+"' /><div style='display:none' class='webgis-tabs-tab-text' id='tab-queryresults-content-counter'><\/div><\/div>").appendTo(e),f=n("<div id='tab-queryresults-header' class='webgis-tabs-tab-header' style='display:none'>Suchergebnisse<div class='webgis-tabs-close'><\/div><\/div>").appendTo(u),t(f,r,"queryresults"),y=n("<div id='tab-queryresults-content' class='webgis-tabs-tab-content' style='display:none'>").appendTo(u),n("<div id='tab-queryresults-content-results'><\/div>").appendTo(y).webgis_queryResultsHolder(r.options_queryResults),r.map)){r.map.events.on(["ui-builder-targetelement-changed","ui-builder-collapsable-expanded"],function(n,t,i){var r=i.target;!r&&i.$element&&(r="#"+i.$element.parent().attr("id"))},i);r.map.events.on("showqueryresults",function(t,i){if(!i.map.ui.getQueryResultTabControl()){if(n("#tab-queryresults-header").text("Karten Marker"),i&&i.map&&i.map.queryResultFeatures)switch(i.map.queryResultFeatures.queryTool()){case"identify":case"pointidentify":case"lineidentify":case"polygonidentify":n("#tab-queryresults-header").text(webgis.l10n.get("query-results"));break;case"search":case"query":n("#tab-queryresults-header").text(webgis.l10n.get("search-results"));break;case"buffer":n("#tab-queryresults-header").text(webgis.l10n.get("buffer-results"))}i&&i.suppressShowResult||n(this).webgis_tabs("show","queryresults");n(this).find("#tab-queryresults").css("display","");n(this).webgis_tabs("resize");i&&i.buttons&&n("#tab-queryresults-content-results").webgis_queryResultsHolder("showbuttons",i.buttons)}},i);r.map.events.on("clearqueryresults",function(){n(this).webgis_tabs("hide","queryresults");n(this).find("#tab-queryresults").css("display","none");n(this).webgis_tabs("resize")},i);r.map.events.on("hidequeryresults",function(){n(this).webgis_tabs("hide","queryresults")},i);r.map.events.on("hidepresentations",function(){n(this).webgis_tabs("hide","presentations")},i);r.map.events.on("queryresult_removefeature",function(){var t=n(this).find(".webgis-selection-button.selected");t.removeClass("selected");t.length>0&&(console.log("trigger first selection button"),t.first().trigger("click"))},i);r.map.events.on("queryresult_removefeature",function(t,i,r){var f=n(".webgis-result[data-id='"+r+"']"),u;f.hasClass(n.fn.webgis_queryResultsList.selectedItemClass)&&(console.log("remove",i.getSelection("query")),i.getSelection("query").remove());u=f.closest(".webgis-search-result-list");u.find(".webgis-results-counter").html(i.queryResultFeatures.count());f.remove();u.find(".webgis-result").length===1&&u.find(".webgis-result").find(".webgis-result-remove").remove()},i);r.map.events.on("queryresult_replacefeature",function(t,i,r){var f=n(".webgis-geojuhu-result.webgis-result[data-id='"+r.oid+"']"),u;f.children(".webgis-result-fulltext").text(r.properties._fulltext);u=n(".webgis-dockpanel.webgis-result[data-id='"+r.oid+"']");u.length>0&&!u.hasClass("webgis-result-table")&&i.queryResultFeatures.showFeatureTable(r)},i)}if(r.add_tools===!0||r.add_tool_content===!0){if(h=n("<div id='tab-tools' class='webgis-tabs-tab' style='position:relative'><img src='"+webgis.css.imgResource("tools.png","toolbar")+"' /><div style='display:none' class='webgis-tabs-tab-text' id='tab-tools-content-activetool'><\/div><div style='display:none' class='webgis-tabs-tab-close'>✖<\/div><\/div>").appendTo(e),f=n("<div id='tab-tools-header' class='webgis-tabs-tab-header' style='display:none'>"+webgis.l10n.get("current-tool")+":<div class='webgis-tabs-close'><\/div><\/div>").appendTo(u),t(f,r,"tools"),r.options_tools.fireEvent=!0,a=n("<div id='tab-tools-content' class='webgis-tabs-tab-content' style='display:none'><\/div>").appendTo(u).webgis_toolbox(r.options_tools),r.add_tools!==!0&&(a.addClass("no-toolbox"),a.empty(),r.map)){r.map.events.on("onchangeactivetool",function(t,i){var u=i.getActiveTool(),r=n(this).find("#tab-tools");u==null||u.id.indexOf(webgis._defaultToolPrefix)===0||u.hasui===!1?(r.css("display","none"),r.hasClass("webgis-tabs-tab-selected")&&n(this).find(".webgis-tabs-tab").first().trigger("click")):(r.css("display",""),r.hasClass("webgis-tabs-tab-selected")||r.trigger("click"));n(this).webgis_tabs("resize")},i);r.map.events.on("requirebuttonui",function(){h.css("display","");h.hasClass("webgis-tabs-tab-selected")||h.trigger("click");n(this).webgis_tabs("resize")},i)}if(r.map){r.map.events.on("onchangeactivetool",function(t,i){var r=i.getActiveTool(),u,f,e;r==null||r._isDefaultTool&&r.hasui==!1?n(n(this).find("#tab-tools-content-activetool")).html("").css("display","none"):n(n(this).find("#tab-tools-content-activetool")).html(r.name).css("display","");u=n(i._webgisContainer).find("#tab-tools.webgis-tabs-tab").find("img");f=n(i._webgisContainer).find("#tab-tools.webgis-tabs-tab").find(".webgis-tabs-tab-close");r&&r._isDefaultTool!==!0&&r.image?(e=webgis.css.imgResource(r.image,"tools"),u.attr("src",e).css({padding:"3px",height:"26px"}),f.css("display",webgis.isMobileDevice()?"none":"")):(u.attr("src",webgis.css.imgResource("tools.png","toolbar")).css({padding:"",height:""}),f.css("display","none"))},i);h.find(".webgis-tabs-tab-close").click(function(t){t.stopPropagation();var r=n(n(this).closest(".webgis-tabs-tab").get(0).tab_content).find("#tab-tools-content"),i=r.find(".webgis-tooldialog-header");i.length===1&&i.trigger("click")})}}if(r.add_settings&&(n("<div id='tab-settings' class='webgis-tabs-tab'><img src='"+webgis.css.imgResource("settings.png","toolbar")+"' /><\/div>").appendTo(e),f=n("<div id='tab-settings-header' class='webgis-tabs-tab-header' style='display:none'>Dienste<div class='webgis-tabs-close'><\/div><\/div>").appendTo(u),t(f,r,"settings"),n("<div id='tab-settings-content' class='webgis-tabs-tab-content' style='display:none'><\/div>").appendTo(u).webgis_servicesToc(r.options_settings)),webgis.usability.showErrorsInTabs==!0&&r.map&&n.fn.webgis_errors&&(p=n("<div id='tab-errors' class='webgis-tabs-tab' style='position:relative;display:none'><img src='"+webgis.css.imgResource("error-32.png","toolbar")+"' /><div style='display:none' class='webgis-tabs-tab-text webgis-error-counter'><\/div><\/div>").appendTo(e),f=n("<div id='tab-errors-header' class='webgis-tabs-tab-header' style='display:none'>Errors/Warnings<div class='webgis-tabs-close'><\/div><\/div>").appendTo(u),t(f,r,"erros"),n("<div id='tab-errors-content' class='webgis-tabs-tab-content' style='display:none'><\/div>").appendTo(u).webgis_errors({map:r.map,tab_element_selector:p,allow_remove:webgis.usability.allowUserRemoveErrors})),r.add_custom&&r.add_custom.tools)for(w in r.add_custom.tools)v=r.add_custom.tools[w],n("<div id='tab-settings' class='webgis-tabs-tab'><img style='width:32px;height:32px' src='"+webgis.css.imgResource(v.image)+"' /><\/div>").appendTo(e).data("tool",v).data("map",r.map).click(function(){webgis.tools.onButtonClick(n(this).data("map"),n(this).data("tool"))});e.find(".webgis-tabs-tab").each(function(t,i){i.tab_content=u.get(0);n(i).click(function(){var f,u,t,i;r.content_size==="fill"&&n(this).hasClass("webgis-tabs-tab-selected")||(f=!n(this).hasClass("webgis-tabs-tab-selected"),n(this.parentNode).find(".webgis-tabs-tab").removeClass("webgis-tabs-tab-selected"),n(this.tab_content).find(".webgis-tabs-tab-content").css("display","none"),n(this.tab_content).find(".webgis-tabs-tab-header").css("display","none"),f?(n(this.tab_content).find("#"+this.id+"-header").css("display","block"),n(this.tab_content).find("#"+this.id+"-content").slideDown(),this.id==="tab-presentations"&&n(this.tab_content).find("#"+this.id+"-content").webgis_presentationToc("show_first"),n(this).addClass("webgis-tabs-tab-selected"),n(this).closest(".webgis-tabs-holder").addClass("webgis-ui-trans-hover"),webgis.usability.toolSketchOnlyEditableIfToolTabIsActive===!0&&(u=n(this).closest(".webgis-tabs-holder"),u.children("#tab-tools").length===1&&(t=u.parent()[0]._map,t&&t.sketch&&(i=t.getActiveTool(),i&&!t.isDefaultTool(i)&&i.sketch_only_editable_if_tool_tab_is_active===!0&&t.sketch.setEditable(this.id==="tab-tools"&&i.tooltype&&i.tooltype.indexOf("sketch")===0))))):n(this).closest(".webgis-tabs-holder").removeClass("webgis-ui-trans-hover"))})});u.find(".webgis-tabs-close").each(function(t,i){r.content_size==="fill"?n(i).remove():n(i).click(function(){var t=n(this).closest(".webgis-tabs-tab-content-holder");t.find(".webgis-tabs-tab-content").css("display","none");t.find(".webgis-tabs-tab-header").css("display","none");t.parent().find(".webgis-tabs-holder").removeClass("webgis-ui-trans-hover").find(".webgis-tabs-tab-selected").removeClass("webgis-tabs-tab-selected")})});c.webgis_tabs("resize");r.selected!==null&&e.find("#tab-"+r.selected).trigger("click")},t=function(t,i,r){var u,o,f,e;if(i&&i.header_buttons&&i.header_buttons[r]&&Array.isArray(i.header_buttons[r])){u=0;for(o in i.header_buttons[r])f=i.header_buttons[r][o],e=n("<div>").addClass("webgis-tab-header-button").css("left",u).css("background-image","url("+f.img+")").appendTo(t),f.click&&e.click(function(n){n.stopPropagation();f.click(n)}),u+=e.width();t.css("padding-left",u+4)}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_tab_control=function(t){if(f[t])return f[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_tab_control");else return f.init.apply(this,arguments)};var e={},f={init:function(t){return t=n.extend({},e,t),this.each(function(){new h(this,t)})},add:function(t){return o(n(this),t)},remove:function(t){return s(n(this),t.id)},removeAll:function(t){t=n.extend({},e,t);var i=n(this),r=i.children(".webgis-tab-control-tabbar").children(".webgis-tab-control-tab[tab-id]");return r.each(function(r,u){var f=n(u);(!f.hasClass("static")||t.includeStatic)&&i.webgis_tab_control("remove",{id:f.attr("tab-id")})}),n(this)},select:function(t){return i(n(this),t)},refresh:function(){var r=n(this),u=r.children(".webgis-tab-control-tabbar");return u.children(".webgis-tab-control-tab").each(function(u,f){var e=t(n(f));e.selected&&i(r,e)}),n(this)},getTab:function(t){var r=n(this).children(".webgis-tab-control-tabbar"),i=r.children(".webgis-tab-control-tab[tab-id='"+t.id+"']");return i.length===1?i:null},getContent:function(t){var r=n(this),i=r.children(".webgis-tab-control-tab-content[tab-id='"+t.id+"']");return i.length===1?i:null},getTabsOptions:function(){var r=n(this).children(".webgis-tab-control-tabbar"),i=[];return r.children(".webgis-tab-control-tab").each(function(r,u){i.push(t(n(u)))}),i},getSelectedTabOptions:function(){var i=n(this).children(".webgis-tab-control-tabbar"),r=i.children(".webgis-tab-control-tab.selected");return t(r)},setTabPayload:function(t){var r=n(this),u=n(this).children(".webgis-tab-control-tabbar"),i=u.children(".webgis-tab-control-tab[tab-id='"+t.id+"']");return i.length===1&&i.data("tab-payload",t.payload),r},setTabCounter:function(t){var i=n(this).webgis_tab_control("getTab",t);return i&&u(i,t),n(this)},currentContent:function(){var t=n(this),i=t.children(".webgis-tab-control-tabbar"),r=i.children(".webgis-tab-control-tab.selected");return t.children(".webgis-tab-control-tab-content[tab-id='"+r.attr("tab-id")+"']")},changeTabId:function(t){var r=n(this),u=r.webgis_tab_control("getTab",{id:t.fromId}),i;u&&u.attr("tab-id",t.toId);i=r.webgis_tab_control("getContent",{id:t.fromId});i&&i.attr("tab-id",t.toId)},editTitle:function(t){var u=n(this),i=u.webgis_tab_control("getTab",{id:t.id});if(i){var r=i.children(".title"),f=r.text(),e=i.hasClass("title-editable")||t.setTitleEditable;i.removeClass("title-editable");n("<input type='text'>").val(f).click(function(n){n.stopPropagation()}).keydown(function(t){t.keyCode===13&&n(this).blur()}).blur(function(){var t=n(this).val();n(this).remove();r.text(t);e===!0&&i.addClass("title-editable")}).appendTo(r.empty()).focus()}},setTitleEditable:function(t){var r=n(this),i=r.webgis_tab_control("getTab",{id:t.id});i&&(t.editable===!1?i.removeClass("title-editable"):i.addClass("title-editable"))},resize:function(){var t=n(this).children(".webgis-tab-control-tabbar");r(t)}},h=function(t,i){var u=n(t).addClass("webgis-tab-control").data("options",i).empty(),s=n("<div>").addClass("webgis-tab-control-tabbar").appendTo(u),f,e;if(n("<div>").addClass("webgis-tab-control-tabbar-selector").appendTo(s).click(function(){var t=u.webgis_tab_control("getTabsOptions");n("body").webgis_modal({id:"webgis-tab-control-all-tabs-modal",title:webgis.l10n.get("active-queryresults"),width:"330px",height:50+(t.length+1)*40+20+"px",onload:function(n){c(u,n,t)}})}),i.tabs)for(f in i.tabs)e=i.tabs[f],o(u,e);if(i.map)i.map.events.on("resize-live",function(){var n=this.children(".webgis-tab-control-tabbar");r(n)},u)},o=function(f,e){var h,o,s;if(e.id){if(h=f.children(".webgis-tab-control-tabbar"),o=h.children(".webgis-tab-control-tab[tab-id='"+e.id+"']"),o.length===0&&(o=n("<div>").addClass("webgis-tab-control-tab").attr("tab-id",e.id).data("tab-payload",e.payload||{}).appendTo(h).click(function(t){t.stopPropagation();i(n(this).closest(".webgis-tab-control"),{id:n(this).attr("tab-id")})}),n("<div>").addClass("title").text(e.title||e.id).appendTo(o)),s=f.children(".webgis-tab-control-tab-content[tab-id='"+e.id+"']"),s.length===0&&(s=n("<div>").addClass("webgis-tab-control-tab-content").attr("tab-id",e.id).css("display","none").on("scroll",function(){const t=n(this);t.data("_scrollTop",t.scrollTop())}).appendTo(f)),e.titleEditable&&o.addClass("title-editable"),n("<div>").addClass("edit-title").appendTo(o).click(function(t){t.stopPropagation();var i=n(this).parent();f.webgis_tab_control("editTitle",{id:i.attr("tab-id")})}),e.pinable&&(o.addClass("pinable"),n("<div>").addClass("pin").appendTo(o).click(function(i){var r,u;i.stopPropagation();r=n(this).parent();r.toggleClass("pinned");r.hasClass("pinned")&&r.data("onPinned")&&(u=t(r),u.clickEvent=i,r.data("onPinned")(f,r,u))}),e.onPinned&&o.data("onPinned",e.onPinned)),u(o,e),e.static?o.addClass("static"):(n("<div>").addClass("close-button").appendTo(o).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-tab-control-tab");n(this).closest(".webgis-tab-control").webgis_tab_control("remove",{id:i.attr("tab-id")})}),e.onRemoved&&o.data("onRemoved",e.onRemoved)),e.onSelected&&o.data("onSelected",e.onSelected),e.onCreated)e.onCreated(f,o,s);return e.select===!0&&i(f,{id:e.id}),e.customData&&o.data("data-customdata",e.customData),e.icon&&o.css("background-image","url("+e.icon+")"),r(h),e.pinned&&o.data("onPinned")&&o.addClass("pinned").data("onPinned")(f,o,t(o)),s}},s=function(n,i){var s=n.children(".webgis-tab-control-tabbar"),f=s.children(".webgis-tab-control-tab[tab-id='"+i+"']"),h=f.data("onRemoved"),c=t(f),e,u,o;f.length!==0&&f.remove();e=n.children(".webgis-tab-control-tab-content[tab-id='"+i+"']");e.length!==0&&e.remove();u=n.data("options");u&&u.map&&(o=u.map.getActiveTool(),o&&o.hasui!==!0&&u.map.setDefaultTool());h&&h(n,c);r(s)},i=function(n,i){const e=n.children(".webgis-tab-control-tabbar");if(i.id==null){n.children(".webgis-tab-control-tab-content").css("display","none");e.children(".webgis-tab-control-tab").removeClass("selected");return}const f=e.children(".webgis-tab-control-tab[tab-id='"+i.id+"']");if(f.length===0)return null;e.children(".webgis-tab-control-tab").removeClass("selected");f.addClass("selected");i.title&&f.children(".title").text(i.title);u(f,i);const o=n.children(".webgis-tab-control-tab-content[tab-id='"+i.id+"']");return o.length===0?null:(f.addClass("loading"),webgis.delayed(function(){n.children(".webgis-tab-control-tab-content").css("display","none");f.data("onSelected")&&f.data("onSelected")(n,f,t(f));r(e);o.css("display","block").data("$tab",f).scrollTop(o.data("_scrollTop")||0);f.removeClass("loading")},1),o)},t=function(n){return!n||n.length===0?null:{id:n.attr("tab-id"),title:n.children(".title").text(),payload:n.data("tab-payload"),customData:n.data("data-customdata"),selected:n.hasClass("selected"),pinned:n.hasClass("pinned"),counter:n.attr("tab-counter")||null}},u=function(t,i){var r,u,f,e;i.counter&&(t.attr("tab-counter",i.counter).addClass("has-counter"),r=t.children(".counter"),r.length===0&&(r=n("<div>").addClass("counter").appendTo(t)),u=i.counter,i.counter>=1e3?(e=Math.round(u/1e3),f=e+"K"+(e*1e3<u?"+":"")):f=u.toString(),r.text(f))},r=function(t){function u(i){var r=0,u=t.width();t.children(".webgis-tab-control-tab").each(function(t,f){var e=n(f).css("display",""),o=e.outerWidth();t<i?e.css("display","none"):r+o>=u-30?e.css("display","none"):r+=o})}for(var f=t.children(".webgis-tab-control-tab").length,i=0,r=t.children(".webgis-tab-control-tab.selected");i<f;){if(u(i),r.length===0||r.css("display")!=="none")break;i++}},c=function(t,r,f){var c=function(){n(null).webgis_modal("close",{id:"webgis-tab-control-all-tabs-modal"})},h=t.data("options"),o=n("<ul>").addClass("webgis-list checkable clickable").appendTo(r),e=n("<li>").addClass("webgis-list-item").css({paddingTop:0,paddingBottom:4}).appendTo(o);n("<button>").addClass("webgis-button uibutton-cancel uibutton").text(webgis.l10n.get("close-selected-tabs")).appendTo(e).click(function(i){i.stopPropagation();o.children(".webgis-list-item").each(function(i,r){var u=n(r),f=u.data("tab");f&&u.children(".checkbox.checked").length===1&&s(t,f.id)});c()});n("<div>").addClass("checkbox").appendTo(e).click(function(t){t.stopPropagation();var i=n(this).toggleClass("checked"),r=i.hasClass("checked");o.find(".checkbox").each(function(t,i){var u=n(i);r?u.hasClass("pinned")||u.addClass("checked"):u.removeClass("checked")})});n.each(f,function(r,f){e=n("<li>").addClass("webgis-list-item"+(f.selected?" selected":"")).text(f.title).data("tab",f).appendTo(o).click(function(r){r.stopPropagation();var u=n(this).data("tab");c();i(t,u)});f.customData&&f.customData.dynamicContent?h&&h.map&&n("<div>").addClass("checkbox").css("background-image","url("+h.map.ui.dynamicContentIcon(f.customData.dynamicContent)+")").appendTo(e):n("<div>").addClass("checkbox"+(f.pinned?" pinned":"")).appendTo(e).click(function(t){t.stopPropagation();n(this).toggleClass("checked")});u(e,f)})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_queryCombo=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_queryCombo");else return t.init.apply(this,arguments)};var r={map:null,type:"query",customitems:[],onchange:null,valuefunction:null},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})},selectfirst:function(){if(n(this).find("option[value]:first").length===1){var t=n(this).find("option[value]:first").attr("value");t&&n(this).val(t).trigger("change")}},refresh:function(){var t=n(this);t.hasClass("refreshing")||(t.addClass("refreshing"),webgis.delayed(function(){e({},this.get(0)._map,this);this.removeClass("refreshing")}.bind(this),300,t))}},u=function(t,r){var e=n(t).addClass("webgis-query-combo"),s,h,u,o,c;if(t._map=r.map,t._opt=r,r.onchange&&e.change(r.onchange),s=e.hasClass("initialized"),r.customitems)for(h in r.customitems)u=r.customitems[h],o=e,u.category&&(o=e.find("optgroup[label='"+u.category+"']"),o.length===0&&(o=n("<optgroup label='"+u.category+"' />").addClass("webgis-custom-option").appendTo(e))),c=n("<option value='"+u.value+"'>"+u.name+"<\/option>").addClass("webgis-custom-option").appendTo(o),webgis.usability&&webgis.usability.listVisibleQueriesInQueryCombo===!0&&u.value==="#"&&(c.css("font-weight","bold"),e.addClass("require-ui-refresh")),s||u.value!==webgis.initialParameters.querythemeid||(e.addClass("initialized").val(u.value).trigger("change"),s=!0);if(r.map!==null)for(let n in r.map.services){const u=r.map.services[n];i({},u,t)}t._map.events.on("onaddservice",i,t);t._map.events.on("onremoveservice",f,t)},i=function(t,i,r){var s,a,f,o,v;if(r=r||this,i&&i.queries&&i.queries.length!==0){var u=n(r),y=u.find("option").length,h=u.get(0)._opt,p=h.type,l=u.hasClass("initialized"),e=n("<optgroup label='"+i.name+"' />"),c=u.children(".webgis-custom-option");for(c.length===0?e.prependTo(u):e.insertAfter(c[c.length-1]),e.get(0).service=i,s=0,a=i.queries.length;s<a;s++)(f=i.queries[s],f.visible!==!1)&&(p!=="query"||f.items!=null&&f.items.length!==0)&&(o=i.id+":"+f.id,h.valuefunction&&(o=h.valuefunction(i,f)),v=n("<option value='"+o+"'>"+f.name+"<\/option>").appendTo(e),v.get(0).query=f,l||o!==webgis.initialParameters.querythemeid&&f.id!==webgis.initialParameters.querythemeid||(u.addClass("initialized").val(o).trigger("change"),l=!0));e.find("option").length===0&&e.remove();y!==0||u.hasClass("initialized")||u.trigger("change");u.webgis_catCombo()}},f=function(t,i,r){r=r||this;var u=n(r);u.find("optgroup").each(function(t,r){r.service&&r.service.id===i.id&&n(r).remove()});u.trigger("change")},e=function(t,i,r){if(!webgis.usability||webgis.usability.listVisibleQueriesInQueryCombo===!0){const u=n(r||this);u.children(".scale-dependent").addClass("check-visibility");const f=u.children("[value='#']");if(i&&f.length===1){for(let t in i.services){const r=i.services[t];for(const t of r.queries)if(r.layerVisibleAndInScale(t.layerid)){const i=u.find("option.scale-dependent[value='"+r.id+":"+t.id+"']");if(i.length>0){i.removeClass("check-visibility");continue}n("<option>").addClass("scale-dependent").css("fontStyle","italic").attr("value",r.id+":"+t.id).text("☑ "+t.name).insertAfter(f)}}u.children(".scale-dependent.check-visibility").remove()}}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_chainageCombo=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_chainageCombo");else return t.init.apply(this,arguments)};var r={map:null},t={init:function(t){var i=n(this),t=n.extend({},r,t);return this.each(function(){new u(this,t)})}},u=function(t,r){var o=n(t),u,e;if(t._map=r.map,t._opt=r,r.map!==null)for(u in r.map.services)e=r.map.services[u],i({},e,t);t._map.events.on("onaddservice",i,t);t._map.events.on("onremoveservice",f,t)},i=function(t,i,r){var r=r||this,f,o;if(i!=null&&i.chainagethemes!=null&&i.chainagethemes.length!==0){var e=n(r),l=e.find("option").length,h=e.get(0)._opt,a=h.type,u=n("<optgroup label='"+i.name+"' />").appendTo(e);for(u.get(0).service=i,f=0,o=i.chainagethemes.length;f<o;f++)var s=i.chainagethemes[f],c=s.id,v=n("<option value='"+c+"'>"+s.name+"<\/option>").appendTo(u);u.find("option").length===0&&u.remove()}},f=function(t,i,r){var r=r||this,u=n(r);u.find("optgroup").each(function(t,r){r.service&&r.service.id===i.id&&n(r).remove()})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_visfilterCombo=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_visfilterCombo");else return t.init.apply(this,arguments)};var r={map:null},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})}},u=function(t,r){var u=n(t),e,o;if(t._map=r.map,t._opt=r,n("<option value='#'>Alle Filter<\/option>").appendTo(u),r.map!==null)for(e in r.map.services)o=r.map.services[e],i({},o,t);t._map.events.on("onaddservice",i,t);t._map.events.on("onremoveservice",f,t);r.val&&u.val(r.val)},i=function(t,i,r){var f,h,e,s,c;if(r=r||this,i&&i.filters&&i.filters.length!==0){var o=n(r),a=o.find("option").length,l=o.get(0)._opt,v=l.type,u=n("<optgroup label='"+i.name+"' />").appendTo(o);for(u.get(0).service=i,f=0,h=i.filters.length;f<h;f++)(e=i.filters[f],e.visible!==!1)&&(s=i.id+"~"+e.id,c=n("<option value='"+s+"'>&nbsp;"+e.name+"<\/option>").appendTo(u),i.map.hasFilter(s)&&c.css({backgroundImage:"url('"+webgis.css.img("check2-24.png")+"')",backgroundPosition:"0px -2px",backgroundRepeat:"no-repeat",height:24}));u.find("option").length===0&&u.remove()}},f=function(t,i,r){r=r||this;var u=n(r);u.find("optgroup").each(function(t,r){r.service&&r.service.id===i.id&&n(r).remove()})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_labelingCombo=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_labelingCombo");else return t.init.apply(this,arguments)};var r={map:null},t={init:function(t){var i=n(this),t=n.extend({},r,t);return this.each(function(){new u(this,t)})}},u=function(t,r){var o=n(t),u,e;if(t._map=r.map,t._opt=r,r.map!==null)for(u in r.map.services)e=r.map.services[u],i({},e,t);t._map.events.on("onaddservice",i,t);t._map.events.on("onremoveservice",f,t);r.val&&o.val(r.val)},i=function(t,i,r){var r=r||this,f,o;if(i!=null&&i.labeling!=null&&i.labeling.length!=0){var e=n(r),a=e.find("option").length,c=e.get(0)._opt,v=c.type,u=n("<optgroup label='"+i.name+"' />").appendTo(e);for(u.get(0).service=i,f=0,o=i.labeling.length;f<o;f++){var s=i.labeling[f],h=i.id+"~"+s.id,l=n("<option value='"+h+"'>&nbsp;"+s.name+"<\/option>").appendTo(u);i.map.hasLabeling(h)&&l.css({backgroundImage:"url('"+webgis.css.img("check2-24.png")+"')",backgroundPosition:"0px -2px",backgroundRepeat:"no-repeat",height:24})}u.find("option").length==0&&u.remove()}},f=function(t,i,r){var r=r||this,u=n(r);u.find("optgroup").each(function(t,r){r.service&&r.service.id==i.id&&n(r).remove()})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_catCombo=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_catCombo");else return t.init.apply(this,arguments)};var i={classFilters:null},t={init:function(t){var u=n(this),t=n.extend({},i,t);return this.each(function(){new r(this,t)})}},r=function(t,i){var r,l,u,s,h,a,o,f,e,c;if(!webgis||!webgis.usability||webgis.usability.useCatCombos!==!1){if(r=n(t),r.parent().hasClass("webgis-cat-combo-holder")||(l=n("<div>").addClass("webgis-cat-combo-holder").insertAfter(r),r.appendTo(l)),u=r.prevAll(".webgis-cat-combo"),u.length===0&&(u=n("<select>").addClass("webgis-input webgis-cat-combo").data("combo",r).insertBefore(r)),!webgis.isMobileDevice()&&n.fn.typeahead&&!r.hasClass("allow-filter")){s=n("<input type='text'>").attr("placeholder",webgis.l10n.get("find-layers")).addClass("webgis-input webgis-cat-combo-filter").insertBefore(r);function t(n){return n?"addClass":"removeClass"}r.addClass("allow-filter").on("mousemove",function(i){n(this)[t(this.offsetWidth-46<i.clientX-this.getBoundingClientRect().left&&this.offsetWidth-24>i.clientX-this.getBoundingClientRect().left)]("onX")}).on("touchstart click",function(){var t,i;n(this).hasClass("onX")&&(t=n(this).removeClass("onX").closest(".webgis-cat-combo-holder").addClass("show-filter").find(".webgis-cat-combo-filter"),t.typeahead("val",""),i=n(this).closest(".webgis-cat-combo-holder").children(".webgis-cat-combo").val(),t.attr("placeholder","Themen "+(i?"in "+i+" ":"")+"suchen..."))});s.on("mousemove",function(i){n(this)[t(this.offsetWidth-28<i.clientX-this.getBoundingClientRect().left)]("onX")}).on("touchstart click",function(){n(this).hasClass("onX")&&n(this).removeClass("onX").closest(".webgis-cat-combo-holder").removeClass("show-filter")});s.on({"typeahead:select":function(t,i){var r=n(this).closest(".webgis-cat-combo-holder"),u=r.find(".webgis-cat-combo-target");n(this).typeahead("val","");u.val(i.value).trigger("change");r.removeClass("show-filter")}}).typeahead({hint:!1,highlight:!1,minLength:0},{limit:Number.MAX_VALUE,displayKey:"label",source:function(t,i){var u=this.$el.closest(".webgis-cat-combo-holder"),f=u.find(".webgis-cat-combo-target"),r=[];f.find("option").each(function(i,u){var f=n(u),e=f.parent().is("optgroup")?f.parent():null,o,s;e&&f.css("display")!=="none"&&e.css("display")!=="none"&&(o=f.text().toLowerCase(),s=!0,n.each(t.split(" "),function(n,t){o&&o.indexOf(t.toLowerCase())<0&&(s=!1)}),s&&r.push({value:f.val(),label:f.text(),category:e.attr("label")}))});i(r.length>0?r.slice(0,20):null)},templates:{empty:'<div class="tt-suggestion">\n<div class="tt-content">Keine Ergebnisse gefunden<\/div>\n<\/div>',suggestion:function(t){var i=['<div class="tt-suggestion">','<div class="tt-content">',"<div>"+t.label+"<\/div>",'<div style="color:#aaa">'+t.category+"<\/div>","<\/div>","<\/div>"].join("\n");return n(i).data("item",t)}}})}if(r.addClass("webgis-cat-combo-target"),u.empty(),n("<option value=''>").text(webgis.l10n.get("query-choose-category")).appendTo(u),n("<option value=''>").text("--- "+webgis.l10n.get("query-all")+" ---").appendTo(u),i.classFilters)for(h in i.classFilters)a=i.classFilters[h],n("<option>").attr("value","class-filter:"+h).text(a.label).appendTo(u);o=[];r.find("optgroup").each(function(t,i){o.push(n(i).attr("label"))});o.sort();n.each(o,function(t,i){n("<option>").attr("value",i).text(i).appendTo(u)});u.change(function(){var i=n(this),t=i.nextAll(".webgis-cat-combo-target"),r=i.val(),u,e,o,s;if(i.closest(".webgis-cat-combo-holder").removeClass("show-filter"),r)if(r.indexOf("class-filter:")===0){t.children("optgroup").css("display","none");var c=r.substr(13),l=t.val(),f=null,h=!1;t.find("option").each(function(t,i){var r=n(i);r.hasClass(c)?(r.css("display","").closest("optgroup").css("display",""),f=f||r.attr("value")):(r.css("display","none"),r.attr("value")===l&&(h=!0))});h&&t.val(f).trigger("change")}else u=null,e=t.find("option[value='"+t.val()+"']"),t.children("option").css("display","none"),t.find("option").css("display",""),t.find("optgroup").each(function(t,i){n(i).attr("label")===r?(n(i).css("display",""),u=n(i).children("option").first()):n(i).css("display","none")}),u&&(e.length===1?(o=e.parent(),o.css("display")!=="none"&&o.is("optgroup")||t.val(u.attr("value")).trigger("change")):t.val(u.attr("value")).trigger("change"));else t.find("option").css("display",""),t.children("optgroup").css("display","");t.attr("id")&&(n.__webgis_catCombo_cache[t.attr("id")+":category"]=r);i.hasClass("triggered")?i.removeClass("triggered"):i.val()===""&&(s=t.children("option").first(),s.length===1&&t.val(s.attr("value")).trigger("change"))});r.attr("id")&&(f=n.__webgis_catCombo_cache[r.attr("id")+":category"],e=n.__webgis_catCombo_cache[r.attr("id")],f&&u.val()!==f&&u.find("option[value='"+f+"']").length===1&&u.addClass("triggered").val(f).trigger("change"),e&&r.val()!==e&&(c=r.find("option[value='"+e+"']"),c.length===1&&c.parent().css("display")!=="none"&&r.val(e).trigger("change")),r.change(function(){n.__webgis_catCombo_cache[n(this).attr("id")]=n(this).val()}))}};n.__webgis_catCombo_cache=[]}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_extCombo=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_extCombo");else return t.init.apply(this,arguments)};var i={inputType:"text"},t={init:function(t){var u=n(this),t=n.extend({},i,t);return this.each(function(){new r(this,t)})},values:function(){var t=[];return n(this).children("option").each(function(i,r){t.push(n(r).attr("value"))}),t}},r=function(t,i){if(n.fn.webgis_modal){var r=n(t);r.addClass("webgis-extendable-combo").mousemove(function(t){var u=n(this).outerWidth(),i=n(this).offset(),r=[-(i.left+u-t.pageX),t.pageY-i.top];r[0]<=-26&&r[0]>=-46?n(this).addClass("focus-extend"):n(this).removeClass("focus-extend")}).click(function(t){var u=n(this);u.hasClass("focus-extend")&&(u.removeClass("focus-extend"),t.stopPropagation(),n("body").webgis_modal({id:"webgis-extendable-combo-modal",title:"Liste erweitern",width:"340px",height:"150px",onload:function(t){var u=n("<input>").attr("type",i.inputType).addClass("webgis-input").css({width:"calc(100% - 12px)",marginBottom:"5px"}).val(r.val()).appendTo(t),f=n("<button>").addClass("webgis-button").css({width:"150px",float:"right"}).text("Ok").appendTo(t).click(function(){var t=u.val();n("<option>").attr("value",t).text(t).appendTo(r);r.val(t);r.trigger("change");n(null).webgis_modal("close",{id:"webgis-extendable-combo-modal"})});u.keypress(function(n){n.keyCode===13&&f.trigger("click")}).focus()}}))})}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_tagsCombo=function(t){if(i[t])return i[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_tagsCombo");else return i.init.apply(this,arguments)};let t={itemSelector:".webgis-tag-item",itemTagsAttr:"tags",tags:[]},i={init:function(i){return i=n.extend({},t,i),this.each(function(){new f(this,i)})},set_tags:function(i){return i=n.extend({},t,i),this.each(function(){new u(this,i)})},restore:function(i){return i=n.extend({},t,i),this.each(function(){new o(n(this),i)})}},f=function(t,i){if(i&&i.itemContainer){const r=n(t);r.data("item-container",n(i.itemContainer)).data("item-selector",i.itemSelector).data("item-tags-attr",i.itemTagsAttr).mousemove(function(t){var u=n(this).outerWidth(),i=n(this).offset(),r=[-(i.left+u-t.pageX),t.pageY-i.top];r[0]<=-26&&r[0]>=-46?n(this).addClass("focus-extend"):n(this).removeClass("focus-extend")}).click(function(t){const i=n(this),r=i.next(".webgis-tags-combo-popup");i.hasClass("focus-extend")?(i.removeClass("focus-extend"),t.stopPropagation(),i.blur(),r.css("top",i.offset()),r.css("width",i.outerWidth()),r.toggle()):r.css("display","none")});const e=n("<div>").addClass("webgis-tags-combo-popup").css({display:"none",position:"absolute"}).insertAfter(r).on("mouseleave",function(){const t=n(this);t.addClass("disappearing");webgis.delayed(function(n){n.hasClass("disappearing")&&n.css("display","none").removeClass("disappearing")},1e3,t)}).on("mouseenter",function(){n(this).removeClass("disappearing")}),f=n("<input>").addClass("webgis-tags-combo-value").attr("type","hidden").insertAfter(e);return i.id&&f.attr("id",i.id),i.addClasses&&f.addClass(i.addClasses),u(t,i),t}},u=function(t,i){const u=n(t);if(u.data("tags",i.tags),i.tags.length>0){u.addClass("webgis-tags-combo");n("<button>").addClass("webgis-tag-button all").text(webgis.l10n.get("show-all")).appendTo(u.next(".webgis-tags-combo-popup")).click(function(t){t.stopPropagation();const u=n(this),i=u.parent().prev(".webgis-tags-combo"),f=i.data("item-container"),e=i.data("item-selector");u.parent().children().removeClass("active");r(i,!0)});for(var f of i.tags)n("<button>").addClass("webgis-tag-button").attr("tag",f.toLowerCase()).text(f).appendTo(u.next(".webgis-tags-combo-popup")).click(function(t){t.stopPropagation();const i=n(this),u=i.parent().prev(".webgis-tags-combo");i.toggleClass("active");r(u,!0)})}else u.removeClass("webgis-tags-combo").next(".webgis-tags-combo-popup").empty()},e=function(n,t){const i="webgis-tags."+n.attr("id")+"."+n.val();webgis.localStorage.set(i,t.join(","))},o=function(t){const f="webgis-tags."+t.attr("id")+"."+t.val(),u=webgis.localStorage.get(f),i=t.next(".webgis-tags-combo-popup");if(i.removeClass("has-tags"),t.removeClass("has-tags"),u){const r=u.split(",").map(n=>n.trim()).filter(n=>n.length>0);r.length>0&&(i.addClass("has-tags"),t.addClass("has-tags"),i.children(".webgis-tag-button").removeClass("active").each(function(t,i){const u=n(i);r.includes(u.attr("tag"))?u.addClass("active"):u.removeClass("active")}))}return r(t,!1),t},r=function(t,i){const u=t.data("item-container"),f=t.data("item-selector"),o=t.data("item-tags-attr"),r=Array.from(t.next(".webgis-tags-combo-popup").find("button.active").map((t,i)=>n(i).attr("tag")));u.find(f).removeClass("webgis-tag-item-hidden");r.length===0?t.removeClass("has-tags").next(".webgis-tags-combo-popup").removeClass("has-tags"):u.find(f).each(function(i,u){var e,h;t.addClass("has-tags").next(".webgis-tags-combo-popup").addClass("has-tags");const f=n(u);e=f.attr(o).toLowerCase().split(",");let s=!1;for(h of r)if(e.includes(h)){s=!0;break}s||f.addClass("webgis-tag-item-hidden")});i&&e(t,r);t.nextAll(".webgis-tags-combo-value").val(r.join(","))}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_editthemeCombo=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_editthemeCombo");else return t.init.apply(this,arguments)};var r={map:null,customitems:[],onchange:null,dbrights:null},t={init:function(t){var i=n(this),t=n.extend({},r,t);return this.each(function(){new u(this,t)})}},u=function(t,r){var o=n(t),s,u,e,l,h,c;if(t._map=r.map,t._opt=r,r.onchange&&o.change(r.onchange),r.customitems)for(s in r.customitems)u=r.customitems[s],e=o,u.category&&(e=o.find("optgroup[label='"+u.category+"']"),e.length==0&&(e=n("<optgroup label='"+u.category+"' />").addClass("webgis-custom-option").appendTo(o))),l=n("<option value='"+u.value+"'>"+u.name+"<\/option>").addClass("webgis-custom-option").appendTo(e);if(r.map!==null)for(h in r.map.services)c=r.map.services[h],i({},c,t);t._map.events.on("onaddservice",i,t);t._map.events.on("onremoveservice",f,t)},i=function(t,i,r){var r=r||this,u,h,y,e;if(i!=null&&i.editthemes!=null&&i.editthemes.length!==0){u=[];u.point="☆ ";u.line="— ";u.polygon="▭ ";var f=n(r),p=f.find("option").length,a=f.get(0)._opt,v=f.hasClass("initialized"),s=n("<optgroup label='"+i.name+"' />"),c=f.children(".webgis-custom-option");for(c.length===0?s.prependTo(f):s.insertAfter(c[c.length-1]),s.get(0).service=i,h=0,y=i.editthemes.length;h<y;h++)if(e=i.editthemes[h],!a.dbrights||!e.dbrights||!(e.dbrights.indexOf(a.dbrights)<0)){var o=i.getLayer(e.layerid),w=o&&u[o.type]?u[o.type]:"",l=i.id+","+e.layerid+","+e.themeid,b=n("<option value='"+l+"'>"+w+e.name+"<\/option>").addClass("filter-"+(o&&o.type?o.type:"unknown")).appendTo(s);b.get(0).edittheme=e;v||l!==webgis.initialParameters.query&&e.themeid!==webgis.initialParameters.editthemeid||(f.addClass("initialized").val(l).trigger("change"),v=!0)}p!==0||f.hasClass("initialized")||f.trigger("change");n.fn.webgis_catCombo&&f.webgis_catCombo({classFilters:{"filter-point":{label:u.point+"Punkte/Symbole"},"filter-line":{label:u.line+"Linien"},"filter-polygon":{label:u.polygon+"Flächen/Polygone"}}})}},f=function(t,i,r){var r=r||this,u=n(r);u.find("optgroup").each(function(t,r){r.service&&r.service.id===i.id&&n(r).remove()});u.trigger("change")}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_editthemeTree=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$webgis_editthemeTree");else return t.init.apply(this,arguments)};var u={map:null,customitems:[],onchange:null,dbrights:null},t={init:function(t){var i=n(this),t=n.extend({},u,t);return this.each(function(){new f(this,t)})},value:function(){var t=n(this).data("webgis-value-element");return t?t.val():null},editThemeSelected:function(){var t=n(this).data("webgis-value-element");return t?t.val()&&t.val().indexOf(",")>0:!1}},f=function(t,u){var f=n(t),c,o,l,a,h,s,v;f.addClass("webgis-edittheme-tree").data("options",u);u.onchange&&f.change(u.onchange);c=n("<input>").attr("type","hidden").appendTo(f);f.data("webgis-value-element",c);o=n("<select>").addClass("webgis-edittheme-tree-service-combo webgis-input").attr("id","webgis-edittheme-tree-service-combo").appendTo(f).change(function(t){t.stopPropagation();var i=n(this),f=i.closest(".webgis-edittheme-tree").children(".webgis-edittheme-tree-theme-list"),e=i.closest(".webgis-edittheme-tree"),o=i.val();let u=new Set;f.children("li").removeClass("webgis-tag-item").each(function(t,i){const r=n(i),f=r.attr("data-serviceId")===o?"block":"none";if(r.removeClass("selected").css("display",f),f!="none"){var e=r.addClass("webgis-tag-item").attr("tags");e&&e.split(",").map(function(n){return n.trim()}).forEach(function(n){n&&u.add(n)})}});r(e,i.val());i.webgis_tagsCombo("set_tags",{tags:Array.from(u)});i.webgis_tagsCombo("restore")}).webgis_tagsCombo({itemContainer:f,itemSelector:".webgis-tag-item",id:u.id+"-tags",addClasses:"webgis-tool-parameter"});const y=n("<ul>").addClass("webgis-edittheme-tree-theme-list").appendTo(f);if(u.map!==null){for(l in u.map.services)a=u.map.services[l],i({},a,t);u.map.events.on("onaddservice",i,t);u.map.events.on("onremoveservice",e,t);h=!1;f.hasClass("webgis-tool-parameter-persistent")&&(s=u.map.getPersistentToolParameter(u.map.getActiveTool(),f.attr("id")),s&&(v=s.split(","),o.val(v[0]).trigger("change"),y.children("[data-edittheme='"+s+"']").trigger("click"),h=!0));h||o.val(o.children().first().attr("value")).trigger("change")}},i=function(t,i,u){var o=n(u||this),c=o.data("options"),s,l,e,a,f;if(i!=null&&i.serviceInfo!=null&&i.editthemes!=null&&i.editthemes.length!==0)for(s=o.children(".webgis-edittheme-tree-service-combo"),l=o.children(".webgis-edittheme-tree-theme-list"),n("<option>").attr("value",i.serviceInfo.id).text(i.serviceInfo.name).appendTo(s),e=0,a=i.editthemes.length;e<a;e++)if(f=i.editthemes[e],!c.dbrights||!f.dbrights||!(f.dbrights.indexOf(c.dbrights)<0)){var v=[f.layerid],y=i.id+","+f.layerid+","+f.themeid,h=n("<li>").addClass("webgis-edittheme-tree-theme-list-item").css({display:"none",backgroundImage:"url("+webgis.css.legendImage(i.id,f.layerid)+")"}).attr("data-edittheme",y).attr("data-serviceId",i.serviceInfo.id).attr("tags",f.tags).text(f.name).appendTo(l).click(function(t){t.stopPropagation();var i=n(this),u="",f=i.closest(".webgis-edittheme-tree");i.hasClass("selected")?(i.removeClass("selected"),u=i.attr("data-edittheme").split(",")[0]):(i.parent().children(".selected").removeClass("selected"),i.addClass("selected"),u=i.attr("data-edittheme"));r(f,u)});if(f.tags&&h.attr("title","Tags: "+f.tags.map(n=>"#"+n).join(", ")),n("<div>").data("layerIds",v).addClass("checkbox").addClass(i.checkLayerVisibility(v)!==0?"checked":"").appendTo(h).click(function(t){var u;t.stopPropagation();var i=n(this),f=i.closest(".webgis-edittheme-tree"),r=f.data("options"),e=i.parent().attr("data-serviceId");r&&r.map&&(u=r.map.getService(e),u)&&(i.toggleClass("checked"),u.setLayerVisibility(i.data("layerIds"),i.hasClass("checked"),!0))}),webgis.initialParameters.editthemeid===f.themeid&&!webgis.initialParameters.editthemeid_initialized){webgis.initialParameters.editthemeid_initialized=!0;s.val(i.serviceInfo.id).trigger("changed");h.trigger("click");const t=n(".webgis-ui-optionscontainer[data-tool-id='webgis.tools.editing.edit']");webgis.initialParameters.original&&webgis.initialParameters.original.tooloption&&t.children(`[data-value='${webgis.initialParameters.original.tooloption}']`).trigger("click")}}},e=function(t,i,r){var u=n(r||this),o=u.data("options"),f,e;i!=null&&i.serviceInfo!=null&&i.editthemes!=null&&i.editthemes.length!==0&&(f=u.children(".webgis-edittheme-tree-service-combo"),e=u.children(".webgis-edittheme-tree-theme-list"),f.children("option[value='"+i.serviceInfo.id+"']").remove(),e.children().each(function(t,r){var u=n(r);u.attr("data-serviceId")===i.serviceInfo.id&&u.remove()}),f.trigger("change"))},r=function(n,t){var i=n.data("options");n.data("webgis-value-element").val(t);n.hasClass("webgis-tool-parameter-persistent")&&(i=n.data("options"),i&&i.map&&i.map.setPersistentToolParameter(i.map.getActiveTool(),n.attr("id"),t));i&&i.map&&i.map.ui.refreshUIElements()}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_dockPanel=function(t){if(r[t])return r[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_dockPanel");else return r.init.apply(this,arguments)};var i={dock:"left",size:300,maxSize:null,adverseSize:null,maxAdverseSize:null,maximizeAdverse:!1,autoResize:!1,autoResizeBoth:!1,title:"",titleImg:"",slide:!0,usePadding:!0,refElement:null,canClose:!0,useIdSelector:!1,map:null},r={init:function(t){var r=n.extend({},i,t);return this.each(function(){new e(this,r)})},content:function(t){var r=n.extend({},i,t);return n(u(r)).find(".webgis-dockpanel-content")},exists:function(t){return n(this).webgis_dockPanel("content",t).length===1},close:function(t){var r,t;if(t=n.extend({},i,t),r=n(u(t)),r.length>0){if(t=r.data("options"),t.onclose)t.onclose(r);return r.webgis_dockPanel("remove"),!0}return!1},remove:function(){var t=n(this);t.hasClass("webgis-dockpanel")&&(webgis.removeHistoryItem(t.find(".webgis-dockpanel-close")),t.remove())},removeAll:function(){n(this).find(".webgis-dockpanel").webgis_dockPanel("remove")},resize:function(t){var i=n(this),r;t.size&&(r=i.hasClass("webgis-dockpanel-top")||i.hasClass("webgis-dockpanel-bottom")?"height":"width",i.attr("data-size",t.size),i.css(r,t.size))},set_title:function(t){var i=n(u(t));i.length===1&&i.find(".webgis-dockpanel-title").find(".text").text(t.title)},panelId:function(n){return t(n)}},e=function(i,r){var a=i?n(i):n("body"),c=r.dock==="top"||r.dock==="bottom"?"height":"width",v=r.dock==="top"||r.dock==="bottom"?"width":"height",u=r.useIdSelector===!0?a.find("#"+t(r)):a.find(".webgis-dockpanel-"+r.dock),h,l,e;if(u!==null&&u.length>0||(u=null),u===null&&(u=n("<div>").addClass("webgis-dockpanel webgis-dockpanel-"+r.dock).css({position:"absolute"}).appendTo(a)),(r.id||u.attr("id"))&&u.attr("id",t(r)),u.data("options",r).attr("data-size",r.size).attr("data-maxsize",r.maxSize!==null?r.maxSize:"auto").css("max-"+c,r.maxSize!==null?r.maxSize:"auto"),(r.adverseSize||r.maxAdverseSize)&&u.attr("data-adverse-size",r.adverseSize).attr("data-adverse-maxsize",r.maxAdverseSize!==null?r.maxAdverseSize:"auto").css("max-"+v,r.maxAdverseSize!==null?r.maxAdverseSize:"auto"),r.maximizeAdverse===!0&&u.addClass("webgis-dockpanel-maximize-adverse"),f(u,r),h=u.children(".webgis-dockpanel-title"),l=null,h.length===0&&(h=n("<div class='webgis-dockpanel-title'><div class='text'><\/div><\/div>").appendTo(u).click(function(t){var i,u,r;if(t.stopPropagation(),i=n(this).closest(".webgis-dockpanel"),i.hasClass("minimized")){i.removeClass("minimized");return}i.toggleClass("maximized");u=n(this).closest(".webgis-dockpanel").hasClass("webgis-dockpanel-maximize-adverse");r=u?i.hasClass("webgis-dockpanel-top")||i.hasClass("webgis-dockpanel-bottom")?"width":"height":i.hasClass("webgis-dockpanel-top")||i.hasClass("webgis-dockpanel-bottom")?"height":"width";i.hasClass("maximized")?i.css(r,i.attr("data-maximized")):i.css(r,i.attr("data-size"));f(i)}),r.canClose?(n("<div class='webgis-dockpanel-resize'><\/div>").appendTo(h),l=n("<div class='webgis-dockpanel-close'><\/div>").css({}).appendTo(h).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-dockpanel"),r=i.data("options");if(r.onclose)r.onclose(i);i.remove()})):n("<div class='webgis-dockpanel-minimize'><\/div>").css({}).appendTo(h).click(function(t){t.stopPropagation();n(this).closest(".webgis-dockpanel").toggleClass("minimized")})),r.titleImg&&h.addClass("image").css({backgroundImage:"url("+r.titleImg+")"}),h.children(".text").html(r.title),e=u.children(".webgis-dockpanel-content"),e.length===0?e=n("<div class='webgis-dockpanel-content'>").appendTo(u):e.empty(),webgis.delayed(function(){var t=r.autoResize||r.autoResizeBoth;(t===!1||c==="width")&&u.css(c,u.attr("data-size"));webgis.delayed(function(){var f,i;if(r.onload){r.onload(e,u);t===!0&&c==="height"&&(f=85,e.children().each(function(t,i){f+=n(i).outerHeight()}),u.webgis_dockPanel("resize",{size:f}),r.autoResizeBoth&&(i=0,e.children().addClass("min-width"),e.children().each(function(t,r){i=Math.max(i,n(r).outerWidth())}),e.children().removeClass("min-width"),u.css("width",Math.min(i+40,parseInt(n(window).width()-u.offset().left))),u.css("right","")));l&&webgis.setHistoryItem(l,e)}},350)},1),r.map&&!r.map._webgis_dockPanel_eventsInitialized){r.map._webgis_dockPanel_eventsInitialized=!0;r.map.events.on("begin-resize",function(n,t){s(t)});r.map.events.on("resize",function(n,t){o(t)})}},t=function(n){if(n.id)return"webgis-dockpanel-"+n.id.replace(/\./g,"-").replace(/:/g,"-")},u=function(n){var i=t(n);return i===""?".webgis-dockpanel":"#"+i+".webgis-dockpanel"},f=function(t){var r=t.data("options"),o=r.dock==="top"||r.dock==="bottom"?"height":"width",s=t.hasClass("minimized")?t.attr("data-size"):t.css(o),u="100%",h=0,c=0,i=null,f=t.parent();if(r.refElement){var l=f.offset(),a=n(r.refElement).offset(),e={left:a.left-l.left,top:a.top-l.top};e&&(i={left:e.left,top:e.top,right:parseInt(f.width()-e.left-n(r.refElement).width()),bottom:parseInt(f.height()-e.top-n(r.refElement).height())});h=f.width()-n(r.refElement).width();c=f.height()-n(r.refElement).height()}switch(r.dock){case"left":t.css({left:(i&&i.left?i.left:0)+(r.usePadding?webgis.usability.dockPanelPadding.left:0),top:(i&&i.top?i.top:0)+(r.usePadding?webgis.usability.dockPanelPadding.top:0),bottom:(i&&i.bottom?i.bottom:0)+ +(r.usePadding?webgis.usability.dockPanelPadding.bottom:0),width:s});r.usePadding&&(u=r.maximizeAdverse?"calc(100% - "+(webgis.usability.dockPanelPadding.top+webgis.usability.dockPanelPadding.bottom)+"px)":"calc(100% - "+(webgis.usability.dockPanelPadding.left+webgis.usability.dockPanelPadding.right+h)+"px)");break;case"right":t.css({right:(i?i.right:0)+(r.usePadding?webgis.usability.dockPanelPadding.right:0),top:r.adverseSize?"":(i&&i.top?i.top:0)+(r.usePadding?webgis.usability.dockPanelPadding.top:0),bottom:(i&&i.bottom?i.bottom:0)+(r.usePadding?webgis.usability.dockPanelPadding.bottom:0),width:s,height:r.adverseSize?r.adverseSize:""});r.usePadding&&(u=r.maximizeAdverse?"calc(100% - "+(webgis.usability.dockPanelPadding.top+webgis.usability.dockPanelPadding.bottom)+"px)":"calc(100% - "+(webgis.usability.dockPanelPadding.left+webgis.usability.dockPanelPadding.right+h)+"px)");break;case"top":t.css({left:(i&&i.left?i.left:0)+(r.usePadding?webgis.usability.dockPanelPadding.left:0),top:(i&&i.top?i.top:0)+(r.usePadding?webgis.usability.dockPanelPadding.top:0),right:(i&&i.right?i.right:0)+(r.usePadding?webgis.usability.dockPanelPadding.right:0),height:s});r.usePadding&&(u="calc(100% - "+(webgis.usability.dockPanelPadding.top+webgis.usability.dockPanelPadding.bottom+c)+"px)");break;case"bottom":t.css({left:(i&&i.left?i.left:0)+(r.usePadding?webgis.usability.dockPanelPadding.left:0),right:(i&&i.right?i.right:0)+(r.usePadding?webgis.usability.dockPanelPadding.right:0),bottom:(i&&i.bottom?i.bottom:0)+(r.usePadding?webgis.usability.dockPanelPadding.bottom:0),height:s});r.autoResizeBoth!==!0&&t.css({width:"inherit"});r.usePadding&&(u="calc(100% - "+(webgis.usability.dockPanelPadding.top+webgis.usability.dockPanelPadding.bottom+c)+"px)")}t.attr("data-maximized",u);t.hasClass("maximized")?t.css("max-"+o,u):t.css("max-"+o,t.attr("data-maxsize"));t.hasClass("maximized")&&t.css(o,t.attr("data-maximized"))},o=function(t){n(t._webgisContainer).find(".webgis-dockpanel").each(function(t,i){var r=n(i);f(r.css("display","block"))})},s=function(t){n(t._webgisContainer).find(".webgis-dockpanel").each(function(t,i){var r=n(i);r.css("display","none")})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_control_search=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_control_search");else return t.init.apply(this,arguments)};var i={search_service:null,search_categories:"",on_select:null,on_select_get_original:!1,on_select_get_original_raw:!1,on_select_get_original_fullgeometry:!1,css_display:null,meta:"meta"},t={init:function(t){var u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})},meta:function(n){if(n.search_service&&n.success)return webgis.ajax({url:webgis.baseUrl+"/rest/search/"+n.search_service,data:webgis.hmac.appendHMACData({c:n.meta,categories:n.search_categories}),type:"get",success:function(t){n.success(t)}}),this}},r=function(t,i){function u(n){return n?"addClass":"removeClass"}var r=n(t);if(r.is('input[type="text"]')&&i.search_service){i.css_display&&r.data("css-display",i.css_display);r.addClass("clearable x");r.on("mousemove",function(t){n(this)[u(this.offsetWidth-18<t.clientX-this.getBoundingClientRect().left)]("onX")}).on("touchstart click",function(t){n(this).hasClass("onX")&&(t.preventDefault(),n(this).removeClass("onX").val(""),webgis._triggerAutocomplete(this))});r.attr("data-service",i.search_service);r.attr("data-source",webgis.baseUrl+"/rest/search/"+i.search_service+"?c=query&");r.attr("data-search-categories",i.search_categories).attr("data-minlength",0);r.addClass("webgis-autocomplete");i.on_select&&r.data("data-options",i).data("autocomplete-onselect",function(t,i){var r=n(t).blur().data("data-options"),e,u,f;if(i.id&&i.id.indexOf("#metadata")===0){e="meta"+(i.id.length>9?"_"+i.id.substr(10):"");n(t).webgis_control_search("meta",{search_service:n(t).data("data-options").search_service,search_categories:n(t).data("data-options").search_categories,meta:e,success:function(t){n("body").webgis_modal({title:"Schnellsuche Themen",onload:function(i){var e,r,s,c,h,u,o,f;i.addClass("meta-content").css("padding","10px");e=[];for(o in t){if(r=t[o],r.id==="__copyright"){e.push(r);continue}if(h=n("<div><h3><strong>+<\/strong>&nbsp;"+r.type_name+"<\/h3><div>").css({cursor:"pointer",border:"1px solid #aaa",margin:"1px",paddingLeft:"10px",borderRadius:"8px"}).appendTo(i).click(function(){var t=n(this).next(".webgis-meta-block");n(this).find("strong").html(t.css("display")==="none"?"-":"+");t.slideToggle()}),u=n("<div class='webgis-meta-block'><\/div>").css({background:"#eee",margin:"1px",padding:"10px",borderRadius:"8px",display:"none"}).appendTo(i),n("<span>"+r.description+"<\/span><\/br/><\/br/>").appendTo(u),r.link&&(n("<a target='_blank' href='"+r.link+"' >Link...<\/a>").appendTo(u),n("<br/><br/>").appendTo(u)),r.sample){u=n("<div style='background:#aaa;padding:5px;border-radius:4px'><\/div>").appendTo(u);console.log("samples",r.sample,r.sample_separator);s=r.sample.split(r.sample_separator?r.sample_separator:",");for(c in s)n("<div style='margin-top:5px'>Beispiel für die Eingabe:<\/div>").appendTo(u),n("<input class='webgis-input' style='background:white' readonly='readonly' value='"+s[c]+"' />").appendTo(u)}}if(e.length>0){h=n("<div><h3><strong>+<\/strong>&nbsp;Copyright<\/h3><div>").css({cursor:"pointer",border:"1px solid #aaa",margin:"1px",paddingLeft:"10px",borderRadius:"8px"}).appendTo(i).click(function(){var t=n(this).next(".webgis-meta-block");n(this).find("strong").html(t.css("display")==="none"?"-":"+");t.slideToggle()});u=n("<div class='webgis-meta-block'><\/div>").css({background:"#eee",margin:"1px",padding:"10px",borderRadius:"8px",display:"none"}).appendTo(i);for(o in e)f=e[o].copyright_info,f&&(n("<h3>"+f.copyright+"<\/h3>").appendTo(u),f.link&&n("<a target='_blank'>").attr("href",f.link).text(f.link_text?f.link_text:f.link).appendTo(u),n("<p>").text(f.advice).appendTo(u))}},width:"600px"})}});return}if(i.id&&i.id==="#content-search"){u=n(t).val();f=n(t).data("map");webgis.confirm({title:"Nach Inhalten/Dienste suchen...",iconUrl:webgis.baseUrl+"/content/api/img/content-search.png",message:webgis.l10n.get("content-search-info"),suppressCancel:u==="",cancelText:"Nein, danke",okText:u&&f?"In (Karten)diensten suchen":"Ok",onOk:function(){u&&n("body").webgis_modal({title:"In Diensten suchen",onload:function(n){n.css("padding","0px");n.webgis_addServicesToc({map:f,searchTag:u})}})}});return}if(!i.id||i.id.indexOf(".")<0)r.on_select(t,i,!1);if(r.on_select_get_original===!1)r.on_select(t,i,!1);else webgis.ajax({url:webgis.baseUrl+"/rest/search/"+r.search_service+"/?c=original&render_fields="+(r.on_select_get_original_raw!==!0)+"&full_geometry="+(r.on_select_get_original_fullgeometry===!0)+"&item_id="+i.id,data:webgis.hmac.appendHMACData({}),type:"get",success:function(n){var u=!1;if(n&&n.type==="FeatureCollection"){r.on_select(t,n,!0);u=n.suppressSendQuickSearchResult===!0;console.log("suppressSendQuickSearchResult",u)}if(!u)r.on_select(t,i,!1)}})});webgis._appendAutocomplete(r)}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_copyright=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_copyright");else return t.init.apply(this,arguments)};var r={map:null},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})}},u=function(t,r){var o=n(t).addClass("webgis-copyright-container"),u,e;o.data("map",r.map);r.map.events.on("onaddservice",i,t);r.map.events.on("onremoveservice",f,t);for(u in r.map.services)e=r.map.services[u],i({},e,t)},i=function(t,i,r){var c=r?n(r):n(this),o,e,s,u,f,h,l;if(i.copyrightId&&(o=c.data("map"),o!=null&&o===i.map)){e=i.copyrightId.split(",");for(s in e){if(u=o.getCopyright(e[s]),!u)return;f=c.find("[data-copyrightid='"+e[s]+"']");f.length===0&&(f=n("<div><\/div>").attr("data-copyrightid",e[s]).addClass("webgis-copyright-info").appendTo(c),n("<div>").addClass("webgis-copyright-services").appendTo(f),u.logo&&(h=n("<img>").attr("src",u.logo),u.logo_size&&u.logo_size[0]>0&&h.css("width",u.logo_size[0]),u.logo_size&&u.logo_size[1]>0&&h.css("height",u.logo_size[1]),h.appendTo(f)),u.copyright&&n("<div>"+u.copyright+"<\/div>").appendTo(f),u.link&&n("<a href='"+u.link+"' target='_blank'>"+(u.link_text?u.link_text:u.link)+"<\/a>").appendTo(f),u.advice&&n("<p>").html(u.advice).appendTo(f));l=f.find(".webgis-copyright-services");n("<div>"+i.name+"<\/div>").attr("data-service",i.id).appendTo(l)}}},f=function(t,i,r){var s=r?n(r):n(this),f,e,h,u,o;if((console.log("remove"),i.copyrightId)&&(f=s.data("map"),f!=null&&f===i.map)){e=i.copyrightId.split(",");for(h in e)u=s.find("[data-copyrightid='"+e[h]+"']"),console.log(u),o=u.find(".webgis-copyright-services"),o.find("[data-service='"+i.id+"']").remove(),o.find("div").length==0&&u.remove()}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_control_upload=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_control_search");else return t.init.apply(this,arguments)};var i={edit_service:"service",edit_theme:"",field_name:"File",hidden_class:"",onUpload:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})}},r=function(t,i){var r="target-"+webgis.guid(),u=n("#__webgis-upload-div-container"),e,o,s,f,h,c;u.length===0&&(u=n("<div id='__webgis-upload-div-container' style='display:none'><\/div>").appendTo("body"));u.find("#"+i.field_name+"-"+r+"-upload-div").remove();e=n("<div><\/div>").attr("id",i.field_name+"-"+r+"-upload-div").appendTo(u);o=n(t).addClass("webgis-control-upload");n("<iframe id='"+i.field_name+"-"+r+"-frame' name='"+i.field_name+"-"+r+"-frame' style='display:none'><\/iframe>").appendTo(e);s=n("<form method='post' enctype='multipart/form-data' target='"+i.field_name+"-"+r+"-frame' action=''><\/form>").appendTo(e);f=i.field_name+"-"+r+"-"+webgis.guid();n("<input id='"+f+"' name='file' type='file' />").appendTo(s).change(function(){var s=webgis.baseUrl+"/rest/services/"+n(this).attr("data-service")+"/edit/"+n(this).attr("data-theme")+"/upload?"+webgis.hmac.urlParameters({responseformat_:"framed",callbackchannel:n(this).attr("id"),field:n(this).attr("data-name")}),h=n(this).attr("id"),c=n(this).closest(".webgis-collector-container"),l=c.attr("data-targetid"),f=n("#"+n(this).attr("data-name")+"-"+l+"-preview"),e,i,r;f.css("height","22px").find("img").remove();for(e in this.files)if(i=this.files[e],i&&i.size){var o=new FormData,t=new XMLHttpRequest,u=n("<progress id='progress' style='width:100%;height:20px;z-index:100' value='0' max='100'><\/progress>");u.appendTo(f);r=u.get(0);o.append(this.name,i);t.onerror=function(){webgis.alert("Error","error")};t.onload=function(){r.value=r.max;u.remove();var i=n.eval(t.responseText);webgis.events.fire(h,i)};t.upload.onprogress=function(n){var t=Math.round(100/n.total*n.loaded);r.value=t};t.onabort=function(){webgis.alert("Upload abgebrochen","info")};t.open("POST",s);t.send(o)}return}).attr("data-name",i.field_name).attr("data-service",i.edit_service).attr("data-theme",i.edit_theme);h=n("<input type='hidden' id='editfield_"+i.field_name+"' name='editfield_"+i.field_name+"' />").appendTo(o);i.hidden_class&&h.addClass(i.hidden_class);c=n("<div id='"+i.field_name+"-"+r+"-preview' class='webgis-input' style='cursor:pointer;width:288px;position:relative;height:22px;display:block'><div style='position:absolute;right:2px;bottom:2px;width:26px;height:26px;background:url("+webgis.baseUrl+"/content/api/img/upload-26.png) no-repeat center right;' /><\/div><\/div>").appendTo(o).click(function(){n("#"+n(this).attr("data-fileinput-id")).trigger("click")}).attr("data-name",i.field_name).attr("data-fileinput-id",f).data("onUpload",i.onUpload).get(0);webgis.events.on(f,function(t,i){n(this).parent().find("input[name='editfield_"+n(this).attr("data-name")+"']").val(i.url);n(this).css("height","auto").find("img").remove();n("<img src='"+webgis.baseUrl+i.url+"&size=256' style='margin:-4px' />").appendTo(n(this));n(this).data("onUpload")&&n(this).data("onUpload")(n(this).closest(".webgis-control-upload"),i)},c)}}(webgis.$||jQuery);webgis.$.extend({eval:function(n){return(typeof n=="string"&&(n=window.JSON?JSON.parse(n):eval("("+n+")")),!n)?{}:n}}),function(n){"use strict";n.fn.webgis_snapping=function(t){if(i[t])return i[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_snapping");else return i.init.apply(this,arguments)};var r={map:null},i={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})}},u=function(i,r){const u=r.map,s=n(i).addClass("snapping-holder").data("map",u),l=n("<input type='number' min='0' step='2'>").addClass("webgis-input").css({width:"50px",height:"10px",marginRight:"10px"}).val(u.construct.snapPixelTolerance).change(function(){const t=parseFloat(n(this).val());isNaN(t)||t<0?n(this).val(u.construct.snapPixelTolerance):u.construct.snapPixelTolerance=t}).appendTo(n("<label>").text(webgis.l10n.get("snapping-tolerance-pixel")+":").appendTo(n("<div>").css({textAlign:"right",paddingBottom:4}).appendTo(s))),e=n("<table>").css({width:"100%",borderSpacing:"0px"}).addClass("webgis-table").appendTo(s);n("<tr style='text-align:left'><th>"+webgis.l10n.get("scheme")+"<\/th><th style='text-align:center'>"+webgis.l10n.get("nodes")+"<\/th><th style='text-align:center'>"+webgis.l10n.get("edges")+"<\/th><th style='text-align:center'>"+webgis.l10n.get("endpoints")+"<\/th><\/tr>").appendTo(e);let o=u.getSnappingTypes(webgis.sketchSnappingSchemeId);const f=n("<tr>").attr("data-id",webgis.sketchSnappingSchemeId).appendTo(e),h=n("<td>").appendTo(f);n("<input type='checkbox' id='"+webgis.sketchSnappingSchemeId+"'>").addClass("checkbox-snapping schema").prop("checked",o&&o.length>0).css({position:"relative",top:"7px"}).appendTo(h).change(function(){n(this).closest("tr").find(".checkbox-snapping.detail").prop("checked",n(this).is(":checked"));t(this)});const c=n("<label for='"+webgis.sketchSnappingSchemeId+"'>&nbsp;"+webgis.l10n.get("current-sketch")+"<\/label>").appendTo(h);n("<div style='padding-left:25px;color:#aaa'>").text(webgis.l10n.get("all-scales")).appendTo(c);n("<input type='checkbox'>").addClass("checkbox-snapping detail").attr("data-type","nodes").appendTo(n("<td style='text-align:center'>").appendTo(f)).change(function(){t(this)});n("<input type='checkbox'>").addClass("checkbox-snapping detail").attr("data-type","edges").appendTo(n("<td style='text-align:center'>").appendTo(f)).change(function(){t(this)});n("<input type='checkbox'>").addClass("checkbox-snapping detail").attr("data-type","endpoints").appendTo(n("<td style='text-align:center'>").appendTo(f)).change(function(){t(this)});f.find("input[data-type]").each(function(t,i){n(i).prop("checked",n.inArray(n(i).attr("data-type"),o||[])>=0)});for(let i in u.services){const r=u.services[i];for(let i in r.snapping){const f=r.snapping[i],h=r.id+"~"+f.id,s=u.getSnappingTypes(h),o=n("<tr>").attr("data-id",h).appendTo(e),c=n("<td>").appendTo(o);n("<input type='checkbox' id='"+f.id+"'>").addClass("checkbox-snapping schema").prop("checked",s&&s.length>0).css({position:"relative",top:"7px"}).appendTo(c).change(function(){n(this).closest("tr").find(".checkbox-snapping.detail").prop("checked",n(this).is(":checked"));t(this)});const l=n("<label for='"+f.id+"'>&nbsp;"+f.name+"<\/label>").appendTo(c);n("<div style='padding-left:25px;color:#aaa'>").html("ab 1:"+f.min_scale).appendTo(l);n("<input type='checkbox'>").addClass("checkbox-snapping detail").attr("data-type","nodes").appendTo(n("<td style='text-align:center'>").appendTo(o)).change(function(){t(this)});n("<input type='checkbox'>").addClass("checkbox-snapping detail").attr("data-type","edges").appendTo(n("<td style='text-align:center'>").appendTo(o)).change(function(){t(this)});n("<input type='checkbox'>").addClass("checkbox-snapping detail").attr("data-type","endpoints").appendTo(n("<td style='text-align:center'>").appendTo(o)).change(function(){t(this)});o.find("input[data-type]").each(function(t,i){n(i).prop("checked",n.inArray(n(i).attr("data-type"),s||[])>=0)})}}},t=function(t){var i=f(t),r=i.data("map");i.find("tr[data-id]").each(function(t,i){var u=n(i),f=!1,e=[];u.find(".checkbox-snapping.detail").each(function(t,i){var r=n(i);f|=r.is(":checked");r.is(":checked")&&e.push(r.attr("data-type"))});u.find(".checkbox-snapping.schema").prop("checked",f);r.setSnapping(u.attr("data-id"),e)})},f=function(t){return n(t).hasClass("snapping-holder")?n(t):n(t).closest(".snapping-holder")}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_dirDistControl=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_dirDistControl");else return t.init.apply(this,arguments)};var r={azimut:0,azimut_unit:"gon",azimut_readonly:!1,distance:0,distance_unit:"m",distance_readonly:!1,_3d:!1,z_angle_type:"h",z_angle:0,z_angle_unit:webgis.usability.measureZAngleDefaultUnit,on_apply:null},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})}},u=function(t,r){var c=n(t),l=Math.round(r.azimut*1e5)/1e5,a=Math.round(r.distance*100)/100,u=n("<div>").css("margin","10px").addClass("webgis-dir-dist-holder").data("options",r).appendTo(c),e,o,s,h,f;n("<div>Richtung (Azimut)<\/div>").addClass("webgis-input-label").appendTo(u);e=n("<input name='azimut'>").addClass("webgis-input").css("width","50%").val(l).appendTo(u);o=n("<select name='azimut_unit'><option value='gon'>GON<\/option><option value='deg'>Grad<\/option><\/select>").addClass("webgis-input").css({width:"40%",height:"17px"}).appendTo(u).val(r.azimut_unit);n("<div>Distanz<\/div>").addClass("webgis-input-label").appendTo(u);s=n("<input name='dist'>").addClass("webgis-input").css("width","50%").val(a).appendTo(u);h=n("<select name='dist_unit'><option value='m'>Meter<\/option><option value='km'>Kilometer<\/option><\/select>").addClass("webgis-input").css({width:"40%",height:"17px"}).appendTo(u).val(r.distance_unit);n("<br/><br/>").appendTo(u);n("<input type='checkbox' id='webigs_dir_dist_3d' name='use_3d' />").prop("checked",r._3d).appendTo(u).change(function(){n(this).parent().find(".3dpane").slideToggle()});n("<label for='webigs_dir_dist_3d'>3D<\/label>").appendTo(u);f=n("<div class='3dpane'>").css("display","none").appendTo(u);n("<select name='z_angle_type'><option value='h'>Horizontalwinkel<\/option><option value='z'>Zenitdistanz<\/option><\/select>").addClass("webgis-input").css("width","99%").appendTo(f).val(r.z_angle_type);n("<input name='z_angle'>").addClass("webgis-input").css("width","50%").val(r.z_angle).appendTo(f);n("<select name='z_angle_unit'><option value='percent'>% (Prozent)<\/option><option value='gon'>GON<\/option><option value='deg'>Grad<\/option><\/select>").addClass("webgis-input").css({width:"40%",height:"17px"}).appendTo(f).val(r.z_angle_unit);n("<br/><br/>").appendTo(u);n("<button>Übernehmen<\/button>").addClass("webgis-button").appendTo(u).click(function(){var t=n(this).closest(".webgis-dir-dist-holder"),e=i(t.find("input[name='azimut']").val()),u,r,f;switch(t.find("select[name='azimut_unit']").val()){case"gon":e*=.9}u=i(t.find("input[name='dist']").val());switch(t.find("select[name='dist_unit']").val()){case"km":u*=1e3}r=i(t.find("input[name='z_angle']").val());switch(t.find("select[name='z_angle_unit']").val()){case"gon":r*=.9;break;case"percent":r=Math.atan(r/100)*180/Math.PI}switch(t.find("select[name='z_angle_type']").val()){case"z":r=90-r}if(t.find("input[name='use_3d']").is(":checked")||(r=0),f=t.data("options"),f.on_apply)f.on_apply({azimut_deg:e,distance_m:u,z_angle_deg:r})});r.azimut_readonly===!0&&(e.attr("readonly","readonly"),o.attr("readonly","readonly"));r.distance_readonly===!0&&(s.attr("readonly","readonly"),h.attr("readonly","readonly"))},i=function(n){return n=n.replace(",","."),parseFloat(n)}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_offsetControl=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_OffsetControl");else return t.init.apply(this,arguments)};var r={offset:0,offset_unit:"m",on_apply:null},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})}},u=function(t,r){var f=n(t),e=Math.round(r.offset*100)/100,u=n("<div>").css("margin","10px").addClass("webgis-dir-dist-holder").data("options",r).appendTo(f);n("<div>").text("Offset").addClass("webgis-input-label").appendTo(u);n("<select name='offset_direction'><option value='-1'>Links<\/option><option value='1'>Rechts<\/option><\/select>").css("width","50%").addClass("webgis-input").appendTo(u).val(Math.sign(r.offset));n("<input name='offset'>").addClass("webgis-input").css("width","50%").val(Math.abs(e)).appendTo(u);n("<select name='offset_unit'><option value='m'>Meter<\/option><option value='km'>Kilometer<\/option><\/select>").addClass("webgis-input").css({width:"40%",height:"17px"}).appendTo(u).val(r.offset_unit);n("<br/><br/>").appendTo(u);n("<button>Übernehmen<\/button>").addClass("webgis-button").appendTo(u).click(function(){var t=n(this).closest(".webgis-dir-dist-holder"),r=i(t.find("input[name='offset']").val())*parseInt(t.find("select[name='offset_direction']").val()),u;console.log("offset",r,i(t.find("input[name='offset']").val()),parseInt(t.find("select[name='offset_direction']").val()));switch(t.find("select[name='offset_unit']").val()){case"km":r*=1e3}if(u=t.data("options"),u.on_apply)u.on_apply({offset_m:r})})},i=function(n){return n=n.replace(",","."),parseFloat(n)}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_extendLineSketchControl=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_extentLineSketchControl");else return t.init.apply(this,arguments)};var i={extend:1,extend_unit:"m",on_apply:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})}},r=function(t,i){var f=n(t),e=Math.round(i.extend*100)/100,r=n("<div>").css("margin","10px").addClass("webgis-extend-line-holder").data("options",i).appendTo(f);n("<select name='extend_ends'><option value='-1'>am Anfang<\/option><option value='1'>am Ende<\/option><option value='0'>am Anfang und Ende<\/option><\/select>").css("width","55%").addClass("webgis-input").appendTo(r).val(0);n("<input name='extend'>").addClass("webgis-input").css("width","55%").val(Math.abs(e)).appendTo(r);n("<select name='extend_unit'><option value='m'>Meter<\/option><option value='km'>Kilometer<\/option><\/select>").addClass("webgis-input").css({width:"35%",height:"17px"}).appendTo(r).val(i.extend_unit);n("<br/><br/>").appendTo(r);n("<button>Verlängern<\/button>").addClass("webgis-button").appendTo(r).click(function(){var t=n(this).closest(".webgis-extend-line-holder"),r=u(t.find("input[name='extend']").val()),f=parseInt(t.find("select[name='extend_ends']").val()),i;switch(t.find("select[name='extend_unit']").val()){case"km":r*=1e3}if(i=t.data("options"),i.on_apply)i.on_apply({extend_m:r,ends:f})})},u=function(n){return n=n.replace(",","."),parseFloat(n)}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_xyAbsoluteControl=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_xyAbsoluteControl");else return t.init.apply(this,arguments)};var i={map:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),r(this,t)}},r=function(t,i){var l,c,u,r,e,o;if(i.map&&i.sketch){l=n(t);c={id:"webgis.tools.coordinates",type:"servertoolcommand_ext",command:"inputcoordinates-sketch-xyabsolute"};c.handleToolResponseCustomHandler=function(n){n.ui&&(n.ui.map=i.map,n.ui.tool=c,n.ui.title=null,n.ui.closebutton=!1,l.webgis_uibuilder(n.ui))};var s={},f=i.map,h=i.sketch;i.map.calcCrs()&&(u=null,r=null,h._snappedVertex?(r=[],u={x:h._snappedVertex.X,y:h._snappedVertex.Y}):h._moverLine?(e=h._moverLine.getLatLngs(),e.length>=2&&(r=[{x:e[1].lng,y:e[1].lat}],console.log("moverline",r),u=webgis.fromWGS84(i.map.calcCrs(r),e[1].lat,e[1].lng))):f._currentCursorPosition&&f._currentCursorPosition.lat&&f._currentCursorPosition.lng?(r=[{x:f._currentCursorPosition.lng,y:f._currentCursorPosition.lat}],console.log("curentCursor"),u=webgis.fromWGS84(i.map.calcCrs(r),f._currentCursorPosition.lat,f._currentCursorPosition.lng)):(o=i.map.getCenter(),console.log("center",o),r=[{x:o[0],y:o[1]}],u=webgis.fromWGS84(i.map.calcCrs(r),o[1],o[0])),s["coordinates-map-srs"]=i.map.calcCrs(r).id,u&&(s["coordinates-input-x-value"]=Math.round(u.x*100)/100,s["coordinates-input-y-value"]=Math.round(u.y*100)/100,s["coordinates-input-proj"]=i.map.calcCrs(r).id));webgis.tools.onButtonClick(i.map,c,null,null,s)}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_sketchFromGeometry=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_sketchFromGeometry");else return t.init.apply(this,arguments)};var i={map:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),r(this,t)}},r=function(t,i){var s,e,f,o;if(i.map&&i.sketch){s=n(t);e={id:"webgis.tools.identify",type:"servertoolcommand_ext",command:"sketchfromgeometry"};e.handleToolResponseCustomHandler=function(n){n.ui&&(n.ui.map=i.map,n.ui.tool=e,n.ui.title=null,n.ui.closebutton=!1,s.webgis_uibuilder(n.ui))};var u={},r=i.map,h=i.sketch;if(i.map&&i.map.crs&&h){f=null;r._currentCursorPosition&&r._currentCursorPosition.lat&&r._currentCursorPosition.lng&&(f=webgis.fromWGS84(i.map.crs,r._currentCursorPosition.lat,r._currentCursorPosition.lng));o=n("<input type='hidden'>").addClass("webgis-all-queries").appendTo(n(r.elem));r.ui.refreshUIElements();u["identify-all-queries"]=o.val();u["identify-map-scale"]=r.scale();u["identify-srs"]=i.map.crs.id;u["sketch-geometry"]=h.getGeometryType();u["current-activetool-id"]=r.getActiveTool()?r.getActiveTool().id:null;o.remove();f&&(u["identify-x"]=f.x,u["identify-y"]=f.y);webgis.tools.onButtonClick(i.map,e,null,null,u)}}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_uploadSketch=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_uploadSketch");else return t.init.apply(this,arguments)};var i={map:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),r(this,t)}},r=function(t,i){var u,r;if(i.map&&i.sketch){u=n(t);r={id:"webgis.tools.coordinates",type:"servertoolcommand_ext",command:"upload-sketch"};r.handleToolResponseCustomHandler=function(n){n.ui&&(n.ui.map=i.map,n.ui.tool=r,n.ui.title=null,n.ui.closebutton=!1,u.webgis_uibuilder(n.ui))};var f={},o=i.map,e=i.sketch;e&&(f["sketch-geometry-type"]=e.getGeometryType());webgis.tools.onButtonClick(o,r,null,null,f)}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_downloadSketch=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_downloaddSketch");else return t.init.apply(this,arguments)};var i={map:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),r(this,t)}},r=function(t,i){var u,r;if(i.map&&i.sketch){u=n(t);r={id:"webgis.tools.coordinates",type:"servertoolcommand_ext",command:"download-sketch"};r.handleToolResponseCustomHandler=function(n){n.ui&&(n.ui.map=i.map,n.ui.tool=r,n.ui.title=null,n.ui.closebutton=!1,u.webgis_uibuilder(n.ui))};var f={},o=i.map,e=i.sketch;e&&(f["sketch-geometry-type"]=e.getGeometryType());webgis.tools.onButtonClick(o,r,null,null,f)}}}(webgis.$||jQuery),function(n){"use strict";n.fn.select_sketch=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.select_sketch");else return t.init.apply(this,arguments)};var i={map:null,named_sketches:null,close_sketch:!1},t={init:function(t){var u=n(this);return t=n.extend({},i,t),r(this,t)}},r=function(t,i){function p(t,u){var e=n(t).css("background-image","url("+webgis.css.imgResource("button-ok.png","")+")"),o,s;if(r.fromJson(e.data("sketch")),e.data("zoom_on_preview")&&r.zoomTo(),i.close_sketch&&r.appendPart(),!u&&(e.data("set_sketch")||r.load(f),o=e.data("setters"),o&&o.length>0))for(s of o)n("#"+s.id).val(s.val)}function w(t,i){var u=n(this).css("background-image","url("+webgis.css.imgResource("button-cancel.png","")+")");c&&i?(r.load(f),s&&r.zoomTo()):r.load(f)}var h,r,v,f,e,u,o,a;if(i.map&&i.named_sketches&&(console.log(i),h=i.map.getActiveTool(),r=h&&h.tooltype==="graphics"?i.map.graphics._sketch:i.map.sketch,r)){v=n("<div class='blocker' style='z-index:9999999;position:absolute;left:0px;right:0px;top:0px;bottom:0px;background:rgba(0,0,0,0.5)' oncontextmenu='return false;'><\/div>").appendTo("body").click(function(){n(this).remove()});f=r.store();let c=!1,s=!1;for(e in i.named_sketches)c|=i.named_sketches[e].set_sketch!==!1,s|=i.named_sketches[e].zoom_on_preview===!0;var y=n("<div class='webgis-contextmenu icons' style='position:absolute;background:#fff;display:inline-block' >").appendTo(v).on("mouseleave",function(){r.load(f);s&&r.zoomTo()}),l=n("<ul>").addClass("webgis-toolbox-tool-item-group-details").css({padding:0,margin:0,minWidth:"200px"}).appendTo(y),b=n("<li>").addClass("webgis-toolbox-tool-item").appendTo(l).click(function(n){n.stopPropagation()}).on("mouseenter",function(){r.load(f);s&&r.zoomTo()});n("<strong>").text(c?"Sketch übernehmen aus":"Wert(e) übernehmen aus").appendTo(b);for(e in i.named_sketches){u=i.named_sketches[e];i.map.graphics._resetGeoJsonType(u.sketch);n("<li><\/li>").text(u.name).addClass("webgis-toolbox-tool-item").data("sketch",u.sketch).data("set_sketch",u.set_sketch).data("setters",u.setters).data("zoom_on_preview",u.zoom_on_preview).append("<br>").append(n("<span style='color:#aaa;font-size:.8em'>").text(u.subtext)).appendTo(l).on("click",function(){p(this)}).on("mouseenter",function(){p(this,!0)}).on("mouseleave",function(){n(this).css("background-image","")})}n("<li>Abbrechen<\/li>").addClass("webgis-toolbox-tool-item").appendTo(l).on("click",function(){w(this)}).on("mouseenter",function(){w(this,!0)}).on("mouseleave",function(){n(this).css("background-image","")});o=[10,10];i.map.elem&&(a=n(i.map.elem).offset(),o[0]+=a.left,o[1]+=a.top);y.css({left:o[0],top:o[1]})}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_bubble=function(t){if(u[t])return u[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_bubble");else return u.init.apply(this,arguments)};var o={id:null,map:null,onclick:null,bgImage:null,text:null,textClass:null,onDisable:null,onEnable:null,onParked:null,onDragEnd:null,onDragMove:null,trashPosition:"middle",parkPosition:null,disabled:!0,rememberDisabled:!1,parkable:!1,top:0,helpName:null,dragTolerance:1},u={init:function(u){var s=n(this);return u=n.extend({},o,u),this.each(function(){function l(u){var o=u.draggabilly();o.on("dragStart",function(){});o.on("dragEnd",function(o,s){var h,c;if(n(this).data("moveOffsetXY",null),h=n(this).data("options"),n(this).data("isdragging")!==!0){n(this).hasClass("is-longclick")||n(this).trigger("click");return}n(this).hasClass("disabled")||n(this).hasClass("parked")||!h.onDragEnd||(c=f(this,s.target),e(s),h.onDragEnd.apply(this,[{clientX:s.clientX-s.offsetX+c.x,clientY:s.clientY-s.offsetY+c.y}]));webgis.delayed(function(f){n(f).data("isdragging",!1).webgis_bubble("hideTrash");var e=n(f).data("options"),o=n(f).data("dragStartStatus"),s=!1;o===!0&&n(f).hasClass("disabled")?(e.onDisable&&e.onDisable.apply(f),s=!0):o!==!1||n(f).hasClass("disabled")||(e.onEnable&&e.onEnable.apply(f),s=!0);e.parkable&&(o=n(f).hasClass("disabled")?!1:!0,n(f).addClass("returning"),webgis.delayed(function(f){var s=r(u);o&&(s=t(u));n(f).css({left:n(f).parent().width()-u.outerWidth(!0),top:s});webgis.delayed(function(t){i(n(t).removeClass("returning"))},500,f);n(f).hasClass("parked")&&e.onParked&&e.onParked.apply(f)},10,f))},10,this)});o.on("dragMove",function(t,r,u){var o=n(this),s,h;if(webgis.is_iOS&&!o.data("moveOffsetXY")&&(e(r),o.data("moveOffsetXY",[r.offsetX,r.offsetY])),s=o.data("options"),o.data("isdragging")!==!0&&u.x*u.x+u.y*u.y>=s.dragTolerance*s.dragTolerance&&o.data("isdragging",!0).data("dragStartStatus",n(this).hasClass("disabled")===!1).webgis_bubble("showTrash"),i(n(this),r.clientX,r.clientY),!o.hasClass("disabled")&&!o.hasClass("parked")&&s.onDragMove){if(h=f(this,r.target),webgis.is_iOS===!0&&o.data("moveOffsetXY"))try{r.offsetX=o.data("moveOffsetXY")[0];r.offsetY=o.data("moveOffsetXY")[1]}catch(c){}s.onDragMove.apply(this,[{clientX:r.clientX-r.offsetX+h.x,clientY:r.clientY-r.offsetY+h.y}])}});o.on("pointerDown",function(){n(this).data("pointer-down-timer").start()});o.on("pointerUp",function(){if(n(this).hasClass("is-longclick")){var t=n(this).data("options");new webgis.timer(function(){u.removeClass("is-longclick")},100,n(this)).start();t.onLongClick&&t.onLongClick.apply(this)}else n(this).data("pointer-down-timer").stop(),webgis.is_iOS&&n(this).trigger("click")})}var o=n(this).data("map",u.map).data("options",u).addClass("webgis-bubble"),h,s,c;u.id&&u.rememberDisabled===!0&&webgis.localStorage.get("_bubble-"+u.id+"-disabled")==="1"&&(u.disabled=!0);u.onClick&&o.data("onclick",u.onClick).click(function(t){if(!n(this).hasClass("is-longclick")){var i=n(this).data("options"),r=n(this).data("map");n(this).data("isdragging")!==!0&&(n(this).hasClass("disabled")?i.helpName?r.ui.showHelp(i.helpName):webgis.alert("Zum Aktivieren des Werkzeugs, die Kugel ziehen...","info"):n(this).data("onclick")&&n(this).data("onclick").apply(this,[t]))}});u.map.events.on("resize",function(){var t=n(this).parent().width();n(this).css("left",t-n(this).outerWidth(!0));i(n(this))},o);u.bgImage&&o.css({backgroundImage:"url("+u.bgImage+")"});u.text&&(h=n("<div>"+u.text+"<\/div>").addClass("text").appendTo(o.addClass("text")),u.textClass&&webgis.variableContent.init(h,u.textClass));s=Math.max(r(o),u.top)+o.outerHeight(!0)*(u.disabled===!0?0:1.1)*(u.trashPosition==="bottom"?-1:1);u.trashPosition==="none"&&(s=Math.max(t(o),u.top));o.css({left:n(this).parent().width()-o.outerWidth(!0),top:s});u.parkable&&o.addClass("return-to-position");c=new webgis.timer(function(n){n.data("isdragging")!==!0&&n.addClass("is-longclick")},1e3,o);o.data("pointer-down-timer",c);n.fn.draggabilly?l(o):webgis.loadScript(webgis.baseUrl+"/scripts/draggabilly/draggabilly.pkgd.min.js","",function(){l(o)});i(o)})},remove:function(){var t=n(this).data("options");t&&t.onDisable&&t.onDisable.apply(this);n(this).remove()},showTrash:function(){var i=n(this),e=i.data("options"),u,f;e.trashPosition!=="none"&&(u=n("<div>").addClass("webgis-bubble-trash").appendTo(i.parent()),u.css({left:n(this).parent().width()-u.outerWidth(!0),top:r(i)}));e.parkable&&(f=n("<div>").addClass("webgis-bubble-park").appendTo(i.parent()),f.css({left:n(this).parent().width()-f.outerWidth(!0),top:t(i)}))},hideTrash:function(){n(this).parent().find(".webgis-bubble-trash").remove();n(this).parent().find(".webgis-bubble-park").remove()},isEnabled:function(){return!n(this).hasClass("disabled")},moveTo:function(t){var r=t.x,u=t.y,i;t.target&&(i=n(t.target).offset(),r+=i.left,u+=i.top);n(this).css({left:r,top:u})},park:function(r){webgis.delayed(function(u){var f=n(u),e=t(f);f.css({left:f.parent().width()-f.outerWidth(!0),top:e});webgis.delayed(function(t){i(n(t).removeClass("returning"))},500,u);n(u).hasClass("parked")&&r.onParked&&r.onParked.apply(u)},10,this)}},r=function(n){var i=n.data("options"),r=n.parent().find(".webgis-bubble-trash"),t=0;if(i&&i.trashPosition)switch(i.trashPosition){case"top":t=40;break;case"bottom":t=n.parent().height()-65-(r.length>0?r.outerHeight(!0):80);break;case"middle":t=n.parent().height()/2-(r.length>0?r.outerHeight(!0):80)/2;break;case"none":t=-100;break;default:t=i.trashPosition}return t},t=function(n){var i=n.data("options"),t=n.parent().find(".webgis-bubble-trash"),r=0;switch(i.parkPosition||i.trashPosition){case"top":r=40+(i.trashPosition==="none"?0:t.length>0?t.outerHeight(!0):80);break;case"bottom":r=n.parent().height()-65-(i.trashPosition==="none"?0:t.length>0?t.outerHeight(!0):80)*2;break;case"middle":r=n.parent().height()/2-(t.length>0?t.outerHeight(!0):80)/2+(t.length>0?t.outerHeight(!0):80);break;case"none":r=i.parkable===!0?i.top|0:-100;break;default:r=parseInt(i.trashPosition)+80}return r},i=function(n,t,i){var u=n.data("options"),f=n.outerWidth(!0);t=t?t:parseInt(n.css("left"))+n.outerWidth(!0)/2;i=i?i:parseInt(n.css("top"))+n.outerHeight(!0)/2;var e=n.parent().width()-40,o=r(n)+n.outerHeight(!0)/2,h=(t-e)*(t-e)+(i-o)*(i-o);h<f*f?(n.addClass("disabled"),u&&u.id&&u.rememberDisabled===!0&&webgis.localStorage.set("_bubble-"+u.id+"-disabled","1")):(n.removeClass("disabled"),u&&u.id&&u.rememberDisabled===!0&&webgis.localStorage.set("_bubble-"+u.id+"-disabled","0"));u&&u.parkable&&s(n,t,i)},s=function(n,i,r){var u=n.outerWidth(!0);i=i?i:parseInt(n.css("left"))+n.outerWidth(!0)/2;r=r?r:parseInt(n.css("top"))+n.outerHeight(!0)/2;var f=n.parent().width()-40,e=t(n)+n.outerHeight(!0)/2,o=(i-f)*(i-f)+(r-e)*(r-e);o<u*u?n.addClass("parked"):n.removeClass("parked")},f=function(t,i){if(t===i)return{x:0,y:0};var r=n(t).offset(),u=n(i).offset();return{x:parseInt(r.left)-parseInt(u.left),y:parseInt(r.top)-parseInt(u.top)}},e=function(t){var r;if(webgis.is_iOS){var i=t.target,u=0,e=0;n(t.target).hasClass("webgis-bubble")||(i=n(t.target).closest(".webgis-bubble").get(0),r=f(i,t.target),u=r.x,e=r.y);try{t.offsetX=t.pageX-i.offsetLeft+u;t.offsetY=t.pageY-i.offsetTop+e}catch(o){}}},h=function(t){var r=n(t).css("transform"),i;return r?(i=r.replace(/[^0-9\-.,]/g,"").split(","),{x:parseInt(i[4]),y:parseInt(i[5])}):{x:0,y:0}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_control_upload=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_control_search");else return t.init.apply(this,arguments)};var i={edit_service:"service",edit_theme:"",field_name:"File",hidden_class:"",onUpload:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})}},r=function(t,i){var r="target-"+webgis.guid(),u=n("#__webgis-upload-div-container"),e,o,s,f,h,c;u.length===0&&(u=n("<div id='__webgis-upload-div-container' style='display:none'><\/div>").appendTo("body"));u.find("#"+i.field_name+"-"+r+"-upload-div").remove();e=n("<div><\/div>").attr("id",i.field_name+"-"+r+"-upload-div").appendTo(u);o=n(t).addClass("webgis-control-upload");n("<iframe id='"+i.field_name+"-"+r+"-frame' name='"+i.field_name+"-"+r+"-frame' style='display:none'><\/iframe>").appendTo(e);s=n("<form method='post' enctype='multipart/form-data' target='"+i.field_name+"-"+r+"-frame' action=''><\/form>").appendTo(e);f=i.field_name+"-"+r+"-"+webgis.guid();n("<input id='"+f+"' name='file' type='file' />").appendTo(s).change(function(){var s=webgis.baseUrl+"/rest/services/"+n(this).attr("data-service")+"/edit/"+n(this).attr("data-theme")+"/upload?"+webgis.hmac.urlParameters({responseformat_:"framed",callbackchannel:n(this).attr("id"),field:n(this).attr("data-name")}),h=n(this).attr("id"),c=n(this).closest(".webgis-collector-container"),l=c.attr("data-targetid"),f=n("#"+n(this).attr("data-name")+"-"+l+"-preview"),e,i,r;f.css("height","22px").find("img").remove();for(e in this.files)if(i=this.files[e],i&&i.size){var o=new FormData,t=new XMLHttpRequest,u=n("<progress id='progress' style='width:100%;height:20px;z-index:100' value='0' max='100'><\/progress>");u.appendTo(f);r=u.get(0);o.append(this.name,i);t.onerror=function(){webgis.alert("Error","error")};t.onload=function(){r.value=r.max;u.remove();var i=n.eval(t.responseText);webgis.events.fire(h,i)};t.upload.onprogress=function(n){var t=Math.round(100/n.total*n.loaded);r.value=t};t.onabort=function(){webgis.alert("Upload abgebrochen","info")};t.open("POST",s);t.send(o)}return}).attr("data-name",i.field_name).attr("data-service",i.edit_service).attr("data-theme",i.edit_theme);h=n("<input type='hidden' id='editfield_"+i.field_name+"' name='editfield_"+i.field_name+"' />").appendTo(o);i.hidden_class&&h.addClass(i.hidden_class);c=n("<div id='"+i.field_name+"-"+r+"-preview' class='webgis-input' style='cursor:pointer;width:288px;position:relative;height:22px;display:block'><div style='position:absolute;right:2px;bottom:2px;width:26px;height:26px;background:url("+webgis.baseUrl+"/content/api/img/upload-26.png) no-repeat center right;' /><\/div><\/div>").appendTo(o).click(function(){n("#"+n(this).attr("data-fileinput-id")).trigger("click")}).attr("data-name",i.field_name).attr("data-fileinput-id",f).data("onUpload",i.onUpload).get(0);webgis.events.on(f,function(t,i){n(this).parent().find("input[name='editfield_"+n(this).attr("data-name")+"']").val(i.url);n(this).css("height","auto").find("img").remove();n("<img src='"+webgis.baseUrl+i.url+"&size=256' style='margin:-4px' />").appendTo(n(this));n(this).data("onUpload")&&n(this).data("onUpload")(n(this).closest(".webgis-control-upload"),i)},c)}}(webgis.$||jQuery);webgis.$.extend({eval:function(n){return(typeof n=="string"&&(n=window.JSON?JSON.parse(n):eval("("+n+")")),!n)?{}:n}}),function(n){"use strict";n.fn.webgis_graphicsInfoContainer=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_graphicsInfoContainer");else return t.init.apply(this,arguments)};let f={map:null,readonly:!1};const t={init:function(t){var i=n(this);return t=n.extend({},f,t),this.each(function(){new c(this,t)})},refresh:function(t){var r=n(this);return t=n.extend({},f,t),this.each(function(){new i(this,t)})},refreshAllContainers:function(t){t&&t.type?n(".webgis-graphics-info-container-holder."+t.type).webgis_graphicsInfoContainer("refresh"):n(".webgis-graphics-info-container-holder").webgis_graphicsInfoContainer("refresh")},hasContainers:function(t){return t&&t.type?n(".webgis-graphics-info-container-holder."+t.type).length>0:n(".webgis-graphics-info-container-holder").length>0},destroyReadOnlyContainers:function(){n(".webgis-graphics-info-container-holder.readonly").each(function(t,i){var u=n(i),r;n.fn.webgis_dockPanel?(r=n(i).closest(".webgis-dockpanel"),r.length>0?r.webgis_dockPanel("remove"):u.remove()):u.remove()})}},c=function(t,r){var u=n(t).addClass("webgis-graphics-info-container-holder");r.readonly===!0?u.addClass("readonly"):(n(null).webgis_graphicsInfoContainer("destroyReadOnlyContainers"),u.addClass("editable"));u.data("map",r.map);i(t,r)},i=function(t,i){var l,a;const r=t?n(t):n(this);r.empty();const f=i.map||r.data("map"),s=f.graphics.getElements(),c=r.hasClass("readonly");r.hasClass("order-descending")&&s.reverse();const b=o(s)>1;c||f.graphics.hasSelectedElements()||f.graphics.hasStagedElement()||(l=f.graphics.getTool(),n("<h3><img style='margin-right:10px' src='"+webgis.css.imgResource("rest/toolresource/webgis-tools-mapmarkup-mapmarkup-"+l)+"'><\/h2>").text(h(l)).appendTo(r),n("<div>").addClass("webgis-info").text(f.graphics.getToolDescription(l)).appendTo(r));n("<div>").addClass("webgis-graphics-info-list-menu").appendTo(r);e(r);a=0;r.children().each(function(t,i){a+=n(i).outerHeight(!0)});const y=n("<ul>").addClass("webgis-graphics-info-list").css("height","calc(100vh - "+(440+a)+"px").appendTo(r),p=f.graphics.hasStagedElement(),v=f.graphics.hasUpdatingElement(),w=p||v,k=f.graphics.getStagedElement();for(let t of s)if(c!==!0||t.type!=="text"){const i=n("<li><\/li>").addClass("webgis-graphics-info-listitem"+(t.originalElement&&t.originalElement.selected===!0?" selected":"")).appendTo(y).data("element",t);v?t.updating||i.addClass("unselectable"):(i.mouseenter(function(){const i=n(this).closest(".webgis-graphics-info-container-holder").data("map"),t=n(this).data("element");t&&!t.updating&&t.originalElement&&t.originalElement.frameworkElement&&i.graphics.addPreviewFromJson(t.originalElement.frameworkElement.toGeoJSON().geometry,!1,!0)}).mouseleave(function(){var t=n(this).closest(".webgis-graphics-info-container-holder").data("map");t.graphics.removePreview()}),w||i.addClass("can-select").click(function(t){const f=n(this),i=n(this).closest(".webgis-graphics-info-container-holder").data("map"),r=n(this).data("element"),e=n(this).closest(".webgis-graphics-info-container-holder").hasClass("readonly");e===!1?t.shiftKey?u(f,s,r,"shift"):t.ctrlKey?u(f,s,r,"ctrl"):u(f,s,r):(n(this).parent().children(".selected").removeClass("selected"),n(this).addClass("selected"),i.isEnabled()||i.enable(!0),i.graphics.zoomTo(r));webgis.delayed(function(n){n.graphics.removePreview()},100,i)}));let r=t.metaText&&t.metaText.length>0,o=r?"":"unlabeled",e=r?t.metaText:h(t.type);i.css({borderLeft:"8px solid "+(t.fill||t.stroke||t.color||"#fff")});const l=n("<div>").addClass("button symbol").addClass(t.updating?"":"inactive").css({backgroundImage:"url("+webgis.css.imgResource("rest/toolresource/webgis-tools-mapmarkup-mapmarkup-"+t.type)+")"}).appendTo(i);if(t.updating&&l.click(function(t){t.stopPropagation();const i=n(this).closest(".webgis-graphics-info-listitem").data("element");webgis.tools.onButtonClick(f,{command:"show-symbol-selector",type:"servertoolcommand",map:f},this,null,{"mapmarkup-symbol-type":i.type})}),t.updating){const u=n("<textarea rows='1'>").addClass("webgis-textarea").attr("placeholder","Label (optional)...").appendTo(i).val(r?e:"");t.type==="text"?u.keyup(function(){const t=n(this),i=t.closest(".webgis-graphics-info-container-holder").data("map");i.graphics.setMetaText(t.val())}):u.change(function(){const t=n(this),i=t.closest(".webgis-graphics-info-container-holder").data("map");i.graphics.setMetaText(t.val())})}else n("<div>").addClass("label-text").text(e).appendTo(i);i.addClass(o);c&&t.readonly_selected&&i.addClass("selected");c===!1&&(t.updating===!0?n("<div>").addClass("button commit").appendTo(i).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-graphics-info-container-holder").data("map"),r=n(this).closest(".webgis-graphics-info-listitem").data("element");i.graphics.commitCurrentElement()}):v||((t.type==="polygon"||t.type==="line"||t.type==="point"&&t.metaText)&&n("<div>").addClass("button label").appendTo(i).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-graphics-info-container-holder").data("map"),r=n(this).closest(".webgis-graphics-info-listitem").data("element");i.graphics.labelElement(r.originalElement)}),n("<div>").addClass("button edit").appendTo(i).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-graphics-info-container-holder").data("map"),r=n(this).closest(".webgis-graphics-info-listitem").data("element");i.graphics.commitCurrentElement(!0);i.graphics.setTool("pointer");i.graphics._onElementClick.apply(r.originalElement,[t]);webgis.delayed(function(){i.graphics.removePreview()},300)}),n("<div>").addClass("button delete").appendTo(i).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-graphics-info-container-holder").data("map"),r=n(this).closest(".webgis-graphics-info-listitem").data("element");i.graphics.removeElement(r.originalElement)})))}},e=function(t){const r=t.data("map");if(r){const f=r.graphics.selectedElements(),u=t.find(".webgis-graphics-info-list-menu").empty();if(r.graphics.hasStagedElement()===!0)n("<div>").addClass("button delete").attr("title","Element entfernen").appendTo(u).click(function(n){n.stopPropagation();r.graphics.removeCurrentElement()});else if(f.length>0){const i=new Set;for(let n of[...new Set(f.map(n=>n.type))]){const t=r.graphics.getStyleTypes(n);if(t&&t.styles)for(let n of t.styles)i.add(n)}if(i.size>0){var e=n("<div>").addClass("text-button").data("styles",Array.from(i).toString()).appendTo(u).click(function(t){if(t.stopPropagation(),r.graphics.hasUpdatingElement()){n(this).closest(".webgis-graphics-info-container-holder").find(".webgis-graphics-info-listitem.selected .button.symbol").trigger("click");return}webgis.tools.onButtonClick(r,{command:"show-single-symbol-selector",type:"servertoolcommand",map:r},this,null,{"mapmarkup-styles":n(this).data("styles")})});n("<div>").addClass("button").attr("title","Symbolik anpassen").css({backgroundImage:"url("+webgis.css.imgResource("content/api/img/graphics/ui/polygon-styles.png")+")"}).appendTo(e);n("<div>").addClass("text").text("Symbolik").appendTo(e)}r.graphics.hasUpdatingElement()!==!0&&(n("<div>").addClass("button remove-selection").attr("title","Auswahl entfernen").appendTo(u).click(function(n){n.stopPropagation();r.graphics.clearElementSelection();t.find(".webgis-graphics-info-listitem").removeClass("selected");u.empty()}),n("<div>").addClass("button delete").attr("title","Ausgewählte Elemente entfernen").appendTo(u).click(function(n){n.stopPropagation();r.graphics.removeElements(f)}))}else r.graphics.countElements()>0&&n("<div>").addClass("button order").attr("title","Reihenfolge umkehren").appendTo(u).click(function(t){t.stopPropagation();const r=n(this).closest(".webgis-graphics-info-container-holder");i(r.toggleClass("order-descending"),{})})}},y=function(n){return n.filter(n=>n.originalElement.selected===!0)},o=function(n,t){return n.filter(n=>n!=t&&n.originalElement.selected===!0).length},r=(n,t)=>n.indexOf(t),l=function(n,t){let i=r(n,t);for(let t=i-1;t>=0;t--)if(n[t].originalElement.selected===!0)return t;return-1},a=function(n,t){let i=r(n,t);for(let t=i+1;t<n.length;t++)if(n[t].originalElement.selected===!0)return t;return-1},u=function(t,i,u,f){if(f=="ctrl")u.originalElement.selected=u.originalElement.selected?!1:!0;else if(f=="shift")if(o(i,u)==0)u.originalElement.selected=!0;else{let t=r(i,u),n=l(i,u);if(n=n>=0?n:a(i,u),n<0)u.originalElement.selected=!0;else{let r=Math.min(t,n),u=Math.max(t,n);for(let n=r;n<=u;n++)i[n].originalElement.selected=!0}}else{const n=u.originalElement.selected?!1:!0;i.forEach(n=>n.originalElement.selected=!1);u.originalElement.selected=n}t.closest(".webgis-graphics-info-list").children().each(function(t,i){var r=n(i).data("element");r&&(r.originalElement.selected?n(i).addClass("selected"):n(i).removeClass("selected"))});e(t.closest(".webgis-graphics-info-container-holder"))},s=function(n){return n.isCurrentNew===!0},v=function(n){return s(n)===!1&&n.metaText&&n.metaText.length>0?!0:!1},p=function(n){return s(n)===!1&&v(n)===!1},h=function(n){return webgis.l10n.get("mapmarkup-tool-"+n)}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_sketchInfoContainer=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_sketchInfoContainer");else return t.init.apply(this,arguments)};var r={map:null,readonly:!1},t={init:function(t){var i=n(this);return t=n.extend({},r,t),this.each(function(){new u(this,t)})}},u=function(t,r){var u,h,e,c,s,f,o;if(r||r.map){if(u=n(t).addClass("webgis-sketch-info-container-holder"),u.data("map",r.map),h=n("<table><tr><th colspan=2>"+webgis.l10n.get("sketch")+"<\/th><\/tr><\/table>").appendTo(u),n("<tr><td>"+webgis.l10n.get("geometry-type")+":<\/td><td class='sketch-info-item sketch-geometrytype'><\/td>").appendTo(h),e=n("<table><tr><th colspan=2>"+webgis.l10n.get("segment")+"<\/th><\/tr><\/table>").appendTo(u),n("<tr><td>"+webgis.l10n.get("segment-length")+":<\/td><td class='sketch-info-item segment-length'><\/td>").appendTo(e),n("<tr><td>"+webgis.l10n.get("segment-azimuth")+":<\/td><td class='sketch-info-item segment-azimut-deg'><\/td>").appendTo(e),n("<tr><td><\/td><td class='sketch-info-item segment-azimut-grad'><\/td>").appendTo(e),c=n("<div>").css("display","none").appendTo(u),s=n("<table><tr><th colspan=2>Snapping<\/th><\/tr><\/table>").appendTo(u),n("<tr><td>"+webgis.l10n.get("snap-to")+":<\/td><td class='sketch-info-item snap-result-type'><\/td>").appendTo(s),n("<tr><td>"+webgis.l10n.get("snap-to-layer")+":<\/td><td class='sketch-info-item snap-result-name'><\/td>").appendTo(s),f=r.map.toolSketch(),f){f.events.off("currentstate",i);f.events.on("currentstate",i,{sketch:f,elem:u,tabSegment:e,divConstruction:c,tabSnapping:s})}o=n("<ul>").addClass("webgis-contextmenu webgis-tool-contextmenu icons").css("box-shadow","none").css("border","none").data("sketch",f).appendTo(u);n("<li>").text(webgis.l10n.get("sketch-ortho-off")).addClass("ortho-off").css("background-image","url("+webgis.css.imgResource("sketch_ortho_off-26.png","tools")+")").appendTo(o).click(function(){var t=n(this).closest("ul").data("sketch");t&&t.stopOrthoMode()});n("<li>").text(webgis.l10n.get("sketch-trace-off")).addClass("trace-off").css("background-image","url("+webgis.css.imgResource("sketch_trace_off-26.png","tools")+")").appendTo(o).click(function(){var t=n(this).closest("ul").data("sketch");t&&t.stopTraceMode()});n("<li>").text(webgis.l10n.get("sketch-fan-off")).addClass("fan-off").css("background-image","url("+webgis.css.imgResource("sketch_fan_off-26.png","tools")+")").appendTo(o).click(function(){var t=n(this).closest("ul").data("sketch");t&&t.stopFanMode()});o.children("li").addClass("webgis-toolbox-tool-item").css({display:"none",width:"100%",boxSizing:"border-box",textAlign:"left"})}},i=function(t,i){var r=this.sketch,u=this.elem,o,y,p,c,f,s;u.find(".sketch-info-item").text("");var l=this.tabSegment,e=this.divConstruction,a=this.tabSnapping,h=webgis.sketch.construct?webgis.sketch.construct.getConstructionMode(r):null,v=i.geometryType;if(u.find(".sketch-info-item.sketch-geometrytype").text(webgis.l10n.get(v)),!h&&n.inArray(v,["polygon","polyline"])>=0?(l.css("display","block"),e.css("display","none"),i.segmentLength>=0&&u.find(".sketch-info-item.segment-length").text(Math.round(i.segmentLength*100)/100+" m"),i.segmentAzimut&&(u.find(".sketch-info-item.segment-azimut-deg").text(Math.round(i.segmentAzimut*180/Math.PI*1e3)/1e3+"°"),u.find(".sketch-info-item.segment-azimut-grad").text(Math.round(i.segmentAzimut*200/Math.PI*1e3)/1e3+" gon"))):l.css("display","none"),h){if(e.css("display","block").children(".temp").remove(),o=webgis.sketch.construct.getInfoItems(r),o){y=n("<div>").addClass("temp").prependTo(e);for(p in o)c=o[p],n("<div>").addClass("temp").addClass("webgis-"+(c.class||"tip")).css("margin-top","4px").text(c.text).appendTo(y)}f=n("<div>").addClass("temp").css({marginTop:"4px",paddingRight:"26px",minHeight:"30px",position:"relative"}).prependTo(e);n("<strong>").text("Konstruktionsmodus:").appendTo(f);n("<br>").appendTo(f);n("<strong>").text(webgis.l10n.get("construction-mode-"+h)).appendTo(f);n("<div>").addClass("webgis-button-close-24").appendTo(f).click(function(){webgis.sketch.construct.cancel(r)})}s=u.find("ul.webgis-contextmenu");s.children("li.ortho-off").css("display",r.isInOrthoMode()?"block":"none");s.children("li.trace-off").css("display",r.isInTraceMode()?"block":"none");s.children("li.fan-off").css("display",r.isInFanMode()?"block":"none");r.map&&r.map.construct.hasSnapping(r)===!0?(a.css("display","block"),i.snapResult&&(u.find(".sketch-info-item.snap-result-type").text(webgis.l10n.get(i.snapResult.type)),i.snapResult.meta&&u.find(".sketch-info-item.snap-result-name").text(i.snapResult.meta.name))):a.css("display","none")}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_validation=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_validation");else return t.init.apply(this,arguments)};var i={minlen:0,required:!1,regex:null,error:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})},validate:function(){var t=n(this).removeClass("validated-parameter"),r=n(this).val(),i;if(t.attr("webgis-validation-required")&&!r?i="Eingabe ist erforderlich":t.attr("webgis-validation-minlen")&&parseInt(t.attr("webgis-validation-minlen"))>r.length?i="Eingabe muss mindestens "+t.attr("webgis-validation-minlen")+" Zeichen lang sein":t.attr("webgis-validation-regex")&&!r.match(t.attr("webgis-validation-regex"))&&(i="Die Eingabe erfüllt nicht den regulären Ausdruck: "+t.attr("webgis-validation-regex")),i){let r=n(this).addClass("webgis-not-valid").data("errorMessageElement"),u=t.attr("webgis-validation-error")||i;r.addClass("haserror").text(u);u.length>50&&r.css("cursor")==="pointer"&&r.hasClass("hasclickevent")===!1&&r.addClass("hasclickevent").click(function(){let t=n(this);t.css("white-space",t.css("white-space")==="nowrap"?"normal":"nowrap")})}else n(this).removeClass("webgis-not-valid").addClass("validated-parameter").data("errorMessageElement").text("").removeClass("haserror")}},r=function(t,i){var r=n(t);r.addClass("webgis-validation");i.minlen&&r.attr("webgis-validation-minlen",i.minlen);i.regex&&r.attr("webgis-validation-regex",i.regex);i.required&&r.attr("webgis-validation-required",!0);i.error&&r.attr("webgis-validation-error",i.error);const u=n("<div>").addClass("webgis-validation-error").insertAfter(r);r.data("errorMessageElement",u);r.on("input",function(){n(this).webgis_validation("validate")})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_liveshare=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_liveshare");else return t.init.apply(this,arguments)};var i={map:null},t={init:function(t){var u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})}},r=function(t){var i=n(t).addClass("webgis-liveshare-container"),u=n("<ul>").addClass("liveshare-users").appendTo(i),f,e,r;webgis.liveshare.events.on("onclientjoined",function(t,i){n("<li><div class='username'>"+i.clientId+"<\/div><div class='connection-id'>"+i.connectionId+"<\/div><\/li>").attr("data-connection-id",i.connectionId).css("background-image","url("+webgis.baseUrl+"/rest/usermarkerimage?id="+webgis.encodeURI(i.clientId)+"&width=26)").addClass("liveshare-user-item").appendTo(u)});webgis.liveshare.events.on("onclientleft",function(n,t){u.find("li[data-connection-id='"+t.connectionId+"']").remove()});webgis.liveshare.events.on("onleftsession",function(){console.log("onleftsession");u.empty()});n("<div><input type='checkbox' id='liveshare-share-mapextent'><label for='liveshare-share-mapextent' class='webgis-input-label'>Kartenauschnitt teilen<\/label><div>").addClass("webgis-input-group").appendTo(i);n("<div><input type='checkbox' id='liveshare-share-layervisibility'><label for='liveshare-share-layervisibility' class='webgis-input-label'>Themenschaltung teilen<\/label><\/div>").addClass("webgis-input-group").appendTo(i);f=i.find("#liveshare-share-mapextent");e=i.find("#liveshare-share-layervisibility");f.prop("checked",webgis.liveshare.allowShareExtent);e.prop("checked",webgis.liveshare.allowShareLayerVisibility);f.click(function(){webgis.liveshare.allowShareExtent=n(this).prop("checked")});e.click(function(){webgis.liveshare.allowShareLayerVisibility=n(this).prop("checked")});r=n("<div>").addClass("webgis-liveshare-messages").appendTo(i);n("<input placeholder='Kurznachricht...'>").addClass("webgis-input").insertBefore(r).keypress(function(t){if(t.which==13){var i=n(this).val();i&&(n("<div><div>Ich:<\/div><div class='message'>"+i+"<\/div><\/div>").addClass("self").prependTo(r),webgis.liveshare.emit({command:"text-message",args:{message:i}}));n(this).val("")}});webgis.liveshare.events.on("onreceive",function(t,i){i&&i.message&&i.message.command==="text-message"&&i.message.args&&n("<div><div>"+i.clientId+":<\/div><div class='message'>"+i.message.args.message+"<\/div><\/div>").addClass("client").prependTo(r)})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_errors=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_errors");else return t.init.apply(this,arguments)};var u={map:null,tab_element_selector:null,allow_remove:!0},t={init:function(t){var i=n(this);return t=n.extend({},u,t),this.each(function(){new f(this,t)})},add:function(t){r(n(this),{requestcommand:t.title,exception:t.message,map:t.map},t.suppressShowTab!==!0)},hasErrors:function(){var t=n(this).length>0?n(this):n(".webgis-errors-holder");return t.find(".webgis-error-item").length>0}},f=function(t,u){var f,o,s;if(u.map){f=n(t).addClass("webgis-errors-holder");f.data("options",u);o=u.map;u.allow_remove&&(s=n("<div>").addClass("uibutton uibutton-cancel").appendTo(f),n("<input type='checkbox' checked=checked id='webgis-error-control-auto-show-errors' />").appendTo(s),n("<label for='webgis-error-control-auto-show-errors'>").text("Warnungen/Fehler automatisch anzeigen").appendTo(s),n("<button>").addClass("webgis-button uibutton").text("Alle entfernen").appendTo(f).click(function(){n(this).parent().find(".webgis-error-list").empty();i(f)}));n("<ul>").addClass("webgis-error-list").appendTo(f);o.events.on("onserviceerror",function(n,t,i){r(f,i,i.map==null)});o.events.on("requestidchanged",function(){e(f)})}},r=function(t,r,u){var c=t.children(".webgis-error-list"),s=t.data("options"),o;r.requestid&&s.map&&r.requestid!=s.map.currentRequestId();o="";r.requestcommand&&(o+=r.requestcommand+": ");r.service&&r.service.serviceInfo&&(o+=r.service.serviceInfo.name);var f=new Date,l=f.getDate()+"."+(f.getMonth()+1)+"."+f.getFullYear()+" @ "+f.getHours().toString().padStart(2,"0")+":"+f.getMinutes().toString().padStart(2,"0")+":"+f.getSeconds().toString().padStart(2,"0"),h=r.exception,e=n("<li>").addClass("webgis-error-item").prependTo(c);n("<div>").addClass("title").text(o).appendTo(e);n("<div>").addClass("timestamp").text(l).appendTo(e);n.each(h.split("\n"),function(t,i){n("<p>").addClass("message").text(i).appendTo(e)});r.requestcommand&&e.addClass(r.requestcommand.toString().toLowerCase());r.requestid&&e.addClass("hasrequestid").attr("data-requestid",r.requestid);webgis.effects.popup(e);i(t,u);r.map&&webgis.toastMessage("Warnung:","Es sind Fehler aufgetreten: "+h.substr(0,Math.min(50,h.length)),function(){n(s.tab_element_selector).trigger("click")},"warning")},e=function(n){var t=n.children(".webgis-error-list");t.children("li.getmap.hasrequestid").remove();i(n)},i=function(t,i){var f=t.data("options"),o=t.children(".webgis-error-list"),u=o.children(".webgis-error-item").length,r,e;f.tab_element_selector&&(r=n(f.tab_element_selector),e=r.find(".webgis-error-counter"),r.css("display",u>0?"":"none"),e.css("display",u>0?"":"none").text(u),r.hasClass("webgis-tabs-tab")&&r.parent().hasClass("webgis-tabs-holder")&&n.fn.webgis_tabs&&(r.parent().webgis_tabs("resize"),u===0&&r.hasClass("webgis-tabs-tab-selected")&&r.parent().find(".webgis-tabs-tab").first().trigger("click")),u>0&&i===!0&&t.find("#webgis-error-control-auto-show-errors").is(":checked")&&r.trigger("click"))}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_staticOverlayControl=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_staticOverlayControl");else return t.init.apply(this,arguments)};var i={map:null,add_remove:!0,command_buttons:[]},t={init:function(t){var u=n.extend({},i,t);return this.each(function(){new r(this,u)})},val:function(t){var r=n(this),i;return console.log("webgis_staticOverlayControl.val",t),typeof t=="string"&&(r.data("webgis-value-element").val(t),i=null,r.find(".webgis-static-overlay-control-item").each(function(r,u){n(u).data("service").id===t&&(i=n(u))}),i&&!i.hasClass("selected")&&i.trigger("click")),r.data("webgis-value-element").val()}},r=function(t,i){var f=n(t).addClass("webgis-static-overlay-control"),r=i.map,s=n("<input type='hidden' class='webgis-selected-id' />").appendTo(f);if(f.data("webgis-value-element",s),r){var e=n("<div>").appendTo(f),h=r.serviceIds(),o=[];n.each(h,function(n,t){var i=r.getService(t);i.type==="static_overlay"&&o.push(i)});o.sort(function(n,t){return n.getOrder()==t.getOrder()?0:n.getOrder()<t.getOrder()?-1:1}).reverse();n.each(o,function(n,t){u(e,t,i)});webgis.require("sortable",function(){Sortable.create(e.get(0),{animation:150,ghostClass:"webgis-sorting",onSort:function(){var t=e.find(".webgis-static-overlay-control-item"),i=r.maxBackgroundCoveringServiceOrder()+t.length+1;t.each(function(t,r){var u=n(r).data("service");console.log(u.id);u.setOrder(i--)})}})})}},u=function(t,i,r){console.log("addService",i);var u=n("<div>").addClass("webgis-static-overlay-control-item").data("service",i).appendTo(t).click(function(t){var i,r,u;t.stopPropagation();i=n(this);r=i.closest(".webgis-static-overlay-control").find("input.webgis-selected-id");i.hasClass("selected")?(i.removeClass("selected"),i.data("service").hidePassPoints(),r.val("")):(u=i.parent().children(".selected").data("service"),i.parent().children(".selected").removeClass("selected"),u&&u.hidePassPoints(),i.addClass("selected"),r.val(i.data("service").id),i.data("service").showPassPoints())}),f=n("<div>").addClass("item-tools").appendTo(u);n("<div>").addClass("item-tool remove").appendTo(f).click(function(t){t.stopPropagation();var i=n(this).closest(".webgis-static-overlay-control-item"),r=i.data("service");r.map.removeServices([r.id]);i.remove()});n("<div>").addClass("item-tool topmost"+(i.isTopMost()===!0?" selected":"")).appendTo(f).click(function(t){t.stopPropagation();var i=n(this),r=i.closest(".webgis-static-overlay-control-item"),u=r.data("service");i.hasClass("selected")?(u.resetOrder(),i.removeClass("selected")):(r.closest(".webgis-static-overlay-control").find(".webgis-static-overlay-control-item > .item-tools > .item-tool.topmost").removeClass("selected"),u.bringToTop(),i.addClass("selected"))});n.each(r.command_buttons,function(t,i){n("<div>").addClass("item-tool").data("button",i).css("background-image","url("+webgis.css.imgResource(i.icon)+")").appendTo(f).click(function(t){t.stopPropagation();var u=n(this).closest(".webgis-static-overlay-control-item"),i=u.data("service"),f=n(this).data("button"),r=i.map.getActiveTool(),e=i.map.isServerButton(r.id)?"servertoolcommand_ext":"servertoolcommand";webgis.tools.onButtonClick(i.map,{command:f.command,type:e,id:r.id,map:i.map,argument:i.id})})});n("<div>").addClass("item-title").text(i.name).appendTo(u);n("<div>").addClass("service-opacity-control").appendTo(u).webgis_opacity_control({service:i})}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_splitter=function(t){if(i[t])return i[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on webgis.$.webgis_splitter");else return i.init.apply(this,arguments)};var f={map:null,direction:null},i={init:function(t){var i=n(this);return t=n.extend({},f,t),this.each(function(){new e(this,t)})},setSize:function(t){var u=n(this),i=u.children(),f=!1;i.each(function(e,o){var h=n(o),a,c,l,s;h.hasClass(t.selectorClass)&&(a=h.height(),(t.size>a||t.absolute===!0)&&(e>1?c=n(i[e-2]):i.length>2&&(c=n(i[2])),c&&(l=c.height(),s=t.size-h.height(),s>0&&s>l+10&&(s=l-10),l-=s,c.css("height",l),e<i.length-1&&h.css("height",h.height()+s),r(u),f=!0)))});t.map&&f&&t.map.resize()}},e=function(i,f){var e=n(i),s;if(!e.hasClass("webgis-splitter-initialized")){if(s=f.direction||e.attr("data-direction"),s==="horizontal"){var l=e.height(),o=e.children(),h=0;o.each(function(i,r){var u=n(r),s=u.height(),c;u.css({position:"absolute",top:h,left:0,right:0,height:s});i<o.length-1?(u.css({bottom:"unset"}),c=n("<div>").addClass("webgis-splitter-bar horizontal").css({top:h+s}).insertAfter(u).on("mousedown",function(i){i.stopPropagation();e.data("start-position",t(e,i));e.data("current-splitter",n(this));f.map.events.fire("begin-resize",f.map)}),n("<div>").addClass("webgis-splitter-minimize").appendTo(c).click(function(t){t.stopPropagation();var i=n(this);e.webgis_splitter("setSize",{selectorClass:i.parent().next().attr("class"),size:i.parent().next().attr("data-minsize")||0,absolute:!0,map:f.map})})):u.css({height:"unset",bottom:0});h+=s});r(e);e.on("mouseup",function(i){var u=e.data("start-position");if(u){var h=t(e,i),c=h.y-u.y,s=e.data("current-splitter").prev();s.css({height:s.height()+c});e.data("start-position",null);e.data("current-splitter",null);r(e);o.each(function(t,i){var r=n(i);r.attr("data-minsize")&&e.webgis_splitter("setSize",{selectorClass:r.attr("class"),size:r.attr("data-minsize"),map:f.map})});f.map&&f.map.resize()}}).on("mousemove",function(n){var r=e.data("start-position"),i;r&&(i=t(e,n),e.data("current-splitter").css({top:i.y}))})}if(s==="vertical"){var a=e.width(),o=e.children(),c=0;o.each(function(i,r){var u=n(r),s=u.width(),h;u.css({position:"absolute",top:0,buttom:0,left:c,width:s});i<o.length-1?(u.css({right:"unset"}),h=n("<div>").addClass("webgis-splitter-bar vertical").css({left:c+s}).insertAfter(u).on("mousedown",function(i){i.stopPropagation();e.data("start-position",t(e,i));e.data("current-splitter",n(this));f.map.events.fire("begin-resize",f.map)})):u.css({width:"unset",right:0});c+=s});u(e);e.on("mouseup",function(i){var r=e.data("start-position");if(r){var h=t(e,i),c=h.x-r.x,s=e.data("current-splitter").prev();s.css({width:s.width()+c});e.data("start-position",null);e.data("current-splitter",null);u(e);o.each(function(t,i){var r=n(i);r.attr("data-minsize")&&e.webgis_splitter("setSize",{selectorClass:r.attr("class"),size:r.attr("data-minsize"),map:f.map})});f.map&&f.map.resize()}}).on("mousemove",function(n){var r=e.data("start-position"),i;r&&(i=t(e,n),e.data("current-splitter").css({left:i.x}))})}e.addClass("webgis-splitter-initialized")}},r=function(t){var i=t.children(),r=0;i.each(function(t,u){var f=n(u);f.css({top:r});t<i.length-1&&(f.hasClass("webgis-splitter-bar")||(r+=f.height()))})},u=function(t){var i=t.children(),r=0;i.each(function(t,u){var f=n(u);f.css({left:r});t<i.length-1&&(f.hasClass("webgis-splitter-bar")||(r+=f.width()))})},t=function(n,t){var i=n.offset(),r=t.pageX-i.left,u=t.pageY-i.top;return{x:r,y:u}}}(webgis.$||jQuery),function(n){"use strict";n.fn.webgis_contextMenu=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on webgis.$.webgis_contextMenu");else return t.init.apply(this,arguments)};var i={clickEvent:null,callback:null,items:[]},t={init:function(t){var u=n(this);return t=n.extend({},i,t),this.each(function(){new r(this,t)})}},r=function(t,i){if(i.clickEvent&&i.items.length){let o=n(t),f=function(t,i){i.stopPropagation();var r=n(t);(r.hasClass(".webgis-contextmenu-blocker")||(r=r.closest(".webgis-contextmenu-blocker")),(new Date).getTime()-r.data("time-stamp")<500)||(r.remove(),n(window).off("keyup",e))},r=n("<div>").addClass("webgis-contextmenu-blocker").appendTo(o).data("time-stamp",(new Date).getTime()).contextmenu(function(n){return f(this,n),!1}).click(function(n){f(this,n)});if(i.sender){let u=n(i.sender),t=u.offset();n("<div>").addClass("shader").css({top:0,left:0,right:0,height:t.top}).appendTo(r);n("<div>").addClass("shader").css({top:t.top+u.height(),left:0,right:0,bottom:0}).appendTo(r);n("<div>").addClass("shader").css({top:t.top,left:0,width:t.left,height:u.height()}).appendTo(r);n("<div>").addClass("shader").css({top:t.top,right:0,width:n(window).width()-t.left-u.width(),height:u.height()}).appendTo(r)}let u=n("<ul>").addClass("webgis-contextmenu").appendTo(r);for(let t of i.items){let r=n("<li>").addClass("webgis-contextmenu-item").attr("shortcut",t.shortcut).data("item-data",t.data).appendTo(u).click(function(t){t.stopPropagation();i.callback&&i.callback(n(this).data("item-data"));f(this,t)});n("<div>").text(t.text).appendTo(r);t.shortcut&&(r.attr("shortcut",t.shortcut),n("<div>").addClass("shortcut-text").text("Shortcut-Key: "+t.shortcut.toString().toUpperCase()).appendTo(r));t.icon&&r.css("backgroundImage",t.icon.indexOf("url(")===0?t.icon:"url("+t.icon+")")}u.css({left:Math.max(0,Math.min(n(window).width()-u.width()-10,i.clickEvent.originalEvent.clientX)),top:Math.max(0,Math.min(n(window).height()-u.height()-10,i.clickEvent.originalEvent.clientY))});let e=function(n){if(n.key==="Escape")return f(r,n),!1;const t=u.children("li[shortcut='"+n.key+"']");return t.length===1&&t.trigger("click"),!1};n(window).on("keyup",e)}}}(webgis.$||jQuery);