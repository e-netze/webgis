version: "3.8"

services:
    webgis-cms:
        image: webgis-cms:${WEBGIS_CMS_TAG}
        ports:
            - "5003:8080"
        volumes:
            - cms-config:/app/_config
            - webgis-repository:/etc/webgis-repository
        networks:
            - webgis-network
        env_file:
            - cms.env

    webgis-api:
        image: webgis-api:${WEBGIS_API_TAG}
        ports:
            - "5001:8080"
        volumes:
            - api-config:/app/_config
            - webgis-repository:/etc/webgis-repository
        networks:
            - webgis-network
        env_file:
            - api.env

    webgis-portal:
        image: webgis-portal:${WEBGIS_PORTAL_TAG}
        ports:
            - "5002:8080"
        volumes:
            - portal-config:/app/_config
            - webgis-repository:/etc/webgis-repository
        networks:
            - webgis-network
        env_file:
            - api.env

volumes:
    webgis-repository: 
        driver: local
        driver_opts:
            type: none         
            device: ${WEBGIS_HOST_ROOT_PATH}/webgis/webgis-repository   # host directory
            o: bind
    api-config: 
        driver: local
        driver_opts:
            type: none         
            device: ${WEBGIS_HOST_ROOT_PATH}/webgis/api/_config   # host directory
            o: bind
    cms-config: 
        driver: local
        driver_opts:
            type: none         
            device: ${WEBGIS_HOST_ROOT_PATH}/webgis/cms/_config   # host directory
            o: bind
    portal-config: 
        driver: local
        driver_opts:
            type: none         
            device: ${WEBGIS_HOST_ROOT_PATH}/webgis/portal/_config   # host directory
            o: bind

networks:
    webgis-network:
